<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ ¡ç‰©ç† - æ³¢ç‰¹æœ‰ã®æ€§è³ªï¼ˆè¨¼æ˜ç·¨ï¼‰</title>
    <script>
      window.MathJax = {
      tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
     }
     };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        h1 {
            color: #333;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        .tab-btn:hover {
            background: #8899f0;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        h2 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        h3 {
            color: #764ba2;
            margin: 25px 0 15px 0;
            font-size: 1.2em;
        }
        h4 {
            color: #555;
            margin: 20px 0 10px 0;
            font-size: 1.1em;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .proof-section {
            background: #f0f4ff;
            border-left-color: #764ba2;
        }
        .key-point {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ff9800;
        }
        .formula-box {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.1em;
        }
        .step-container {
            margin: 20px 0;
        }
        .step {
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
        }
        .step-header {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .step-header:hover {
            background: #5a6fd6;
        }
        .step-content {
            padding: 15px;
            display: none;
        }
        .step-content.show {
            display: block;
        }
        .step-arrow {
            transition: transform 0.3s;
        }
        .step-arrow.rotated {
            transform: rotate(180deg);
        }
        .static-diagram {
            text-align: center;
            margin: 20px 0;
        }
        .static-diagram canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
            max-width: 100%;
        }
        .diagram-caption {
            color: #666;
            font-size: 0.9em;
            margin-top: 8px;
        }
        
        /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #sim-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .sim-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .sim-tab-btn {
            flex: 1;
            min-width: 100px;
            padding: 10px 15px;
            border: 2px solid #667eea;
            background: white;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s;
            color: #667eea;
            font-weight: bold;
        }
        .sim-tab-btn.active {
            background: #667eea;
            color: white;
        }
        .sim-tab-btn:hover {
            background: #e8ecff;
        }
        .sim-tab-btn.active:hover {
            background: #5a6fd6;
        }
        .sim-panel {
            display: none;
        }
        .sim-panel.active {
            display: block;
        }
        #physicsCanvas, .sim-canvas {
            display: block;
            width: 100%;
            background: white;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
        .sim-controls {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .sim-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .sim-button.start {
            background: #4CAF50;
            color: white;
        }
        .sim-button.start:hover {
            background: #45a049;
        }
        .sim-button.pause {
            background: #ff9800;
            color: white;
        }
        .sim-button.pause:hover {
            background: #e68a00;
        }
        .sim-button.reset {
            background: #f44336;
            color: white;
        }
        .sim-button.reset:hover {
            background: #da190b;
        }
        .info-panel {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .info-panel h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        /* å•é¡Œã‚¿ãƒ–ç”¨ */
        details {
            background: #f5f5f5;
            border-radius: 8px;
            margin: 15px 0;
            padding: 15px;
        }
        summary {
            cursor: pointer;
            font-weight: bold;
            color: #667eea;
            padding: 10px;
            background: #e8ecff;
            border-radius: 5px;
            margin: -15px -15px 0 -15px;
        }
        summary:hover {
            background: #d0d8ff;
        }
        .answer-content {
            padding-top: 15px;
        }
        .problem-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }
        .problem-box h4 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            header, .container {
                padding: 15px;
            }
            .tab-btn {
                min-width: 100px;
                font-size: 14px;
            }
            .sim-tab-btn {
                min-width: 80px;
                font-size: 12px;
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="back-link">â† ç›®æ¬¡ã«æˆ»ã‚‹</a>
        <h1>æ³¢ç‰¹æœ‰ã®æ€§è³ªï¼ˆè¨¼æ˜ç·¨ï¼‰</h1>
    </header>
    <div class="container">
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('lecture')">è§£èª¬ç·¨</button>
            <button class="tab-btn" onclick="openTab('problem')">å•é¡Œç·¨</button>
            <button class="tab-btn" onclick="openTab('simulation')">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>
        
        <div id="lecture" class="tab-content active">
            <h2>ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã«ã‚ˆã‚‹è¨¼æ˜</h2>
            
            <div class="section">
                <h3>ğŸŒŠ ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ï¼ˆå¾©ç¿’ï¼‰</h3>
                <p>æ³¢ã®é€²ã¿æ–¹ã‚’èª¬æ˜ã™ã‚‹åŸºæœ¬åŸç†ã‚’å¾©ç¿’ã—ã¾ã—ã‚‡ã†ã€‚</p>
                
                <div class="key-point">
                    <strong>ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†</strong><br>
                    â‘  æ³¢é¢ä¸Šã®å„ç‚¹ã¯ã€ãã‚Œãã‚ŒãŒæ–°ã—ã„æ³¢ï¼ˆ<strong>ç´ å…ƒæ³¢</strong>ï¼‰ã®æ³¢æºã¨ãªã‚‹<br>
                    â‘¡ æ¬¡ã®ç¬é–“ã®æ³¢é¢ã¯ã€ã“ã‚Œã‚‰ã®ç´ å…ƒæ³¢ã®<strong>å…±é€šæ¥ç·šï¼ˆåŒ…çµ¡ç·šï¼‰</strong>ã¨ã—ã¦å¾—ã‚‰ã‚Œã‚‹
                </div>
                
                <div class="static-diagram">
                    <canvas id="huygensBasicCanvas" width="500" height="200"></canvas>
                    <p class="diagram-caption">å›³ï¼šãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã®æ¦‚å¿µå›³ï¼ˆå¹³é¢æ³¢ã®å ´åˆï¼‰</p>
                </div>
                
                <p>ã“ã®åŸç†ã‚’ä½¿ã†ã¨ã€<strong>åå°„ã®æ³•å‰‡</strong>ã€<strong>å±ˆæŠ˜ã®æ³•å‰‡</strong>ã€<strong>å›æŠ˜</strong>ã‚’çµ±ä¸€çš„ã«èª¬æ˜ã§ãã¾ã™ã€‚</p>
            </div>
            
            <!-- åå°„ã®æ³•å‰‡ã®è¨¼æ˜ -->
            <div class="section proof-section">
                <h3>ğŸ“ åå°„ã®æ³•å‰‡ã®è¨¼æ˜</h3>
                <p>å…¥å°„è§’ $i$ ã¨åå°„è§’ $j$ ãŒç­‰ã—ã„ã“ã¨ã‚’ã€ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã‚’ä½¿ã£ã¦è¨¼æ˜ã—ã¾ã™ã€‚</p>
                
                <div class="formula-box">
                    <strong>åå°„ã®æ³•å‰‡ï¼š</strong> $i = j$ï¼ˆå…¥å°„è§’ ï¼ åå°„è§’ï¼‰
                </div>
                
                <div class="step-container">
                    <div class="step">
                        <div class="step-header" onclick="toggleStep(this)">
                            <span>Step 1ï¼šçŠ¶æ³è¨­å®š</span>
                            <span class="step-arrow">â–¼</span>
                        </div>
                        <div class="step-content show">
                            <p>å¹³é¢æ³¢ãŒåå°„é¢ã«å…¥å°„è§’ $i$ ã§å…¥å°„ã™ã‚‹çŠ¶æ³ã‚’è€ƒãˆã¾ã™ã€‚æ³¢é¢ABã®ã†ã¡ã€<strong>ç‚¹AãŒå…ˆã«åå°„é¢ã«åˆ°é”</strong>ã—ã¾ã™ã€‚</p>
                            <div class="static-diagram">
                                <canvas id="reflectStep1Canvas" width="500" height="300"></canvas>
                            </div>
                            <p>ç‚¹AãŒåå°„é¢ã«åˆ°é”ã—ãŸç¬é–“ã€ç‚¹Bã¯ã¾ã åå°„é¢ã«é”ã—ã¦ã„ã¾ã›ã‚“ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-header" onclick="toggleStep(this)">
                            <span>Step 2ï¼šç´ å…ƒæ³¢ã®ç™ºç”Ÿã¨ç‚¹Bã®ç§»å‹•</span>
                            <span class="step-arrow">â–¼</span>
                        </div>
                        <div class="step-content">
                            <p>ç‚¹AãŒåå°„é¢ã«åˆ°é”ã™ã‚‹ã¨ã€ãã“ã‹ã‚‰<strong>ç´ å…ƒæ³¢</strong>ãŒç™ºç”Ÿã—ã¾ã™ã€‚åŒæ™‚ã«ç‚¹Bã¯åå°„é¢ã«å‘ã‹ã£ã¦é€²ã¿ç¶šã‘ã¾ã™ã€‚</p>
                            <div class="static-diagram">
                                <canvas id="reflectStep2Canvas" width="500" height="300"></canvas>
                            </div>
                            <p>ç‚¹BãŒåå°„é¢ä¸Šã®ç‚¹B'ã«åˆ°é”ã™ã‚‹ã¾ã§ã®æ™‚é–“ã‚’ $t$ ã¨ã™ã‚‹ã¨ï¼š</p>
                            <ul>
                                <li>ç‚¹BãŒé€²ã‚€è·é›¢ï¼š$\text{BB'} = vt$</li>
                                <li>ç‚¹Aã‹ã‚‰ç™ºç”Ÿã—ãŸç´ å…ƒæ³¢ã®åŠå¾„ï¼š$\text{AA'} = vt$</li>
                            </ul>
                            <div class="key-point">
                                <strong>ãƒã‚¤ãƒ³ãƒˆï¼š</strong>åå°„å‰å¾Œã§åª’è³ªã¯åŒã˜ãªã®ã§ã€æ³¢ã®é€Ÿã• $v$ ã¯å¤‰ã‚ã‚‰ãªã„ï¼<br>
                                â†’ $\text{BB'} = \text{AA'} = vt$
                            </div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-header" onclick="toggleStep(this)">
                            <span>Step 3ï¼šæ–°ã—ã„æ³¢é¢ã®ä½œå›³</span>
                            <span class="step-arrow">â–¼</span>
                        </div>
                        <div class="step-content">
                            <p>ç‚¹B'ã‹ã‚‰ç´ å…ƒæ³¢ã«æ¥ç·šã‚’å¼•ãã¨ã€ãã®æ¥ç‚¹A'ã¨ã®ç›´ç·šãŒåå°„å¾Œã®æ³¢é¢ã«ãªã‚Šã¾ã™ã€‚</p>
                            <div class="static-diagram">
                                <canvas id="reflectStep3Canvas" width="500" height="300"></canvas>
                            </div>
                            <p>åå°„å¾Œã®æ³¢é¢A'B'ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚ç´ å…ƒæ³¢ã®åŠå¾„ã¨æ¥ç·šã¯ç›´è§’ã«äº¤ã‚ã‚‹ã®ã§ã€$\angle \text{AA'B'} = 90Â°$ ã§ã™ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-header" onclick="toggleStep(this)">
                            <span>Step 4ï¼šä¸‰è§’å½¢ã®åˆåŒã«ã‚ˆã‚‹è¨¼æ˜</span>
                            <span class="step-arrow">â–¼</span>
                        </div>
                        <div class="step-content">
                            <p>ä¸‰è§’å½¢AA'B'ã¨ä¸‰è§’å½¢B'BAã‚’æ¯”è¼ƒã—ã¾ã™ã€‚</p>
                            <div class="static-diagram">
                                <canvas id="reflectStep4Canvas" width="500" height="320"></canvas>
                            </div>
                            <p><strong>â–³AA'B' ã¨ â–³B'BA ã«ã¤ã„ã¦ï¼š</strong></p>
                            <ul>
                                <li>$\text{AA'} = \text{BB'} = vt$ï¼ˆåŒã˜æ™‚é–“ã§åŒã˜é€Ÿã•ï¼‰</li>
                                <li>$\text{AB'}$ ã¯å…±é€šã®æ–œè¾º</li>
                                <li>$\angle \text{AA'B'} = \angle \text{BB'A} = 90Â°$ï¼ˆæ³¢é¢ã¨é€²è¡Œæ–¹å‘ã¯å‚ç›´ï¼‰</li>
                            </ul>
                            <div class="formula-box">
                                ç›´è§’ä¸‰è§’å½¢ã®æ–œè¾ºã¨ä»–ã®ä¸€è¾ºãŒç­‰ã—ã„ã®ã§<br>
                                <strong>â–³AA'B' â‰¡ â–³B'BAï¼ˆåˆåŒï¼‰</strong>
                            </div>
                            <p>åˆåŒãªä¸‰è§’å½¢ã§ã¯å¯¾å¿œã™ã‚‹è§’ãŒç­‰ã—ã„ã®ã§ã€$\angle \text{A'AB'} = \angle \text{AB'B}$</p>
                            <p>ã“ã“ã§ã€å…¥å°„è§’ $i = \angle \text{AB'B}$ã€åå°„è§’ $j = \angle \text{A'AB'}$ ã‚ˆã‚Šï¼š</p>
                            <div class="formula-box">
                                $i = j$ã€€ï¼ˆè¨¼æ˜å®Œäº†ï¼‰
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å±ˆæŠ˜ã®æ³•å‰‡ã®è¨¼æ˜ -->
            <div class="section proof-section">
                <h3>ğŸ“ å±ˆæŠ˜ã®æ³•å‰‡ã®è¨¼æ˜</h3>
                <p>åª’è³ªâ… ï¼ˆæ³¢ã®é€Ÿã• $v_1$ï¼‰ã‹ã‚‰åª’è³ªâ…¡ï¼ˆæ³¢ã®é€Ÿã• $v_2$ï¼‰ã¸æ³¢ãŒé€²ã‚€ã¨ãã®å±ˆæŠ˜ã®æ³•å‰‡ã‚’è¨¼æ˜ã—ã¾ã™ã€‚</p>
                
                <div class="formula-box">
                    <strong>å±ˆæŠ˜ã®æ³•å‰‡ï¼š</strong> $\displaystyle \frac{\sin\theta_1}{\sin\theta_2} = \frac{v_1}{v_2} = n_{12}$
                </div>
                
                <div class="step-container">
                    <div class="step">
                        <div class="step-header" onclick="toggleStep(this)">
                            <span>Step 1ï¼šçŠ¶æ³è¨­å®š</span>
                            <span class="step-arrow">â–¼</span>
                        </div>
                        <div class="step-content show">
                            <p>å¹³é¢æ³¢ãŒåª’è³ªâ… ã‹ã‚‰åª’è³ªâ…¡ã¸ã€å¢ƒç•Œé¢ã«å…¥å°„è§’ $\theta_1$ ã§å…¥å°„ã™ã‚‹çŠ¶æ³ã‚’è€ƒãˆã¾ã™ã€‚æ³¢é¢ABã®ã†ã¡ã€<strong>ç‚¹AãŒå…ˆã«å¢ƒç•Œé¢ã«åˆ°é”</strong>ã—ã¾ã™ã€‚</p>
                            <div class="static-diagram">
                                <canvas id="refractStep1Canvas" width="500" height="350"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-header" onclick="toggleStep(this)">
                            <span>Step 2ï¼šç´ å…ƒæ³¢ã®ç™ºç”Ÿï¼ˆé€Ÿã•ã®é•ã„ã«æ³¨æ„ï¼ï¼‰</span>
                            <span class="step-arrow">â–¼</span>
                        </div>
                        <div class="step-content">
                            <p>ç‚¹AãŒå¢ƒç•Œé¢ã«åˆ°é”ã™ã‚‹ã¨ã€<strong>åª’è³ªâ…¡ã®ä¸­ã§</strong>ç´ å…ƒæ³¢ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p>
                            <div class="static-diagram">
                                <canvas id="refractStep2Canvas" width="500" height="350"></canvas>
                            </div>
                            <p>ç‚¹BãŒå¢ƒç•Œé¢ä¸Šã®ç‚¹B'ã«åˆ°é”ã™ã‚‹ã¾ã§ã®æ™‚é–“ã‚’ $t$ ã¨ã™ã‚‹ã¨ï¼š</p>
                            <ul>
                                <li>åª’è³ªâ… å†…ï¼šç‚¹Bã¯è·é›¢ $\text{BB'} = v_1 t$ ã ã‘é€²ã‚€</li>
                                <li>åª’è³ªâ…¡å†…ï¼šç‚¹Aã‹ã‚‰ç™ºç”Ÿã—ãŸç´ å…ƒæ³¢ã®åŠå¾„ã¯ $\text{AA'} = v_2 t$</li>
                            </ul>
                            <div class="key-point">
                                <strong>é‡è¦ãƒã‚¤ãƒ³ãƒˆï¼š</strong>åª’è³ªãŒå¤‰ã‚ã‚‹ã¨æ³¢ã®é€Ÿã•ãŒå¤‰ã‚ã‚‹ï¼<br>
                                â†’ $\text{BB'} = v_1 t$ ã¨ $\text{AA'} = v_2 t$ ã¯<strong>ç•°ãªã‚‹</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-header" onclick="toggleStep(this)">
                            <span>Step 3ï¼šæ–°ã—ã„æ³¢é¢ã®ä½œå›³</span>
                            <span class="step-arrow">â–¼</span>
                        </div>
                        <div class="step-content">
                            <p>ç‚¹B'ã‹ã‚‰ç´ å…ƒæ³¢ã«æ¥ç·šã‚’å¼•ãã¨ã€ãã®æ¥ç‚¹A'ã¨ã®ç›´ç·šãŒå±ˆæŠ˜å¾Œã®æ³¢é¢ã«ãªã‚Šã¾ã™ã€‚</p>
                            <div class="static-diagram">
                                <canvas id="refractStep3Canvas" width="500" height="350"></canvas>
                            </div>
                            <p>$v_2 < v_1$ ã®å ´åˆã€ç´ å…ƒæ³¢ã®åŠå¾„ãŒå°ã•ã„ãŸã‚ã€æ³¢é¢ã®å‘ããŒå¤‰ã‚ã‚Šã€å±ˆæŠ˜è§’ $\theta_2 < \theta_1$ ã¨ãªã‚Šã¾ã™ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-header" onclick="toggleStep(this)">
                            <span>Step 4ï¼šä¸‰è§’æ¯”ã«ã‚ˆã‚‹è¨¼æ˜</span>
                            <span class="step-arrow">â–¼</span>
                        </div>
                        <div class="step-content">
                            <p>å…±é€šã®æ–œè¾º $\text{AB'}$ ã«ç€ç›®ã—ã¦ã€$\sin$ ã®æ¯”ã‚’æ±‚ã‚ã¾ã™ã€‚</p>
                            <div class="static-diagram">
                                <canvas id="refractStep4Canvas" width="500" height="350"></canvas>
                            </div>
                            <p><strong>â–³ABB' ã«ã¤ã„ã¦ï¼ˆå…¥å°„å´ï¼‰ï¼š</strong></p>
                            <p style="text-align: center;">$\displaystyle \sin\theta_1 = \frac{\text{BB'}}{\text{AB'}} = \frac{v_1 t}{\text{AB'}}$</p>
                            
                            <p><strong>â–³AA'B' ã«ã¤ã„ã¦ï¼ˆå±ˆæŠ˜å´ï¼‰ï¼š</strong></p>
                            <p style="text-align: center;">$\displaystyle \sin\theta_2 = \frac{\text{AA'}}{\text{AB'}} = \frac{v_2 t}{\text{AB'}}$</p>
                            
                            <p><strong>æ¯”ã‚’ã¨ã‚‹ã¨ï¼š</strong></p>
                            <div class="formula-box">
                                $\displaystyle \frac{\sin\theta_1}{\sin\theta_2} = \frac{v_1 t / \text{AB'}}{v_2 t / \text{AB'}} = \frac{v_1}{v_2} = n_{12}$
                            </div>
                            <p style="text-align: center;"><strong>ï¼ˆè¨¼æ˜å®Œäº†ï¼‰</strong></p>
                        </div>
                    </div>
                </div>
                
                <div class="key-point">
                    <strong>æŒ¯å‹•æ•°ã¯ä¸å¤‰ï¼</strong><br>
                    ã©ã®åª’è³ªã§ã‚‚æ³¢æºã®æŒ¯å‹•æ•° $f$ ã¯åŒã˜ãªã®ã§ã€$v = f\lambda$ ã‚ˆã‚Šï¼š
                    $$\frac{v_1}{v_2} = \frac{\lambda_1}{\lambda_2} = n_{12}$$
                    åª’è³ªãŒå¤‰ã‚ã‚‹ã¨<strong>æ³¢é•·</strong>ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚
                </div>
            </div>
            
            <!-- å›æŠ˜ã®è§£é‡ˆ -->
            <div class="section">
                <h3>ğŸŒ€ å›æŠ˜ã®è§£é‡ˆ</h3>
                <p><strong>å›æŠ˜</strong>ã¨ã¯ã€æ³¢ãŒéšœå®³ç‰©ã®è£å´ã«å›ã‚Šè¾¼ã‚€ç¾è±¡ã§ã™ã€‚ã“ã‚Œã‚‚ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã§èª¬æ˜ã§ãã¾ã™ã€‚</p>
                
                <div class="static-diagram">
                    <canvas id="diffractionCanvas" width="500" height="300"></canvas>
                    <p class="diagram-caption">å›³ï¼šã‚¹ãƒªãƒƒãƒˆã‚’é€šéã™ã‚‹æ³¢ã®å›æŠ˜</p>
                </div>
                
                <p>ã‚¹ãƒªãƒƒãƒˆï¼ˆéš™é–“ï¼‰ã‚’é€šéã—ãŸæ³¢é¢ä¸Šã®å„ç‚¹ã‹ã‚‰ç´ å…ƒæ³¢ãŒç™ºç”Ÿã—ã€ãã®åŒ…çµ¡ç·šã¨ã—ã¦æ–°ã—ã„æ³¢é¢ãŒã§ãã¾ã™ã€‚ã‚¹ãƒªãƒƒãƒˆã®ç«¯ã§ã¯ç´ å…ƒæ³¢ãŒéšœå®³ç‰©ã®è£å´ã«ã‚‚åºƒãŒã‚‹ãŸã‚ã€<strong>æ³¢ãŒå›ã‚Šè¾¼ã‚€</strong>ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚</p>
                
                <div class="key-point">
                    <strong>æ³¢é•·ã¨å›æŠ˜ã®åº¦åˆã„</strong><br>
                    å›æŠ˜ã®åº¦åˆã„ã¯<strong>æ³¢é•·ã¨ã‚¹ãƒªãƒƒãƒˆå¹…ã®æ¯”</strong>ã§æ±ºã¾ã‚Šã¾ã™ã€‚
                </div>
                
                <h4>æ³¢é•·ã«ã‚ˆã‚‹å›æŠ˜ã®é•ã„</h4>
                <div class="static-diagram">
                    <canvas id="diffractionCompareCanvas" width="600" height="250"></canvas>
                    <p class="diagram-caption">å›³ï¼šæ³¢é•·ã«ã‚ˆã‚‹å›æŠ˜ã®åº¦åˆã„ã®é•ã„ï¼ˆå·¦ï¼šé•·ã„æ³¢é•·ã€å³ï¼šçŸ­ã„æ³¢é•·ï¼‰</p>
                </div>
                
                <div class="formula-box">
                    <strong>æ³¢é•·ãŒé•·ã„ï¼ˆã‚¹ãƒªãƒƒãƒˆå¹…ã«è¿‘ã„ï¼‰</strong> â†’ å›æŠ˜ã—ã‚„ã™ã„ï¼ˆå¤§ããå›ã‚Šè¾¼ã‚€ï¼‰<br>
                    <strong>æ³¢é•·ãŒçŸ­ã„ï¼ˆã‚¹ãƒªãƒƒãƒˆå¹…ã‚ˆã‚Šååˆ†å°ã•ã„ï¼‰</strong> â†’ å›æŠ˜ã—ã«ãã„ï¼ˆã¾ã£ã™ãé€²ã‚€ï¼‰
                </div>
                
                <p><strong>å…·ä½“ä¾‹ï¼š</strong></p>
                <ul>
                    <li><strong>éŸ³ï¼ˆæ³¢é•·ï¼šæ•°cmã€œæ•°mï¼‰</strong>ï¼šãƒ‰ã‚¢ã®éš™é–“ã‹ã‚‰å›ã‚Šè¾¼ã‚“ã§èã“ãˆã‚‹</li>
                    <li><strong>å…‰ï¼ˆæ³¢é•·ï¼šç´„400ã€œ700nmï¼‰</strong>ï¼šã»ã¼ç›´é€²ã™ã‚‹ï¼ˆå½±ãŒã§ãã‚‹ï¼‰</li>
                </ul>
                
                <p>å…‰ã‚‚æ³¢ãªã®ã§å›æŠ˜ã—ã¾ã™ãŒã€æ³¢é•·ãŒéå¸¸ã«çŸ­ã„ãŸã‚æ—¥å¸¸çš„ã«ã¯è¦³å¯Ÿã—ã«ãã„ã®ã§ã™ã€‚</p>
            </div>
            
            <h2>æˆæ¥­è³‡æ–™</h2>
            <iframe src="https://drive.google.com/file/d/1rd3AUHNkj-NLM0IEztEdsiVOdPwxD6EA/preview" width="100%" height="500"></iframe>
        </div>
        
        <div id="problem" class="tab-content">
            <h2>ç¢ºèªå•é¡Œ</h2>
            
            <div class="problem-box">
                <h4>å•é¡Œ1ï¼šåå°„ã®æ³•å‰‡ã®è¨¼æ˜</h4>
                <p>ä¸‹å›³ã®ã‚ˆã†ã«ã€æ³¢é¢ABãŒåå°„é¢ã«å…¥å°„è§’ $i$ ã§å…¥å°„ã—ã¦ã„ã‚‹ã€‚ç‚¹AãŒå…ˆã«åå°„é¢ã«åˆ°é”ã—ã€ç‚¹BãŒåå°„é¢ä¸Šã®ç‚¹B'ã«åˆ°é”ã™ã‚‹ã¾ã§ã®æ™‚é–“ã‚’ $t$ã€åª’è³ªä¸­ã®æ³¢ã®é€Ÿã•ã‚’ $v$ ã¨ã™ã‚‹ã€‚</p>
                <div class="static-diagram">
                    <canvas id="problem1Canvas" width="450" height="280"></canvas>
                </div>
                <p>(1) ç‚¹BãŒåå°„é¢ã«åˆ°é”ã™ã‚‹ã¾ã§ã«é€²ã‚€è·é›¢BB'ã‚’ã€$v$, $t$ ã‚’ç”¨ã„ã¦è¡¨ã›ã€‚</p>
                <p>(2) ç‚¹Aã‹ã‚‰ç™ºç”Ÿã™ã‚‹ç´ å…ƒæ³¢ã®åŠå¾„AA'ã‚’ã€$v$, $t$ ã‚’ç”¨ã„ã¦è¡¨ã›ã€‚</p>
                <p>(3) å…¥å°„è§’ $i$ ã¨åå°„è§’ $j$ ãŒç­‰ã—ã„ã“ã¨ã‚’ã€ä¸‰è§’å½¢ã®åˆåŒã‚’ç”¨ã„ã¦è¨¼æ˜ã›ã‚ˆã€‚</p>
            </div>
            
            <details>
                <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¡¨ç¤º</summary>
                <div class="answer-content">
                    <p><strong>(1)</strong> æ³¢ã®é€Ÿã•ãŒ $v$ã€æ™‚é–“ãŒ $t$ ãªã®ã§ï¼š</p>
                    <div class="formula-box">$\text{BB'} = vt$</div>
                    
                    <p><strong>(2)</strong> åå°„ã®å‰å¾Œã§åª’è³ªã¯åŒã˜ãªã®ã§ã€æ³¢ã®é€Ÿã•ã¯å¤‰ã‚ã‚‰ãªã„ã€‚ç‚¹Aã‹ã‚‰ç™ºç”Ÿã—ãŸç´ å…ƒæ³¢ã¯ã€æ™‚é–“ $t$ ã®é–“ã«åŠå¾„ $vt$ ã¾ã§åºƒãŒã‚‹ï¼š</p>
                    <div class="formula-box">$\text{AA'} = vt$</div>
                    
                    <p><strong>(3)</strong> â–³AA'B'ã¨â–³B'BAã«ã¤ã„ã¦ï¼š</p>
                    <ul>
                        <li>$\text{AA'} = \text{BB'} = vt$</li>
                        <li>$\text{AB'}$ ã¯å…±é€š</li>
                        <li>$\angle \text{AA'B'} = \angle \text{BB'A} = 90Â°$ï¼ˆæ³¢é¢ã¨é€²è¡Œæ–¹å‘ã¯å‚ç›´ï¼‰</li>
                    </ul>
                    <p>ç›´è§’ä¸‰è§’å½¢ã§æ–œè¾ºã¨ä»–ã®ä¸€è¾ºãŒãã‚Œãã‚Œç­‰ã—ã„ã®ã§ã€â–³AA'B' â‰¡ â–³B'BA</p>
                    <p>ã‚ˆã£ã¦å¯¾å¿œã™ã‚‹è§’ãŒç­‰ã—ãã€$\angle \text{A'AB'} = \angle \text{AB'B}$</p>
                    <p>ã“ã“ã§ $\angle \text{AB'B} = i$ï¼ˆå…¥å°„è§’ï¼‰ã€$\angle \text{A'AB'} = j$ï¼ˆåå°„è§’ï¼‰ã‚ˆã‚Šï¼š</p>
                    <div class="formula-box">$i = j$</div>
                </div>
            </details>
            
            <div class="problem-box">
                <h4>å•é¡Œ2ï¼šå±ˆæŠ˜ã®æ³•å‰‡ã®è¨¼æ˜</h4>
                <p>åª’è³ªâ… ï¼ˆæ³¢ã®é€Ÿã• $v_1$ï¼‰ã‹ã‚‰åª’è³ªâ…¡ï¼ˆæ³¢ã®é€Ÿã• $v_2$ï¼‰ã¸æ³¢ãŒå…¥å°„è§’ $\theta_1$ ã§å…¥å°„ã—ã€å±ˆæŠ˜è§’ $\theta_2$ ã§å±ˆæŠ˜ã—ãŸã€‚æ³¢é¢ã®ä¸€ç«¯AãŒå¢ƒç•Œé¢ã«åˆ°é”ã—ã¦ã‹ã‚‰ã€ä»–ç«¯BãŒå¢ƒç•Œé¢ã®ç‚¹B'ã«åˆ°é”ã™ã‚‹ã¾ã§ã®æ™‚é–“ã‚’ $t$ ã¨ã™ã‚‹ã€‚</p>
                <p>(1) åª’è³ªâ… ä¸­ã§ç‚¹BãŒé€²ã‚€è·é›¢ã‚’æ±‚ã‚ã‚ˆã€‚</p>
                <p>(2) åª’è³ªâ…¡ä¸­ã§ç‚¹Aã‹ã‚‰ç™ºç”Ÿã™ã‚‹ç´ å…ƒæ³¢ã®åŠå¾„ã‚’æ±‚ã‚ã‚ˆã€‚</p>
                <p>(3) å…±é€šã®è¾ºAB'ã‚’ç”¨ã„ã¦ã€$\sin\theta_1$ ã¨ $\sin\theta_2$ ã‚’ãã‚Œãã‚Œè¡¨ã›ã€‚</p>
                <p>(4) å±ˆæŠ˜ã®æ³•å‰‡ $\displaystyle \frac{\sin\theta_1}{\sin\theta_2} = \frac{v_1}{v_2}$ ã‚’å°ã‘ã€‚</p>
            </div>
            
            <details>
                <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¡¨ç¤º</summary>
                <div class="answer-content">
                    <p><strong>(1)</strong> åª’è³ªâ… ä¸­ã®æ³¢ã®é€Ÿã•ã¯ $v_1$ ãªã®ã§ï¼š</p>
                    <div class="formula-box">$\text{BB'} = v_1 t$</div>
                    
                    <p><strong>(2)</strong> åª’è³ªâ…¡ä¸­ã®æ³¢ã®é€Ÿã•ã¯ $v_2$ ãªã®ã§ã€ç´ å…ƒæ³¢ã®åŠå¾„ã¯ï¼š</p>
                    <div class="formula-box">$\text{AA'} = v_2 t$</div>
                    
                    <p><strong>(3)</strong> â–³ABB'ã«ãŠã„ã¦ã€$\angle \text{AB'B} = 90Â°$ ã‚ˆã‚Šï¼š</p>
                    <div class="formula-box">$\displaystyle \sin\theta_1 = \frac{\text{BB'}}{\text{AB'}} = \frac{v_1 t}{\text{AB'}}$</div>
                    <p>â–³AA'B'ã«ãŠã„ã¦ã€$\angle \text{AA'B'} = 90Â°$ ã‚ˆã‚Šï¼š</p>
                    <div class="formula-box">$\displaystyle \sin\theta_2 = \frac{\text{AA'}}{\text{AB'}} = \frac{v_2 t}{\text{AB'}}$</div>
                    
                    <p><strong>(4)</strong> (3)ã®çµæœã®æ¯”ã‚’ã¨ã‚‹ã¨ï¼š</p>
                    $$\frac{\sin\theta_1}{\sin\theta_2} = \frac{v_1 t / \text{AB'}}{v_2 t / \text{AB'}} = \frac{v_1 t}{v_2 t} = \frac{v_1}{v_2}$$
                    <div class="formula-box">$\displaystyle \frac{\sin\theta_1}{\sin\theta_2} = \frac{v_1}{v_2}$ï¼ˆè¨¼æ˜å®Œäº†ï¼‰</div>
                </div>
            </details>
            
            <div class="problem-box">
                <h4>å•é¡Œ3ï¼šå›æŠ˜ã¨æ³¢é•·</h4>
                <p>éŸ³ã¨å…‰ã¯ã©ã¡ã‚‰ã‚‚æ³¢ã§ã‚ã‚‹ãŒã€æ—¥å¸¸ç”Ÿæ´»ã«ãŠã„ã¦éŸ³ã¯éšœå®³ç‰©ã®è£å´ã«å›ã‚Šè¾¼ã¿ã‚„ã™ãã€å…‰ã¯ã¾ã£ã™ãé€²ã‚“ã§å½±ã‚’ä½œã‚‹ã€‚ã“ã®é•ã„ã‚’ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã¨æ³¢é•·ã®è¦³ç‚¹ã‹ã‚‰èª¬æ˜ã›ã‚ˆã€‚</p>
            </div>
            
            <details>
                <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¡¨ç¤º</summary>
                <div class="answer-content">
                    <p><strong>è§£ç­”ä¾‹ï¼š</strong></p>
                    <p>ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã«ã‚ˆã‚‹ã¨ã€æ³¢é¢ä¸Šã®å„ç‚¹ã‹ã‚‰ç´ å…ƒæ³¢ãŒç™ºç”Ÿã—ã€éšœå®³ç‰©ã®ç«¯ã§ã¯ç´ å…ƒæ³¢ãŒè£å´ã«ã‚‚å›ã‚Šè¾¼ã‚€ã€‚ã“ã‚ŒãŒå›æŠ˜ã§ã‚ã‚‹ã€‚</p>
                    <p>å›æŠ˜ã®åº¦åˆã„ã¯ã€<strong>æ³¢é•·ã¨éšœå®³ç‰©ï¼ˆã¾ãŸã¯ã‚¹ãƒªãƒƒãƒˆï¼‰ã®ã‚µã‚¤ã‚ºã®æ¯”</strong>ã§æ±ºã¾ã‚‹ã€‚æ³¢é•·ãŒéšœå®³ç‰©ã®ã‚µã‚¤ã‚ºã«è¿‘ã„ã»ã©ã€å›æŠ˜ãŒé¡•è‘—ã«ãªã‚‹ã€‚</p>
                    <ul>
                        <li><strong>éŸ³</strong>ï¼šæ³¢é•·ãŒæ•°cmã€œæ•°mã¨é•·ãã€ãƒ‰ã‚¢ã®å¹…ï¼ˆç´„1mï¼‰ã«è¿‘ã„ã€‚ãã®ãŸã‚å¤§ããå›æŠ˜ã—ã€éšœå®³ç‰©ã®è£å´ã«ã‚‚å›ã‚Šè¾¼ã‚€ã€‚</li>
                        <li><strong>å…‰</strong>ï¼šæ³¢é•·ãŒç´„400ã€œ700nmï¼ˆ$10^{-7}$mç¨‹åº¦ï¼‰ã¨éå¸¸ã«çŸ­ãã€æ—¥å¸¸çš„ãªéšœå®³ç‰©ã®ã‚µã‚¤ã‚ºã«æ¯”ã¹ã¦ç„¡è¦–ã§ãã‚‹ã»ã©å°ã•ã„ã€‚ãã®ãŸã‚å›æŠ˜ãŒã»ã¨ã‚“ã©èµ·ã“ã‚‰ãšã€ã»ã¼ç›´é€²ã—ã¦å½±ã‚’ä½œã‚‹ã€‚</li>
                    </ul>
                    <div class="key-point">
                        æ³¢é•·ãŒé•·ã„ã»ã©ï¼ˆéšœå®³ç‰©ã‚µã‚¤ã‚ºã«è¿‘ã„ã»ã©ï¼‰å›æŠ˜ã—ã‚„ã™ãã€æ³¢é•·ãŒçŸ­ã„ã»ã©ç›´é€²æ€§ãŒé«˜ã„ã€‚
                    </div>
                </div>
            </details>
        </div>
        
        <div id="simulation" class="tab-content">
            <h2>ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            <p>ç´ å…ƒæ³¢ã¨æ³¢é¢ã®å½¢æˆéç¨‹ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚å„ã‚¿ãƒ–ã§ç•°ãªã‚‹ç¾è±¡ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</p>
            
            <div class="sim-tabs">
                <button class="sim-tab-btn active" onclick="openSimTab('reflection')">åå°„ã®æ³•å‰‡</button>
                <button class="sim-tab-btn" onclick="openSimTab('refraction')">å±ˆæŠ˜ã®æ³•å‰‡</button>
                <button class="sim-tab-btn" onclick="openSimTab('diffraction')">å›æŠ˜</button>
            </div>
            
            <!-- åå°„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div id="reflectionPanel" class="sim-panel active">
                <div id="sim-container">
                    <canvas id="reflectionCanvas" class="sim-canvas"></canvas>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>å…¥å°„è§’: <span class="value-display" id="reflectAngleDisplay">45Â°</span></label>
                        <input type="range" id="reflectAngleSlider" min="15" max="75" value="45" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>ç´ å…ƒæ³¢ã®æ•°: <span class="value-display" id="reflectWaveCountDisplay">5å€‹</span></label>
                        <input type="range" id="reflectWaveCountSlider" min="3" max="8" value="5" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦: <span class="value-display" id="reflectSpeedDisplay">1.0x</span></label>
                        <input type="range" id="reflectSpeedSlider" min="0.3" max="2" value="1" step="0.1">
                    </div>
                    
                    <div class="button-group">
                        <button class="sim-button start" id="reflectStartBtn">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button pause" id="reflectPauseBtn">â¸ ä¸€æ™‚åœæ­¢</button>
                        <button class="sim-button reset" id="reflectResetBtn">â†º ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
                
                <div class="info-panel">
                    <h4>ğŸ“Œ è¦³å¯Ÿãƒã‚¤ãƒ³ãƒˆ</h4>
                    <ul>
                        <li>æ³¢é¢ãŒåå°„é¢ã«<strong>é †æ¬¡åˆ°é”</strong>ã—ã€åˆ°é”ã—ãŸç‚¹ã‹ã‚‰<span style="color: #e91e63; font-weight: bold;">ç´ å…ƒæ³¢ï¼ˆãƒ”ãƒ³ã‚¯è‰²ã®åŠå††ï¼‰</span>ãŒç™ºç”Ÿã—ã¾ã™</li>
                        <li>ç´ å…ƒæ³¢ã®<span style="color: #4caf50; font-weight: bold;">å…±é€šæ¥ç·šï¼ˆåŒ…çµ¡ç·šï¼‰</span>ãŒæ–°ã—ã„åå°„æ³¢é¢ã«ãªã‚Šã¾ã™</li>
                        <li>BB' = AA' = vt ã¨ãªã‚Šã€å…¥å°„è§’ã¨åå°„è§’ãŒç­‰ã—ããªã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†</li>
                    </ul>
                </div>
            </div>
            
            <!-- å±ˆæŠ˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div id="refractionPanel" class="sim-panel">
                <div id="sim-container">
                    <canvas id="refractionCanvas" class="sim-canvas"></canvas>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>å…¥å°„è§’: <span class="value-display" id="refractAngleDisplay">45Â°</span></label>
                        <input type="range" id="refractAngleSlider" min="15" max="75" value="45" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>åª’è³ªâ…¡ã®å±ˆæŠ˜ç‡ $n_2$: <span class="value-display" id="refractIndexDisplay">1.5</span></label>
                        <input type="range" id="refractIndexSlider" min="0.6" max="2.0" value="1.5" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label>ç´ å…ƒæ³¢ã®æ•°: <span class="value-display" id="refractWaveCountDisplay">5å€‹</span></label>
                        <input type="range" id="refractWaveCountSlider" min="3" max="8" value="5" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦: <span class="value-display" id="refractSpeedDisplay">1.0x</span></label>
                        <input type="range" id="refractSpeedSlider" min="0.3" max="2" value="1" step="0.1">
                    </div>
                    
                    <div class="button-group">
                        <button class="sim-button start" id="refractStartBtn">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button pause" id="refractPauseBtn">â¸ ä¸€æ™‚åœæ­¢</button>
                        <button class="sim-button reset" id="refractResetBtn">â†º ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
                
                <div class="info-panel">
                    <h4>ğŸ“Œ è¦³å¯Ÿãƒã‚¤ãƒ³ãƒˆ</h4>
                    <ul>
                        <li>åª’è³ªâ…¡ã§ã¯æ³¢ã®é€Ÿã•ãŒå¤‰ã‚ã‚‹ãŸã‚ã€<span style="color: #e91e63; font-weight: bold;">ç´ å…ƒæ³¢ã®åŠå¾„</span>ãŒåª’è³ªâ… ã§ã®ç§»å‹•è·é›¢ã¨ç•°ãªã‚Šã¾ã™</li>
                        <li>$n_2 > 1$ ã®ã¨ãï¼šåª’è³ªâ…¡ã§æ³¢ãŒé…ããªã‚Šã€å±ˆæŠ˜è§’ < å…¥å°„è§’ï¼ˆæ³•ç·šã«è¿‘ã¥ãï¼‰</li>
                        <li>$n_2 < 1$ ã®ã¨ãï¼šåª’è³ªâ…¡ã§æ³¢ãŒé€Ÿããªã‚Šã€å±ˆæŠ˜è§’ > å…¥å°„è§’ï¼ˆæ³•ç·šã‹ã‚‰é ã–ã‹ã‚‹ï¼‰</li>
                    </ul>
                </div>
            </div>
            
            <!-- å›æŠ˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div id="diffractionPanel" class="sim-panel">
                <div id="sim-container">
                    <canvas id="diffractionSimCanvas" class="sim-canvas"></canvas>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>æ³¢é•·: <span class="value-display" id="diffractWavelengthDisplay">40 px</span></label>
                        <input type="range" id="diffractWavelengthSlider" min="15" max="80" value="40" step="5">
                    </div>
                    
                    <div class="control-group">
                        <label>ã‚¹ãƒªãƒƒãƒˆå¹…: <span class="value-display" id="diffractSlitDisplay">80 px</span></label>
                        <input type="range" id="diffractSlitSlider" min="30" max="200" value="80" step="10">
                    </div>
                    
                    <div class="control-group">
                        <label>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦: <span class="value-display" id="diffractSpeedDisplay">1.0x</span></label>
                        <input type="range" id="diffractSpeedSlider" min="0.3" max="2" value="1" step="0.1">
                    </div>
                    
                    <div class="button-group">
                        <button class="sim-button start" id="diffractStartBtn">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button pause" id="diffractPauseBtn">â¸ ä¸€æ™‚åœæ­¢</button>
                        <button class="sim-button reset" id="diffractResetBtn">â†º ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
                
                <div class="info-panel">
                    <h4>ğŸ“Œ è¦³å¯Ÿãƒã‚¤ãƒ³ãƒˆ</h4>
                    <ul>
                        <li><strong>æ³¢é•·ã‚’å¤§ãã</strong>ã™ã‚‹ã¨ï¼šå›æŠ˜ãŒé¡•è‘—ã«ãªã‚Šã€æ³¢ãŒå¤§ããå›ã‚Šè¾¼ã¿ã¾ã™</li>
                        <li><strong>æ³¢é•·ã‚’å°ã•ã</strong>ã™ã‚‹ã¨ï¼šå›æŠ˜ãŒæŠ‘ãˆã‚‰ã‚Œã€æ³¢ã¯ç›´é€²ã—ã‚„ã™ããªã‚Šã¾ã™</li>
                        <li><strong>ã‚¹ãƒªãƒƒãƒˆå¹…ã‚’ç‹­ã</strong>ã™ã‚‹ã¨ï¼šå›æŠ˜ãŒã‚ˆã‚Šé¡•è‘—ã«ãªã‚Šã¾ã™</li>
                        <li>æ³¢é•·/ã‚¹ãƒªãƒƒãƒˆå¹… ã®æ¯”ãŒå¤§ãã„ã»ã©å›æŠ˜ã—ã‚„ã™ã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ ---
    function openTab(tabName) {
        var contents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < contents.length; i++) {
            contents[i].style.display = "none";
            contents[i].classList.remove("active");
        }
        var buttons = document.getElementsByClassName("tab-btn");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        if (event) {
            event.currentTarget.classList.add("active");
        }
        
        if (tabName === 'simulation') {
            setTimeout(() => {
                initReflectionSim();
                initRefractionSim();
                initDiffractionSim();
            }, 100);
        }
    }
    
    function openSimTab(simName) {
        var panels = document.getElementsByClassName("sim-panel");
        for (var i = 0; i < panels.length; i++) {
            panels[i].classList.remove("active");
        }
        var simBtns = document.getElementsByClassName("sim-tab-btn");
        for (var i = 0; i < simBtns.length; i++) {
            simBtns[i].classList.remove("active");
        }
        document.getElementById(simName + 'Panel').classList.add("active");
        event.currentTarget.classList.add("active");
    }
    
    function toggleStep(header) {
        const content = header.nextElementSibling;
        const arrow = header.querySelector('.step-arrow');
        content.classList.toggle('show');
        arrow.classList.toggle('rotated');
    }
    
    // ============================
    // æç”»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    // ============================
    
    function drawArrow(ctx, fromX, fromY, toX, toY, headLen = 10) {
        const angle = Math.atan2(toY - fromY, toX - fromX);
        ctx.beginPath();
        ctx.moveTo(fromX, fromY);
        ctx.lineTo(toX, toY);
        ctx.lineTo(toX - headLen * Math.cos(angle - Math.PI / 6), toY - headLen * Math.sin(angle - Math.PI / 6));
        ctx.moveTo(toX, toY);
        ctx.lineTo(toX - headLen * Math.cos(angle + Math.PI / 6), toY - headLen * Math.sin(angle + Math.PI / 6));
        ctx.stroke();
    }
    
    function drawRightAngle(ctx, x, y, size, angle1, angle2) {
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(angle1);
        ctx.beginPath();
        ctx.moveTo(size, 0);
        ctx.lineTo(size, size);
        ctx.lineTo(0, size);
        ctx.stroke();
        ctx.restore();
    }
    
    // ============================
    // é™çš„å›³è§£ã®æç”»
    // ============================
    
    // ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†åŸºæœ¬å›³ï¼ˆä¿®æ­£ç‰ˆï¼‰
    function drawHuygensBasic() {
        const canvas = document.getElementById('huygensBasicCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#f8f9fa';
        ctx.fillRect(0, 0, W, H);
        
        const waveX1 = 100;  // å…ƒã®æ³¢é¢ã®ä½ç½®
        const waveX2 = 280;  // æ–°ã—ã„æ³¢é¢ã®ä½ç½®
        const radius = waveX2 - waveX1;  // ç´ å…ƒæ³¢ã®åŠå¾„
        
        // å…ƒã®æ³¢é¢
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(waveX1, 30);
        ctx.lineTo(waveX1, 170);
        ctx.stroke();
        
        // é€²è¡Œæ–¹å‘çŸ¢å°
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        drawArrow(ctx, waveX1 + 20, 100, waveX1 + 70, 100);
        
        // ç´ å…ƒæ³¢ã®æ³¢æºç‚¹ã¨ç´ å…ƒæ³¢ï¼ˆå³åŠåˆ†ã®ã¿ï¼‰
        const wavePoints = [50, 80, 110, 140];
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 1.5;
        wavePoints.forEach(y => {
            // ç´ å…ƒæ³¢ï¼ˆå³åŠåˆ†ã®ã¿ï¼‰
            ctx.beginPath();
            ctx.arc(waveX1, y, radius, -Math.PI/2, Math.PI/2);
            ctx.stroke();
            
            // æ³¢æºç‚¹
            ctx.fillStyle = '#e91e63';
            ctx.beginPath();
            ctx.arc(waveX1, y, 4, 0, Math.PI * 2);
            ctx.fill();
        });
        
        // æ–°ã—ã„æ³¢é¢ï¼ˆåŒ…çµ¡ç·šï¼‰
        ctx.strokeStyle = '#4caf50';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(waveX2, 30);
        ctx.lineTo(waveX2, 170);
        ctx.stroke();
        
        // é€²è¡Œæ–¹å‘çŸ¢å°
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        drawArrow(ctx, waveX2 + 20, 100, waveX2 + 70, 100);
        
        // ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#2196f3';
        ctx.font = '14px sans-serif';
        ctx.fillText('å…ƒã®æ³¢é¢', waveX1 - 30, 190);
        
        ctx.fillStyle = '#e91e63';
        ctx.fillText('ç´ å…ƒæ³¢', waveX1 + radius/2 - 20, 40);
        
        ctx.fillStyle = '#4caf50';
        ctx.fillText('æ–°ã—ã„æ³¢é¢', waveX2 - 35, 190);
        ctx.fillText('ï¼ˆåŒ…çµ¡ç·šï¼‰', waveX2 - 30, 205);
        
        // åŠå¾„ã®è¡¨ç¤º
        ctx.strokeStyle = '#999';
        ctx.setLineDash([3, 3]);
        ctx.beginPath();
        ctx.moveTo(waveX1, 110);
        ctx.lineTo(waveX2, 110);
        ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillStyle = '#666';
        ctx.fillText('vt', waveX1 + radius/2 - 10, 125);
    }
    
    // åå°„Step1ï¼ˆä¿®æ­£ç‰ˆï¼šæ­£ã—ã„å¹¾ä½•å­¦çš„é…ç½®ï¼‰
    function drawReflectStep1() {
        const canvas = document.getElementById('reflectStep1Canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#f0f4ff';
        ctx.fillRect(0, 0, W, H);
        
        // åå°„é¢
        const surfaceY = 220;
        ctx.fillStyle = '#e0e0e0';
        ctx.fillRect(50, surfaceY, 400, 20);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(50, surfaceY);
        ctx.lineTo(450, surfaceY);
        ctx.stroke();
        
        const theta = Math.PI / 4; // å…¥å°„è§’45åº¦
        const Ax = 150, Ay = surfaceY;  // ç‚¹Aï¼ˆå¢ƒç•Œé¢ä¸Šï¼‰
        const waveLen = 100;  // æ³¢é¢ã®é•·ã•
        
        // ç‚¹Bï¼ˆã¾ã å¢ƒç•Œé¢ã«é”ã—ã¦ã„ãªã„ï¼‰
        const Bx = Ax + waveLen * Math.cos(theta);
        const By = Ay - waveLen * Math.sin(theta);
        
        // å…¥å°„æ³¢é¢AB
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(Ax, Ay);
        ctx.lineTo(Bx, By);
        ctx.stroke();
        
        // é€²è¡Œæ–¹å‘ï¼ˆæ³¢é¢ã«å‚ç›´ï¼‰
        const dirX = Math.sin(theta);
        const dirY = Math.cos(theta);
        const midX = (Ax + Bx) / 2;
        const midY = (Ay + By) / 2;
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        drawArrow(ctx, midX - 40*dirX, midY - 40*dirY, midX + 30*dirX, midY + 30*dirY);
        
        // æ³•ç·šï¼ˆç‚¹Aã‹ã‚‰ï¼‰
        ctx.setLineDash([5, 5]);
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(Ax, surfaceY);
        ctx.lineTo(Ax, 50);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // å…¥å°„è§’ã®è¡¨ç¤º
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.arc(Ax, surfaceY, 35, -Math.PI/2, -Math.PI/2 + theta, false);
        ctx.stroke();
        ctx.fillStyle = '#e91e63';
        ctx.font = '16px sans-serif';
        ctx.fillText('i', Ax + 15, surfaceY - 45);
        
        // ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#2196f3';
        ctx.font = 'bold 16px sans-serif';
        ctx.fillText('A', Ax - 20, Ay + 20);
        ctx.fillText('B', Bx + 10, By - 5);
        
        ctx.fillStyle = '#666';
        ctx.font = '14px sans-serif';
        ctx.fillText('æ³•ç·š', Ax + 5, 65);
        ctx.fillText('åå°„é¢', 380, surfaceY + 15);
        ctx.fillText('æ³¢é¢AB', Bx + 20, By + 20);
    }
    
    // åå°„Step2
    function drawReflectStep2() {
        const canvas = document.getElementById('reflectStep2Canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#f0f4ff';
        ctx.fillRect(0, 0, W, H);
        
        const surfaceY = 220;
        ctx.fillStyle = '#e0e0e0';
        ctx.fillRect(50, surfaceY, 400, 20);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(50, surfaceY);
        ctx.lineTo(450, surfaceY);
        ctx.stroke();
        
        const theta = Math.PI / 4;
        const Ax = 150, Ay = surfaceY;
        const vt = 80;
        
        // B'ã®ä½ç½®ï¼ˆå¢ƒç•Œé¢ä¸Šï¼‰
        const Bpx = Ax + vt / Math.sin(theta);
        const Bpy = surfaceY;
        
        // å…ƒã®Bã®ä½ç½®
        const Bx = Bpx;
        const By = Bpy - vt / Math.tan(theta);
        
        // BB'ã®ç§»å‹•ã‚’ç¤ºã™ï¼ˆç‚¹ç·šï¼‰
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(Bx, By - 30);
        ctx.lineTo(Bpx, Bpy);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // ç‚¹Aã‹ã‚‰ç´ å…ƒæ³¢ï¼ˆä¸ŠåŠåˆ†ã®ã¿ï¼‰
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(Ax, Ay, vt, -Math.PI, 0, false);
        ctx.stroke();
        
        // ç‚¹A
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(Ax, Ay, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // ç‚¹B'
        ctx.fillStyle = '#2196f3';
        ctx.beginPath();
        ctx.arc(Bpx, Bpy, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#e91e63';
        ctx.fillText('A', Ax - 20, Ay + 20);
        ctx.fillText('ç´ å…ƒæ³¢', Ax - 60, Ay - vt/2);
        
        ctx.fillStyle = '#2196f3';
        ctx.fillText('B', Bx + 10, By - 20);
        ctx.fillText("B'", Bpx + 10, Bpy + 20);
        
        // è·é›¢ã®è¡¨ç¤º
        ctx.fillStyle = '#333';
        ctx.font = '14px sans-serif';
        ctx.fillText("BB' = vt", Bpx - 30, By - 40);
        ctx.fillText("AA' = vt", Ax + vt + 10, Ay - vt/2);
        ctx.fillText("ï¼ˆåŠå¾„ï¼‰", Ax + vt + 10, Ay - vt/2 + 18);
    }
    
    // åå°„Step3
    function drawReflectStep3() {
        const canvas = document.getElementById('reflectStep3Canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#f0f4ff';
        ctx.fillRect(0, 0, W, H);
        
        const surfaceY = 220;
        ctx.fillStyle = '#e0e0e0';
        ctx.fillRect(50, surfaceY, 400, 20);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(50, surfaceY);
        ctx.lineTo(450, surfaceY);
        ctx.stroke();
        
        const theta = Math.PI / 4;
        const Ax = 150, Ay = surfaceY;
        const vt = 80;
        const Bpx = Ax + vt / Math.sin(theta);
        
        // ç´ å…ƒæ³¢
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(Ax, Ay, vt, -Math.PI, 0, false);
        ctx.stroke();
        
        // æ¥ç‚¹A'
        const Apx = Ax + vt * Math.sin(theta);
        const Apy = Ay - vt * Math.cos(theta);
        
        // åå°„å¾Œã®æ³¢é¢ A'B'
        ctx.strokeStyle = '#4caf50';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(Apx, Apy);
        ctx.lineTo(Bpx, surfaceY);
        ctx.stroke();
        
        // åå°„æ³¢ã®é€²è¡Œæ–¹å‘
        const midX = (Apx + Bpx) / 2;
        const midY = (Apy + surfaceY) / 2;
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        drawArrow(ctx, midX - 30*Math.sin(theta), midY - 30*Math.cos(theta), 
                       midX + 30*Math.sin(theta), midY + 30*Math.cos(theta));
        
        // ç‚¹
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(Ax, Ay, 5, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#4caf50';
        ctx.beginPath();
        ctx.arc(Apx, Apy, 5, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#2196f3';
        ctx.beginPath();
        ctx.arc(Bpx, surfaceY, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // ç›´è§’ãƒãƒ¼ã‚¯
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;
        const angleSize = 12;
        ctx.beginPath();
        ctx.moveTo(Apx + angleSize * Math.cos(theta), Apy + angleSize * Math.sin(theta));
        ctx.lineTo(Apx + angleSize * Math.cos(theta) - angleSize * Math.sin(theta), 
                   Apy + angleSize * Math.sin(theta) + angleSize * Math.cos(theta));
        ctx.lineTo(Apx - angleSize * Math.sin(theta), Apy + angleSize * Math.cos(theta));
        ctx.stroke();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#e91e63';
        ctx.fillText('A', Ax - 20, Ay + 20);
        
        ctx.fillStyle = '#4caf50';
        ctx.fillText("A'", Apx - 25, Apy - 5);
        ctx.fillText('åå°„æ³¢é¢', midX + 40, midY - 20);
        
        ctx.fillStyle = '#2196f3';
        ctx.fillText("B'", Bpx + 10, surfaceY + 20);
        
        // æ³•ç·šï¼ˆç‚¹B'ã‹ã‚‰ï¼‰
        ctx.setLineDash([5, 5]);
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(Bpx, surfaceY);
        ctx.lineTo(Bpx, 50);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // åå°„è§’
        ctx.strokeStyle = '#9c27b0';
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.arc(Bpx, surfaceY, 35, -Math.PI/2 - theta, -Math.PI/2, false);
        ctx.stroke();
        ctx.fillStyle = '#9c27b0';
        ctx.fillText('j', Bpx - 35, surfaceY - 45);
    }
    
    // åå°„Step4
    function drawReflectStep4() {
        const canvas = document.getElementById('reflectStep4Canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#fff8e1';
        ctx.fillRect(0, 0, W, H);
        
        const surfaceY = 230;
        ctx.fillStyle = '#e0e0e0';
        ctx.fillRect(50, surfaceY, 400, 15);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(50, surfaceY);
        ctx.lineTo(450, surfaceY);
        ctx.stroke();
        
        const theta = Math.PI / 4;
        const Ax = 140, Ay = surfaceY;
        const vt = 85;
        const Bpx = Ax + vt / Math.sin(theta);
        const Apx = Ax + vt * Math.sin(theta);
        const Apy = Ay - vt * Math.cos(theta);
        
        // å…ƒã®Bã®ä½ç½®
        const Bx = Bpx;
        const By = Apy;  // åŒã˜é«˜ã•
        
        // â–³AA'B'ï¼ˆç·‘ï¼‰
        ctx.fillStyle = 'rgba(76, 175, 80, 0.25)';
        ctx.beginPath();
        ctx.moveTo(Ax, Ay);
        ctx.lineTo(Apx, Apy);
        ctx.lineTo(Bpx, surfaceY);
        ctx.closePath();
        ctx.fill();
        ctx.strokeStyle = '#4caf50';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // â–³B'BAï¼ˆé’ï¼‰
        ctx.fillStyle = 'rgba(33, 150, 243, 0.25)';
        ctx.beginPath();
        ctx.moveTo(Bpx, surfaceY);
        ctx.lineTo(Bx, By);
        ctx.lineTo(Ax, Ay);
        ctx.closePath();
        ctx.fill();
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // å…±é€šã®æ–œè¾ºAB'
        ctx.strokeStyle = '#ff5722';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(Ax, Ay);
        ctx.lineTo(Bpx, surfaceY);
        ctx.stroke();
        
        // ç›´è§’ãƒãƒ¼ã‚¯ï¼ˆAA'B'ï¼‰
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;
        const as = 10;
        ctx.beginPath();
        ctx.moveTo(Apx + as * Math.cos(theta), Apy + as * Math.sin(theta));
        ctx.lineTo(Apx + as * Math.cos(theta) - as * Math.sin(theta), Apy + as * Math.sin(theta) + as * Math.cos(theta));
        ctx.lineTo(Apx - as * Math.sin(theta), Apy + as * Math.cos(theta));
        ctx.stroke();
        
        // ç›´è§’ãƒãƒ¼ã‚¯ï¼ˆBB'Aï¼‰
        ctx.beginPath();
        ctx.moveTo(Bpx - as, surfaceY - as);
        ctx.lineTo(Bpx - as, surfaceY);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(Bpx - as, surfaceY - as);
        ctx.lineTo(Bpx, surfaceY - as);
        ctx.stroke();
        
        // ç‚¹
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(Ax, Ay, 5, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#4caf50';
        ctx.beginPath();
        ctx.arc(Apx, Apy, 5, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#2196f3';
        ctx.beginPath();
        ctx.arc(Bpx, surfaceY, 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(Bx, By, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#e91e63';
        ctx.fillText('A', Ax - 18, Ay + 22);
        
        ctx.fillStyle = '#4caf50';
        ctx.fillText("A'", Apx - 5, Apy - 12);
        
        ctx.fillStyle = '#2196f3';
        ctx.fillText("B'", Bpx + 8, surfaceY + 22);
        ctx.fillText('B', Bx + 8, By - 8);
        
        // è¾ºã®é•·ã•
        ctx.font = '13px sans-serif';
        ctx.fillStyle = '#4caf50';
        ctx.fillText("AA' = vt", Ax - 45, (Ay + Apy)/2);
        
        ctx.fillStyle = '#2196f3';
        ctx.fillText("BB' = vt", Bpx + 12, (surfaceY + By)/2 + 5);
        
        ctx.fillStyle = '#ff5722';
        ctx.fillText("AB'ï¼ˆå…±é€šï¼‰", (Ax + Bpx)/2 - 10, surfaceY + 40);
        
        // è§’åº¦
        ctx.fillStyle = '#e91e63';
        ctx.font = '14px sans-serif';
        ctx.fillText('i', Bpx - 50, surfaceY - 55);
        ctx.fillStyle = '#9c27b0';
        ctx.fillText('j', Ax + 50, Ay - 55);
        
        // çµè«–
        ctx.fillStyle = '#d32f2f';
        ctx.font = 'bold 15px sans-serif';
        ctx.fillText("â–³AA'B' â‰¡ â–³B'BAï¼ˆåˆåŒï¼‰", 280, 40);
        ctx.fillText("âˆ´ i = j", 340, 65);
    }
    
    // å±ˆæŠ˜Step1
    function drawRefractStep1() {
        const canvas = document.getElementById('refractStep1Canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        
        const boundaryY = 180;
        
        // åª’è³ªâ… ï¼ˆä¸Šï¼‰
        ctx.fillStyle = '#e3f2fd';
        ctx.fillRect(0, 0, W, boundaryY);
        
        // åª’è³ªâ…¡ï¼ˆä¸‹ï¼‰
        ctx.fillStyle = '#fff3e0';
        ctx.fillRect(0, boundaryY, W, H - boundaryY);
        
        // å¢ƒç•Œé¢
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, boundaryY);
        ctx.lineTo(W, boundaryY);
        ctx.stroke();
        
        const theta1 = Math.PI / 4;
        const Ax = 150, Ay = boundaryY;
        const waveLen = 90;
        
        // ç‚¹B
        const Bx = Ax + waveLen * Math.cos(theta1);
        const By = Ay - waveLen * Math.sin(theta1);
        
        // å…¥å°„æ³¢é¢AB
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(Ax, Ay);
        ctx.lineTo(Bx, By);
        ctx.stroke();
        
        // é€²è¡Œæ–¹å‘
        const dirX = Math.sin(theta1);
        const dirY = Math.cos(theta1);
        const midX = (Ax + Bx) / 2;
        const midY = (Ay + By) / 2;
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        drawArrow(ctx, midX - 35*dirX, midY - 35*dirY, midX + 25*dirX, midY + 25*dirY);
        
        // æ³•ç·š
        ctx.setLineDash([5, 5]);
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(Ax, 30);
        ctx.lineTo(Ax, H - 30);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // å…¥å°„è§’
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.arc(Ax, boundaryY, 30, -Math.PI/2, -Math.PI/2 + theta1, false);
        ctx.stroke();
        ctx.fillStyle = '#e91e63';
        ctx.font = '16px sans-serif';
        ctx.fillText('Î¸â‚', Ax + 12, boundaryY - 38);
        
        // ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#2196f3';
        ctx.font = 'bold 16px sans-serif';
        ctx.fillText('A', Ax - 20, Ay - 10);
        ctx.fillText('B', Bx + 10, By - 5);
        
        ctx.fillStyle = '#1976d2';
        ctx.font = '14px sans-serif';
        ctx.fillText('åª’è³ªâ… ï¼ˆé€Ÿã• vâ‚ï¼‰', W - 140, 40);
        ctx.fillStyle = '#e65100';
        ctx.fillText('åª’è³ªâ…¡ï¼ˆé€Ÿã• vâ‚‚ï¼‰', W - 140, boundaryY + 40);
        
        ctx.fillStyle = '#666';
        ctx.fillText('æ³•ç·š', Ax + 5, 45);
        ctx.fillText('å¢ƒç•Œé¢', 30, boundaryY - 8);
    }
    
    // å±ˆæŠ˜Step2
    function drawRefractStep2() {
        const canvas = document.getElementById('refractStep2Canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        
        const boundaryY = 180;
        ctx.fillStyle = '#e3f2fd';
        ctx.fillRect(0, 0, W, boundaryY);
        ctx.fillStyle = '#fff3e0';
        ctx.fillRect(0, boundaryY, W, H - boundaryY);
        
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, boundaryY);
        ctx.lineTo(W, boundaryY);
        ctx.stroke();
        
        const theta1 = Math.PI / 4;
        const Ax = 150, Ay = boundaryY;
        const v1t = 80;  // åª’è³ªâ… ã§ã®ç§»å‹•è·é›¢
        const v2t = 50;  // åª’è³ªâ…¡ã§ã®ç´ å…ƒæ³¢åŠå¾„ï¼ˆv2 < v1ï¼‰
        
        // B'ã®ä½ç½®
        const Bpx = Ax + v1t / Math.sin(theta1);
        
        // å…ƒã®Bã®ä½ç½®
        const By = Ay - v1t / Math.tan(theta1);
        
        // BB'ã®ç§»å‹•ï¼ˆç‚¹ç·šï¼‰
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(Bpx, By - 30);
        ctx.lineTo(Bpx, boundaryY);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // ç´ å…ƒæ³¢ï¼ˆåª’è³ªâ…¡å†…ã€ä¸‹åŠåˆ†ã®ã¿ï¼‰
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(Ax, Ay, v2t, 0, Math.PI, false);
        ctx.stroke();
        
        // ç‚¹A
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(Ax, Ay, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // ç‚¹B'
        ctx.fillStyle = '#2196f3';
        ctx.beginPath();
        ctx.arc(Bpx, boundaryY, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#e91e63';
        ctx.fillText('A', Ax - 20, Ay - 10);
        ctx.fillText('ç´ å…ƒæ³¢ï¼ˆåª’è³ªâ…¡å†…ï¼‰', Ax - 70, Ay + v2t + 30);
        
        ctx.fillStyle = '#2196f3';
        ctx.fillText('B', Bpx + 10, By - 25);
        ctx.fillText("B'", Bpx + 10, boundaryY - 10);
        
        // è·é›¢
        ctx.fillStyle = '#333';
        ctx.font = '14px sans-serif';
        ctx.fillText("BB' = vâ‚t", Bpx - 60, By - 10);
        ctx.fillText("AA' = vâ‚‚t", Ax + v2t + 10, Ay + v2t/2);
        
        // é‡è¦ãƒã‚¤ãƒ³ãƒˆ
        ctx.fillStyle = '#d32f2f';
        ctx.font = 'bold 14px sans-serif';
        ctx.fillText('â€» vâ‚t â‰  vâ‚‚t', W - 120, 80);
        ctx.fillText('ï¼ˆé€Ÿã•ãŒé•ã†ï¼ï¼‰', W - 130, 100);
    }
    
    // å±ˆæŠ˜Step3
    function drawRefractStep3() {
        const canvas = document.getElementById('refractStep3Canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        
        const boundaryY = 180;
        ctx.fillStyle = '#e3f2fd';
        ctx.fillRect(0, 0, W, boundaryY);
        ctx.fillStyle = '#fff3e0';
        ctx.fillRect(0, boundaryY, W, H - boundaryY);
        
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, boundaryY);
        ctx.lineTo(W, boundaryY);
        ctx.stroke();
        
        const theta1 = Math.PI / 4;
        const Ax = 150, Ay = boundaryY;
        const v1t = 80;
        const v2t = 50;
        const Bpx = Ax + v1t / Math.sin(theta1);
        
        // ç´ å…ƒæ³¢
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(Ax, Ay, v2t, 0, Math.PI, false);
        ctx.stroke();
        
        // æ¥ç‚¹A'ã®è¨ˆç®—
        const ABp = Bpx - Ax;
        const theta2 = Math.asin(v2t / ABp);
        const Apx = Ax + v2t * Math.sin(theta2);
        const Apy = Ay + v2t * Math.cos(theta2);
        
        // å±ˆæŠ˜å¾Œã®æ³¢é¢ A'B'
        ctx.strokeStyle = '#4caf50';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(Apx, Apy);
        ctx.lineTo(Bpx, boundaryY);
        ctx.stroke();
        
        // å±ˆæŠ˜æ³¢ã®é€²è¡Œæ–¹å‘
        const midX = (Apx + Bpx) / 2;
        const midY = (Apy + boundaryY) / 2;
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        drawArrow(ctx, midX - 25*Math.sin(theta2), midY - 25*Math.cos(theta2),
                       midX + 30*Math.sin(theta2), midY + 30*Math.cos(theta2));
        
        // æ³•ç·šï¼ˆç‚¹B'ã‹ã‚‰ï¼‰
        ctx.setLineDash([5, 5]);
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(Bpx, 60);
        ctx.lineTo(Bpx, H - 30);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // å±ˆæŠ˜è§’
        ctx.strokeStyle = '#9c27b0';
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.arc(Bpx, boundaryY, 30, Math.PI/2, Math.PI/2 + theta2, false);
        ctx.stroke();
        ctx.fillStyle = '#9c27b0';
        ctx.font = '16px sans-serif';
        ctx.fillText('Î¸â‚‚', Bpx - 40, boundaryY + 45);
        
        // ç‚¹
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(Ax, Ay, 5, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#4caf50';
        ctx.beginPath();
        ctx.arc(Apx, Apy, 5, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#2196f3';
        ctx.beginPath();
        ctx.arc(Bpx, boundaryY, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#e91e63';
        ctx.fillText('A', Ax - 20, Ay - 10);
        
        ctx.fillStyle = '#4caf50';
        ctx.fillText("A'", Apx - 25, Apy + 5);
        ctx.fillText('å±ˆæŠ˜æ³¢é¢', midX + 45, midY + 15);
        
        ctx.fillStyle = '#2196f3';
        ctx.fillText("B'", Bpx + 10, boundaryY - 10);
        
        ctx.fillStyle = '#666';
        ctx.font = '14px sans-serif';
        ctx.fillText('æ³•ç·š', Bpx + 5, 75);
    }
    
    // å±ˆæŠ˜Step4
    function drawRefractStep4() {
        const canvas = document.getElementById('refractStep4Canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#fff8e1';
        ctx.fillRect(0, 0, W, H);
        
        const boundaryY = 180;
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, boundaryY);
        ctx.lineTo(W, boundaryY);
        ctx.stroke();
        
        const theta1 = Math.PI / 4;
        const Ax = 140, Ay = boundaryY;
        const v1t = 85;
        const v2t = 55;
        const Bpx = Ax + v1t / Math.sin(theta1);
        const ABp = Bpx - Ax;
        const theta2 = Math.asin(v2t / ABp);
        
        // Bã®ä½ç½®
        const Bx = Bpx;
        const By = Ay - v1t / Math.tan(theta1);
        
        // A'ã®ä½ç½®
        const Apx = Ax + v2t * Math.sin(theta2);
        const Apy = Ay + v2t * Math.cos(theta2);
        
        // â–³ABB'ï¼ˆé’ãƒ»å…¥å°„å´ï¼‰
        ctx.fillStyle = 'rgba(33, 150, 243, 0.25)';
        ctx.beginPath();
        ctx.moveTo(Ax, Ay);
        ctx.lineTo(Bx, By);
        ctx.lineTo(Bpx, boundaryY);
        ctx.closePath();
        ctx.fill();
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // â–³AA'B'ï¼ˆç·‘ãƒ»å±ˆæŠ˜å´ï¼‰
        ctx.fillStyle = 'rgba(76, 175, 80, 0.25)';
        ctx.beginPath();
        ctx.moveTo(Ax, Ay);
        ctx.lineTo(Apx, Apy);
        ctx.lineTo(Bpx, boundaryY);
        ctx.closePath();
        ctx.fill();
        ctx.strokeStyle = '#4caf50';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // å…±é€šã®æ–œè¾ºAB'
        ctx.strokeStyle = '#ff5722';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(Ax, Ay);
        ctx.lineTo(Bpx, boundaryY);
        ctx.stroke();
        
        // ç›´è§’ãƒãƒ¼ã‚¯
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;
        const as = 10;
        // BB'Aã®ç›´è§’
        ctx.beginPath();
        ctx.moveTo(Bpx - as, boundaryY - as);
        ctx.lineTo(Bpx - as, boundaryY);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(Bpx - as, boundaryY - as);
        ctx.lineTo(Bpx, boundaryY - as);
        ctx.stroke();
        
        // AA'B'ã®ç›´è§’
        ctx.beginPath();
        ctx.moveTo(Apx + as * Math.cos(theta2), Apy - as * Math.sin(theta2));
        ctx.lineTo(Apx + as * Math.cos(theta2) + as * Math.sin(theta2), Apy - as * Math.sin(theta2) + as * Math.cos(theta2));
        ctx.lineTo(Apx + as * Math.sin(theta2), Apy + as * Math.cos(theta2));
        ctx.stroke();
        
        // ç‚¹
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(Ax, Ay, 5, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#4caf50';
        ctx.beginPath();
        ctx.arc(Apx, Apy, 5, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#2196f3';
        ctx.beginPath();
        ctx.arc(Bpx, boundaryY, 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(Bx, By, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#e91e63';
        ctx.fillText('A', Ax - 18, Ay - 8);
        
        ctx.fillStyle = '#4caf50';
        ctx.fillText("A'", Apx - 5, Apy + 20);
        
        ctx.fillStyle = '#2196f3';
        ctx.fillText("B'", Bpx + 8, boundaryY - 8);
        ctx.fillText('B', Bx + 8, By - 8);
        
        // è¾ºã®é•·ã•
        ctx.font = '13px sans-serif';
        ctx.fillStyle = '#2196f3';
        ctx.fillText("BB' = vâ‚t", Bpx + 12, (boundaryY + By)/2);
        
        ctx.fillStyle = '#4caf50';
        ctx.fillText("AA' = vâ‚‚t", Ax - 55, (Ay + Apy)/2 + 10);
        
        ctx.fillStyle = '#ff5722';
        ctx.fillText("AB'ï¼ˆå…±é€šï¼‰", (Ax + Bpx)/2 - 25, boundaryY - 25);
        
        // è§’åº¦
        ctx.fillStyle = '#e91e63';
        ctx.fillText('Î¸â‚', Bpx - 50, boundaryY - 50);
        ctx.fillStyle = '#9c27b0';
        ctx.fillText('Î¸â‚‚', Bpx - 50, boundaryY + 45);
        
        // å¼
        ctx.fillStyle = '#333';
        ctx.font = '13px sans-serif';
        ctx.fillText("sin Î¸â‚ = BB'/AB' = vâ‚t/AB'", 300, 50);
        ctx.fillText("sin Î¸â‚‚ = AA'/AB' = vâ‚‚t/AB'", 300, 75);
        ctx.fillStyle = '#d32f2f';
        ctx.font = 'bold 14px sans-serif';
        ctx.fillText("âˆ´ sin Î¸â‚/sin Î¸â‚‚ = vâ‚/vâ‚‚", 300, 105);
    }
    
    // å›æŠ˜å›³
    function drawDiffraction() {
        const canvas = document.getElementById('diffractionCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#f5f5f5';
        ctx.fillRect(0, 0, W, H);
        
        const wallX = 180;
        const slitTop = 100;
        const slitBot = 200;
        
        // éšœå®³ç‰©
        ctx.fillStyle = '#424242';
        ctx.fillRect(wallX - 10, 0, 20, slitTop);
        ctx.fillRect(wallX - 10, slitBot, 20, H - slitBot);
        
        // ã‚¹ãƒªãƒƒãƒˆ
        ctx.fillStyle = '#fff9c4';
        ctx.fillRect(wallX - 10, slitTop, 20, slitBot - slitTop);
        
        // å…¥å°„æ³¢é¢
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 2;
        for (let x = 40; x <= 160; x += 30) {
            ctx.beginPath();
            ctx.moveTo(x, 20);
            ctx.lineTo(x, 280);
            ctx.stroke();
        }
        
        // çŸ¢å°
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        drawArrow(ctx, 90, 150, 150, 150);
        
        // ã‚¹ãƒªãƒƒãƒˆå†…ã®ç´ å…ƒæ³¢æº
        const slitCenter = (slitTop + slitBot) / 2;
        const sources = [slitTop + 15, slitCenter - 15, slitCenter, slitCenter + 15, slitBot - 15];
        
        // ç´ å…ƒæ³¢ï¼ˆå³åŠåˆ†ã®ã¿ï¼‰
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 1.5;
        sources.forEach(y => {
            ctx.fillStyle = '#e91e63';
            ctx.beginPath();
            ctx.arc(wallX, y, 4, 0, Math.PI * 2);
            ctx.fill();
            
            for (let r = 30; r <= 120; r += 30) {
                ctx.beginPath();
                ctx.arc(wallX, y, r, -Math.PI/2, Math.PI/2);
                ctx.stroke();
            }
        });
        
        // æ–°ã—ã„æ³¢é¢ï¼ˆåŒ…çµ¡ç·šï¼‰
        ctx.strokeStyle = '#4caf50';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(wallX + 50, slitTop - 30);
        ctx.quadraticCurveTo(wallX + 90, slitCenter, wallX + 50, slitBot + 30);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(wallX + 100, slitTop - 60);
        ctx.quadraticCurveTo(wallX + 160, slitCenter, wallX + 100, slitBot + 60);
        ctx.stroke();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#333';
        ctx.font = '14px sans-serif';
        ctx.fillText('å…¥å°„æ³¢', 60, 30);
        ctx.fillText('éšœå®³ç‰©', wallX - 50, 60);
        ctx.fillText('ã‚¹ãƒªãƒƒãƒˆ', wallX - 55, slitCenter + 5);
        ctx.fillStyle = '#e91e63';
        ctx.fillText('ç´ å…ƒæ³¢', wallX + 130, 80);
        ctx.fillStyle = '#4caf50';
        ctx.fillText('å›æŠ˜æ³¢', wallX + 180, slitCenter);
    }
    
    // å›æŠ˜æ¯”è¼ƒå›³
    function drawDiffractionCompare() {
        const canvas = document.getElementById('diffractionCompareCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        
        const halfW = W / 2 - 15;
        
        // å·¦å´ï¼ˆé•·ã„æ³¢é•·ï¼‰
        ctx.fillStyle = '#e8f5e9';
        ctx.fillRect(0, 0, halfW, H);
        
        // å³å´ï¼ˆçŸ­ã„æ³¢é•·ï¼‰
        ctx.fillStyle = '#fce4ec';
        ctx.fillRect(halfW + 30, 0, halfW, H);
        
        // å·¦ã®éšœå®³ç‰©ã¨ã‚¹ãƒªãƒƒãƒˆ
        const wallX1 = 80;
        const slitH = 80;
        const centerY = 110;
        
        ctx.fillStyle = '#424242';
        ctx.fillRect(wallX1 - 8, 0, 16, centerY - slitH/2);
        ctx.fillRect(wallX1 - 8, centerY + slitH/2, 16, H - centerY - slitH/2);
        
        // å·¦ã®å…¥å°„æ³¢ï¼ˆé•·ã„æ³¢é•·ï¼‰
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 2;
        for (let x = 15; x <= 65; x += 25) {
            ctx.beginPath();
            ctx.moveTo(x, 10);
            ctx.lineTo(x, 210);
            ctx.stroke();
        }
        
        // å·¦ã®å›æŠ˜æ³¢ï¼ˆå¤§ããå›ã‚Šè¾¼ã‚€ï¼‰
        ctx.strokeStyle = '#4caf50';
        ctx.lineWidth = 2;
        for (let r = 35; r <= 130; r += 35) {
            ctx.beginPath();
            ctx.arc(wallX1, centerY, r, -1.2, 1.2);
            ctx.stroke();
        }
        
        // å³ã®éšœå®³ç‰©ã¨ã‚¹ãƒªãƒƒãƒˆ
        const wallX2 = halfW + 30 + 80;
        ctx.fillStyle = '#424242';
        ctx.fillRect(wallX2 - 8, 0, 16, centerY - slitH/2);
        ctx.fillRect(wallX2 - 8, centerY + slitH/2, 16, H - centerY - slitH/2);
        
        // å³ã®å…¥å°„æ³¢ï¼ˆçŸ­ã„æ³¢é•·ï¼‰
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 1.5;
        for (let x = halfW + 45; x <= halfW + 105; x += 12) {
            ctx.beginPath();
            ctx.moveTo(x, 10);
            ctx.lineTo(x, 210);
            ctx.stroke();
        }
        
        // å³ã®å›æŠ˜æ³¢ï¼ˆã‚ã¾ã‚Šå›ã‚Šè¾¼ã¾ãªã„ï¼‰
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 1.5;
        for (let r = 15; r <= 100; r += 15) {
            ctx.beginPath();
            ctx.arc(wallX2, centerY, r, -0.3, 0.3);
            ctx.stroke();
        }
        
        // ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#2e7d32';
        ctx.font = 'bold 13px sans-serif';
        ctx.fillText('æ³¢é•·ï¼šé•·ã„', 15, 235);
        ctx.fillText('â†’ å›æŠ˜ã—ã‚„ã™ã„', 100, 235);
        
        ctx.fillStyle = '#c2185b';
        ctx.fillText('æ³¢é•·ï¼šçŸ­ã„', halfW + 45, 235);
        ctx.fillText('â†’ ç›´é€²ã—ã‚„ã™ã„', halfW + 130, 235);
    }
    
    // å•é¡Œ1ã®å›³
    function drawProblem1() {
        const canvas = document.getElementById('problem1Canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#f5f5f5';
        ctx.fillRect(0, 0, W, H);
        
        const surfaceY = 200;
        ctx.fillStyle = '#e0e0e0';
        ctx.fillRect(50, surfaceY, 350, 15);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(50, surfaceY);
        ctx.lineTo(400, surfaceY);
        ctx.stroke();
        
        const theta = Math.PI / 4;
        const Ax = 130, Ay = surfaceY;
        const waveLen = 80;
        
        const Bx = Ax + waveLen * Math.cos(theta);
        const By = Ay - waveLen * Math.sin(theta);
        
        // æ³¢é¢AB
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(Ax, Ay);
        ctx.lineTo(Bx, By);
        ctx.stroke();
        
        // æ³•ç·š
        ctx.setLineDash([5, 5]);
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(Ax, surfaceY);
        ctx.lineTo(Ax, 50);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // é€²è¡Œæ–¹å‘
        const dirX = Math.sin(theta);
        const dirY = Math.cos(theta);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        drawArrow(ctx, (Ax+Bx)/2 - 30*dirX, (Ay+By)/2 - 30*dirY, 
                       (Ax+Bx)/2 + 20*dirX, (Ay+By)/2 + 20*dirY);
        
        // å…¥å°„è§’
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.arc(Ax, surfaceY, 30, -Math.PI/2, -Math.PI/2 + theta, false);
        ctx.stroke();
        ctx.fillStyle = '#e91e63';
        ctx.font = '16px sans-serif';
        ctx.fillText('i', Ax + 12, surfaceY - 38);
        
        // ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#2196f3';
        ctx.font = 'bold 14px sans-serif';
        ctx.fillText('A', Ax - 18, Ay + 20);
        ctx.fillText('B', Bx + 10, By - 5);
        
        ctx.fillStyle = '#666';
        ctx.font = '13px sans-serif';
        ctx.fillText('åå°„é¢', 330, surfaceY + 12);
    }
    
    // ============================
    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    // ============================
    
    // --- åå°„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ---
    let reflectSim = {
        canvas: null, ctx: null,
        running: false, paused: false,
        time: 0, maxTime: 2.5,
        angle: 45, waveCount: 5, speed: 1,
        animId: null
    };
    
    function initReflectionSim() {
        reflectSim.canvas = document.getElementById('reflectionCanvas');
        if (!reflectSim.canvas) return;
        
        reflectSim.canvas.width = reflectSim.canvas.parentElement.clientWidth;
        reflectSim.canvas.height = 400;
        reflectSim.ctx = reflectSim.canvas.getContext('2d');
        
        document.getElementById('reflectAngleSlider').oninput = function() {
            reflectSim.angle = parseFloat(this.value);
            document.getElementById('reflectAngleDisplay').textContent = this.value + 'Â°';
            if (!reflectSim.running) drawReflectionFrame();
        };
        document.getElementById('reflectWaveCountSlider').oninput = function() {
            reflectSim.waveCount = parseInt(this.value);
            document.getElementById('reflectWaveCountDisplay').textContent = this.value + 'å€‹';
            if (!reflectSim.running) drawReflectionFrame();
        };
        document.getElementById('reflectSpeedSlider').oninput = function() {
            reflectSim.speed = parseFloat(this.value);
            document.getElementById('reflectSpeedDisplay').textContent = this.value + 'x';
        };
        
        document.getElementById('reflectStartBtn').onclick = startReflectionSim;
        document.getElementById('reflectPauseBtn').onclick = pauseReflectionSim;
        document.getElementById('reflectResetBtn').onclick = resetReflectionSim;
        
        drawReflectionFrame();
    }
    
    function startReflectionSim() {
        if (reflectSim.paused) {
            reflectSim.paused = false;
            animateReflection();
            return;
        }
        reflectSim.running = true;
        reflectSim.paused = false;
        reflectSim.time = 0;
        animateReflection();
    }
    
    function pauseReflectionSim() {
        reflectSim.paused = true;
        if (reflectSim.animId) cancelAnimationFrame(reflectSim.animId);
    }
    
    function resetReflectionSim() {
        reflectSim.running = false;
        reflectSim.paused = false;
        reflectSim.time = 0;
        if (reflectSim.animId) cancelAnimationFrame(reflectSim.animId);
        drawReflectionFrame();
    }
    
    function animateReflection() {
        if (!reflectSim.running || reflectSim.paused) return;
        reflectSim.time += 0.016 * reflectSim.speed;
        drawReflectionFrame();
        if (reflectSim.time < reflectSim.maxTime) {
            reflectSim.animId = requestAnimationFrame(animateReflection);
        } else {
            reflectSim.running = false;
        }
    }
    
    function drawReflectionFrame() {
        const ctx = reflectSim.ctx;
        const W = reflectSim.canvas.width;
        const H = reflectSim.canvas.height;
        const t = reflectSim.time;
        const theta = reflectSim.angle * Math.PI / 180;
        const n = reflectSim.waveCount;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#fafafa';
        ctx.fillRect(0, 0, W, H);
        
        // åå°„é¢
        const surfaceY = H * 0.7;
        ctx.fillStyle = '#e0e0e0';
        ctx.fillRect(0, surfaceY, W, H - surfaceY);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, surfaceY);
        ctx.lineTo(W, surfaceY);
        ctx.stroke();
        
        // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        const v = 120;  // æ³¢ã®é€Ÿåº¦
        const waveLen = 120;  // æ³¢é¢ã®é•·ã•
        
        // ç‚¹Aã®åˆæœŸä½ç½®ï¼ˆå¢ƒç•Œé¢ã«æœ€åˆã«åˆ°é”ã™ã‚‹ç‚¹ï¼‰
        const Ax0 = W * 0.25;
        const Ay = surfaceY;
        
        // ç‚¹Bã®åˆæœŸä½ç½®
        const Bx0 = Ax0 + waveLen * Math.cos(theta);
        const By0 = Ay - waveLen * Math.sin(theta);
        
        // æ³¢é¢ã®é€²è¡Œæ–¹å‘ï¼ˆæ³•ç·šæ–¹å‘ï¼‰
        const dirX = Math.sin(theta);
        const dirY = Math.cos(theta);
        
        // ç‚¹AãŒå¢ƒç•Œé¢ã«åˆ°é”ã™ã‚‹æ™‚åˆ»ï¼ˆt=0ã¨ã™ã‚‹ï¼‰
        // ç‚¹BãŒå¢ƒç•Œé¢ã«åˆ°é”ã™ã‚‹æ™‚åˆ»
        const tB = waveLen * Math.sin(theta) / v;
        
        // ç¾åœ¨ã®æ™‚åˆ»ã§ã®çŠ¶æ…‹
        // t < 0: å…¨ä½“ãŒç§»å‹•ä¸­
        // 0 <= t < tB: Aã¯å¢ƒç•Œé¢ä¸Šã€Bã¯ç§»å‹•ä¸­
        // t >= tB: å…¨ä½“ãŒåå°„å®Œäº†
        
        // å…¥å°„æ³¢é¢ã®æç”»
        const waveOffset = v * t;
        
        if (t < tB) {
            // å…¥å°„æ³¢é¢ã®ä¸€éƒ¨ãŒã¾ã å¢ƒç•Œé¢ã«é”ã—ã¦ã„ãªã„
            ctx.strokeStyle = '#2196f3';
            ctx.lineWidth = 3;
            
            // å¢ƒç•Œé¢ã«é”ã—ãŸéƒ¨åˆ†ã¨é”ã—ã¦ã„ãªã„éƒ¨åˆ†ã‚’è¨ˆç®—
            const arrivedFrac = Math.min(1, t / tB);
            
            // é”ã—ã¦ã„ãªã„éƒ¨åˆ†ã®æ³¢é¢
            const Bx_now = Bx0 + waveOffset * dirX;
            const By_now = By0 + waveOffset * dirY;
            
            // å¢ƒç•Œé¢ã¨ã®äº¤ç‚¹
            const intersectX = Ax0 + (t / tB) * waveLen * Math.cos(theta);
            
            if (By_now < surfaceY) {
                ctx.beginPath();
                ctx.moveTo(intersectX, surfaceY);
                ctx.lineTo(Bx_now, By_now);
                ctx.stroke();
            }
        }
        
        // ç´ å…ƒæ³¢ã®æç”»
        // å¢ƒç•Œé¢ä¸Šã®å„ç‚¹ã«ã¤ã„ã¦ã€åˆ°é”æ™‚åˆ»ã‚’è¨ˆç®—ã—ã€ç´ å…ƒæ³¢ã‚’æç”»
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 1.5;
        
        const arrivedPoints = [];
        for (let i = 0; i < n; i++) {
            const frac = i / (n - 1);
            const arrivalTime = frac * tB;  // ã“ã®ç‚¹ãŒå¢ƒç•Œé¢ã«åˆ°é”ã™ã‚‹æ™‚åˆ»
            
            if (t >= arrivalTime) {
                const px = Ax0 + frac * waveLen * Math.cos(theta);
                const elapsed = t - arrivalTime;
                const radius = v * elapsed;
                
                arrivedPoints.push({ x: px, radius: radius, arrivalTime: arrivalTime });
                
                // ç´ å…ƒæ³¢ï¼ˆä¸ŠåŠåˆ†ã®ã¿ï¼‰
                if (radius > 0) {
                    ctx.beginPath();
                    ctx.arc(px, surfaceY, radius, -Math.PI, 0);
                    ctx.stroke();
                }
                
                // æ³¢æºç‚¹
                ctx.fillStyle = '#e91e63';
                ctx.beginPath();
                ctx.arc(px, surfaceY, 4, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // åå°„æ³¢é¢ï¼ˆåŒ…çµ¡ç·šï¼‰ã®æç”»
        if (arrivedPoints.length >= 2) {
            const first = arrivedPoints[0];
            const last = arrivedPoints[arrivedPoints.length - 1];
            
            if (first.radius > 5 && last.radius > 0) {
                // æ¥ç·šã®è¨ˆç®—
                // å„ç´ å…ƒæ³¢ã¸ã®å…±é€šæ¥ç·š
                const Apx = first.x + first.radius * Math.sin(theta);
                const Apy = surfaceY - first.radius * Math.cos(theta);
                const Bpx = last.x + last.radius * Math.sin(theta);
                const Bpy = surfaceY - last.radius * Math.cos(theta);
                
                if (Apy < surfaceY && Bpy < surfaceY) {
                    ctx.strokeStyle = '#4caf50';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(Apx, Apy);
                    ctx.lineTo(Bpx, Bpy);
                    ctx.stroke();
                    
                    // åå°„æ³¢ã®é€²è¡Œæ–¹å‘
                    if (t > tB * 0.5) {
                        const midX = (Apx + Bpx) / 2;
                        const midY = (Apy + Bpy) / 2;
                        ctx.strokeStyle = '#333';
                        ctx.lineWidth = 2;
                        drawArrow(ctx, midX - 30*Math.sin(theta), midY - 30*Math.cos(theta),
                                       midX + 30*Math.sin(theta), midY + 30*Math.cos(theta));
                    }
                }
            }
        }
        
        // ãƒ©ãƒ™ãƒ«ã¨æƒ…å ±
        ctx.fillStyle = '#333';
        ctx.font = '16px sans-serif';
        ctx.fillText(`å…¥å°„è§’ i = ${reflectSim.angle}Â°`, 20, 30);
        ctx.fillText(`åå°„è§’ j = ${reflectSim.angle}Â°`, 20, 55);
        
        // å‡¡ä¾‹
        const legendX = W - 140;
        ctx.fillStyle = '#2196f3';
        ctx.fillRect(legendX, 15, 20, 3);
        ctx.fillStyle = '#333';
        ctx.font = '12px sans-serif';
        ctx.fillText('å…¥å°„æ³¢é¢', legendX + 25, 20);
        
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(legendX + 10, 40, 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#333';
        ctx.fillText('ç´ å…ƒæ³¢', legendX + 25, 45);
        
        ctx.fillStyle = '#4caf50';
        ctx.fillRect(legendX, 58, 20, 3);
        ctx.fillStyle = '#333';
        ctx.fillText('åå°„æ³¢é¢', legendX + 25, 63);
    }
    
    // --- å±ˆæŠ˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ---
    let refractSim = {
        canvas: null, ctx: null,
        running: false, paused: false,
        time: 0, maxTime: 2.5,
        angle: 45, n2: 1.5, waveCount: 5, speed: 1,
        animId: null
    };
    
    function initRefractionSim() {
        refractSim.canvas = document.getElementById('refractionCanvas');
        if (!refractSim.canvas) return;
        
        refractSim.canvas.width = refractSim.canvas.parentElement.clientWidth;
        refractSim.canvas.height = 450;
        refractSim.ctx = refractSim.canvas.getContext('2d');
        
        document.getElementById('refractAngleSlider').oninput = function() {
            refractSim.angle = parseFloat(this.value);
            document.getElementById('refractAngleDisplay').textContent = this.value + 'Â°';
            if (!refractSim.running) drawRefractionFrame();
        };
        document.getElementById('refractIndexSlider').oninput = function() {
            refractSim.n2 = parseFloat(this.value);
            document.getElementById('refractIndexDisplay').textContent = this.value;
            if (!refractSim.running) drawRefractionFrame();
        };
        document.getElementById('refractWaveCountSlider').oninput = function() {
            refractSim.waveCount = parseInt(this.value);
            document.getElementById('refractWaveCountDisplay').textContent = this.value + 'å€‹';
            if (!refractSim.running) drawRefractionFrame();
        };
        document.getElementById('refractSpeedSlider').oninput = function() {
            refractSim.speed = parseFloat(this.value);
            document.getElementById('refractSpeedDisplay').textContent = this.value + 'x';
        };
        
        document.getElementById('refractStartBtn').onclick = startRefractionSim;
        document.getElementById('refractPauseBtn').onclick = pauseRefractionSim;
        document.getElementById('refractResetBtn').onclick = resetRefractionSim;
        
        drawRefractionFrame();
    }
    
    function startRefractionSim() {
        if (refractSim.paused) {
            refractSim.paused = false;
            animateRefraction();
            return;
        }
        refractSim.running = true;
        refractSim.paused = false;
        refractSim.time = 0;
        animateRefraction();
    }
    
    function pauseRefractionSim() {
        refractSim.paused = true;
        if (refractSim.animId) cancelAnimationFrame(refractSim.animId);
    }
    
    function resetRefractionSim() {
        refractSim.running = false;
        refractSim.paused = false;
        refractSim.time = 0;
        if (refractSim.animId) cancelAnimationFrame(refractSim.animId);
        drawRefractionFrame();
    }
    
    function animateRefraction() {
        if (!refractSim.running || refractSim.paused) return;
        refractSim.time += 0.016 * refractSim.speed;
        drawRefractionFrame();
        if (refractSim.time < refractSim.maxTime) {
            refractSim.animId = requestAnimationFrame(animateRefraction);
        } else {
            refractSim.running = false;
        }
    }
    
    function drawRefractionFrame() {
        const ctx = refractSim.ctx;
        const W = refractSim.canvas.width;
        const H = refractSim.canvas.height;
        const t = refractSim.time;
        const theta1 = refractSim.angle * Math.PI / 180;
        const n2 = refractSim.n2;
        const n = refractSim.waveCount;
        
        ctx.clearRect(0, 0, W, H);
        
        // å¢ƒç•Œé¢
        const boundaryY = H * 0.42;
        
        // åª’è³ªâ… ï¼ˆä¸Šï¼‰
        ctx.fillStyle = '#e3f2fd';
        ctx.fillRect(0, 0, W, boundaryY);
        
        // åª’è³ªâ…¡ï¼ˆä¸‹ï¼‰
        ctx.fillStyle = '#fff3e0';
        ctx.fillRect(0, boundaryY, W, H - boundaryY);
        
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, boundaryY);
        ctx.lineTo(W, boundaryY);
        ctx.stroke();
        
        // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        const v1 = 120;  // åª’è³ªâ… ã§ã®é€Ÿåº¦
        const v2 = v1 / n2;  // åª’è³ªâ…¡ã§ã®é€Ÿåº¦
        const waveLen = 100;
        
        // å±ˆæŠ˜è§’ã®è¨ˆç®—
        const sinTheta2 = Math.sin(theta1) / n2;
        const theta2 = Math.abs(sinTheta2) <= 1 ? Math.asin(sinTheta2) : Math.PI / 2;
        
        // ç‚¹Aã®ä½ç½®ï¼ˆå¢ƒç•Œé¢ã«æœ€åˆã«åˆ°é”ï¼‰
        const Ax = W * 0.25;
        const Ay = boundaryY;
        
        // ç‚¹BãŒå¢ƒç•Œé¢ã«åˆ°é”ã™ã‚‹ã¾ã§ã®æ™‚é–“
        const tB = waveLen * Math.sin(theta1) / v1;
        
        // å…¥å°„æ³¢é¢ã®æç”»
        if (t < tB) {
            ctx.strokeStyle = '#2196f3';
            ctx.lineWidth = 3;
            
            const Bx_now = Ax + waveLen * Math.cos(theta1) + v1 * t * Math.sin(theta1);
            const By_now = boundaryY - waveLen * Math.sin(theta1) + v1 * t * Math.cos(theta1);
            const intersectX = Ax + (t / tB) * waveLen * Math.cos(theta1);
            
            if (By_now < boundaryY) {
                ctx.beginPath();
                ctx.moveTo(intersectX, boundaryY);
                ctx.lineTo(Bx_now, By_now);
                ctx.stroke();
            }
        }
        
        // ç´ å…ƒæ³¢ã®æç”»ï¼ˆåª’è³ªâ…¡å†…ï¼‰
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 1.5;
        
        const arrivedPoints = [];
        for (let i = 0; i < n; i++) {
            const frac = i / (n - 1);
            const arrivalTime = frac * tB;
            
            if (t >= arrivalTime) {
                const px = Ax + frac * waveLen * Math.cos(theta1);
                const elapsed = t - arrivalTime;
                const radius = v2 * elapsed;  // åª’è³ªâ…¡ã®é€Ÿåº¦ã§åºƒãŒã‚‹
                
                arrivedPoints.push({ x: px, radius: radius });
                
                // ç´ å…ƒæ³¢ï¼ˆä¸‹åŠåˆ†ã®ã¿ï¼‰
                if (radius > 0) {
                    ctx.beginPath();
                    ctx.arc(px, boundaryY, radius, 0, Math.PI);
                    ctx.stroke();
                }
                
                // æ³¢æºç‚¹
                ctx.fillStyle = '#e91e63';
                ctx.beginPath();
                ctx.arc(px, boundaryY, 4, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // å±ˆæŠ˜æ³¢é¢ï¼ˆåŒ…çµ¡ç·šï¼‰ã®æç”»
        if (arrivedPoints.length >= 2) {
            const first = arrivedPoints[0];
            const last = arrivedPoints[arrivedPoints.length - 1];
            
            if (first.radius > 5 && last.radius > 0) {
                const Apx = first.x + first.radius * Math.sin(theta2);
                const Apy = boundaryY + first.radius * Math.cos(theta2);
                const Bpx = last.x + last.radius * Math.sin(theta2);
                const Bpy = boundaryY + last.radius * Math.cos(theta2);
                
                if (Apy > boundaryY && Bpy > boundaryY && Apy < H && Bpy < H) {
                    ctx.strokeStyle = '#4caf50';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(Apx, Apy);
                    ctx.lineTo(Bpx, Bpy);
                    ctx.stroke();
                    
                    // å±ˆæŠ˜æ³¢ã®é€²è¡Œæ–¹å‘
                    if (t > tB * 0.5) {
                        const midX = (Apx + Bpx) / 2;
                        const midY = (Apy + Bpy) / 2;
                        ctx.strokeStyle = '#333';
                        ctx.lineWidth = 2;
                        drawArrow(ctx, midX - 25*Math.sin(theta2), midY - 25*Math.cos(theta2),
                                       midX + 30*Math.sin(theta2), midY + 30*Math.cos(theta2));
                    }
                }
            }
        }
        
        // æƒ…å ±è¡¨ç¤º
        const theta2Deg = (theta2 * 180 / Math.PI).toFixed(1);
        ctx.fillStyle = '#333';
        ctx.font = '16px sans-serif';
        ctx.fillText(`å…¥å°„è§’ Î¸â‚ = ${refractSim.angle}Â°`, 20, 30);
        ctx.fillText(`å±ˆæŠ˜è§’ Î¸â‚‚ = ${theta2Deg}Â°`, 20, 55);
        ctx.fillText(`å±ˆæŠ˜ç‡ nâ‚‚ = ${n2.toFixed(1)}`, 20, 80);
        
        // åª’è³ªãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#1976d2';
        ctx.font = '14px sans-serif';
        ctx.fillText('åª’è³ªâ… ï¼ˆnâ‚ = 1.0ï¼‰', W - 150, 30);
        ctx.fillStyle = '#e65100';
        ctx.fillText(`åª’è³ªâ…¡ï¼ˆnâ‚‚ = ${n2.toFixed(1)}ï¼‰`, W - 150, boundaryY + 30);
        
        // å‡¡ä¾‹
        const legendX = 20;
        const legendY = H - 80;
        ctx.fillStyle = '#2196f3';
        ctx.fillRect(legendX, legendY, 20, 3);
        ctx.fillStyle = '#333';
        ctx.font = '12px sans-serif';
        ctx.fillText('å…¥å°„æ³¢é¢', legendX + 25, legendY + 5);
        
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(legendX + 10, legendY + 25, 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#333';
        ctx.fillText('ç´ å…ƒæ³¢ï¼ˆåª’è³ªâ…¡ï¼‰', legendX + 25, legendY + 30);
        
        ctx.fillStyle = '#4caf50';
        ctx.fillRect(legendX, legendY + 43, 20, 3);
        ctx.fillStyle = '#333';
        ctx.fillText('å±ˆæŠ˜æ³¢é¢', legendX + 25, legendY + 48);
    }
    
    // --- å›æŠ˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ---
    let diffractSim = {
        canvas: null, ctx: null,
        running: false, paused: false,
        time: 0,
        wavelength: 40, slitWidth: 80, speed: 1,
        animId: null
    };
    
    function initDiffractionSim() {
        diffractSim.canvas = document.getElementById('diffractionSimCanvas');
        if (!diffractSim.canvas) return;
        
        diffractSim.canvas.width = diffractSim.canvas.parentElement.clientWidth;
        diffractSim.canvas.height = 400;
        diffractSim.ctx = diffractSim.canvas.getContext('2d');
        
        document.getElementById('diffractWavelengthSlider').oninput = function() {
            diffractSim.wavelength = parseInt(this.value);
            document.getElementById('diffractWavelengthDisplay').textContent = this.value + ' px';
            if (!diffractSim.running) drawDiffractionSimFrame();
        };
        document.getElementById('diffractSlitSlider').oninput = function() {
            diffractSim.slitWidth = parseInt(this.value);
            document.getElementById('diffractSlitDisplay').textContent = this.value + ' px';
            if (!diffractSim.running) drawDiffractionSimFrame();
        };
        document.getElementById('diffractSpeedSlider').oninput = function() {
            diffractSim.speed = parseFloat(this.value);
            document.getElementById('diffractSpeedDisplay').textContent = this.value + 'x';
        };
        
        document.getElementById('diffractStartBtn').onclick = startDiffractionSim;
        document.getElementById('diffractPauseBtn').onclick = pauseDiffractionSim;
        document.getElementById('diffractResetBtn').onclick = resetDiffractionSim;
        
        drawDiffractionSimFrame();
    }
    
    function startDiffractionSim() {
        if (diffractSim.paused) {
            diffractSim.paused = false;
            animateDiffraction();
            return;
        }
        diffractSim.running = true;
        diffractSim.paused = false;
        diffractSim.time = 0;
        animateDiffraction();
    }
    
    function pauseDiffractionSim() {
        diffractSim.paused = true;
        if (diffractSim.animId) cancelAnimationFrame(diffractSim.animId);
    }
    
    function resetDiffractionSim() {
        diffractSim.running = false;
        diffractSim.paused = false;
        diffractSim.time = 0;
        if (diffractSim.animId) cancelAnimationFrame(diffractSim.animId);
        drawDiffractionSimFrame();
    }
    
    function animateDiffraction() {
        if (!diffractSim.running || diffractSim.paused) return;
        diffractSim.time += 0.03 * diffractSim.speed;
        drawDiffractionSimFrame();
        diffractSim.animId = requestAnimationFrame(animateDiffraction);
    }
    
    function drawDiffractionSimFrame() {
        const ctx = diffractSim.ctx;
        const W = diffractSim.canvas.width;
        const H = diffractSim.canvas.height;
        const t = diffractSim.time;
        const lambda = diffractSim.wavelength;
        const slitW = diffractSim.slitWidth;
        
        ctx.clearRect(0, 0, W, H);
        ctx.fillStyle = '#fafafa';
        ctx.fillRect(0, 0, W, H);
        
        // éšœå®³ç‰©
        const wallX = W * 0.32;
        const slitCenterY = H / 2;
        
        ctx.fillStyle = '#424242';
        ctx.fillRect(wallX - 10, 0, 20, slitCenterY - slitW / 2);
        ctx.fillRect(wallX - 10, slitCenterY + slitW / 2, 20, H - slitCenterY - slitW / 2);
        
        // ã‚¹ãƒªãƒƒãƒˆ
        ctx.fillStyle = '#fff9c4';
        ctx.fillRect(wallX - 10, slitCenterY - slitW / 2, 20, slitW);
        
        // å…¥å°„æ³¢ï¼ˆå¹³é¢æ³¢ï¼‰
        ctx.strokeStyle = '#2196f3';
        ctx.lineWidth = 2;
        const waveSpeed = 80;
        const phaseOffset = (t * waveSpeed) % lambda;
        
        for (let x = phaseOffset; x < wallX - 10; x += lambda) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, H);
            ctx.stroke();
        }
        
        // ã‚¹ãƒªãƒƒãƒˆé€šéå¾Œã®ç´ å…ƒæ³¢
        if (diffractSim.running || t > 0) {
            const numSources = Math.max(3, Math.ceil(slitW / 20));
            const sources = [];
            for (let i = 0; i < numSources; i++) {
                sources.push(slitCenterY - slitW / 2 + (i + 0.5) * slitW / numSources);
            }
            
            // ç´ å…ƒæ³¢ã‚’æç”»
            ctx.strokeStyle = 'rgba(233, 30, 99, 0.6)';
            ctx.lineWidth = 1.5;
            
            const maxRadius = (W - wallX) * 1.2;
            for (let phase = phaseOffset; phase < maxRadius; phase += lambda) {
                sources.forEach(sourceY => {
                    if (phase > 0) {
                        ctx.beginPath();
                        ctx.arc(wallX, sourceY, phase, -Math.PI / 2, Math.PI / 2);
                        ctx.stroke();
                    }
                });
            }
            
            // ç´ å…ƒæ³¢æºã®ç‚¹
            ctx.fillStyle = '#e91e63';
            sources.forEach(y => {
                ctx.beginPath();
                ctx.arc(wallX, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }
        
        // æƒ…å ±è¡¨ç¤º
        ctx.fillStyle = '#333';
        ctx.font = '16px sans-serif';
        ctx.fillText(`æ³¢é•· Î» = ${lambda} px`, 20, 30);
        ctx.fillText(`ã‚¹ãƒªãƒƒãƒˆå¹… d = ${slitW} px`, 20, 55);
        
        const ratio = (lambda / slitW).toFixed(2);
        ctx.fillText(`Î»/d = ${ratio}`, 20, 80);
        
        let description, color;
        if (ratio > 0.5) {
            description = 'â†’ å›æŠ˜ãŒé¡•è‘—';
            color = '#2e7d32';
        } else if (ratio > 0.2) {
            description = 'â†’ ä¸­ç¨‹åº¦ã®å›æŠ˜';
            color = '#f57c00';
        } else {
            description = 'â†’ å›æŠ˜ãŒå°ã•ã„';
            color = '#c62828';
        }
        ctx.fillStyle = color;
        ctx.fillText(description, 20, 105);
        
        // å‡¡ä¾‹
        const legendX = W - 130;
        ctx.fillStyle = '#2196f3';
        ctx.fillRect(legendX, 15, 20, 3);
        ctx.fillStyle = '#333';
        ctx.font = '12px sans-serif';
        ctx.fillText('å…¥å°„æ³¢', legendX + 25, 20);
        
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(legendX + 10, 40, 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#333';
        ctx.fillText('ç´ å…ƒæ³¢', legendX + 25, 45);
    }
    
    // ============================
    // åˆæœŸåŒ–
    // ============================
    window.onload = function() {
        drawHuygensBasic();
        drawReflectStep1();
        drawReflectStep2();
        drawReflectStep3();
        drawReflectStep4();
        drawRefractStep1();
        drawRefractStep2();
        drawRefractStep3();
        drawRefractStep4();
        drawDiffraction();
        drawDiffractionCompare();
        drawProblem1();
    };
    
    window.addEventListener('resize', function() {
        if (document.getElementById('simulation').classList.contains('active')) {
            initReflectionSim();
            initRefractionSim();
            initDiffractionSim();
        }
    });
    </script>
</body>
</html>