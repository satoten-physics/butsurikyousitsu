<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ ¡ç‰©ç† - éŸ³ã®åå°„ãƒ»å±ˆæŠ˜</title>
    <script>
      window.MathJax = {
      tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
     }
     };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        h1 {
            color: #333;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        .tab-btn:hover {
            background: #8899f0;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        h3 {
            color: #555;
            margin: 25px 0 15px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #667eea;
        }
        p {
            line-height: 1.8;
            margin-bottom: 15px;
        }
        .formula-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }
        .formula-box h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .point-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .point-box::before {
            content: "ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ";
            font-weight: bold;
            color: #856404;
            display: block;
            margin-bottom: 10px;
        }
        .review-link {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            margin: 5px;
            transition: all 0.3s;
        }
        .review-link:hover {
            background: #1976d2;
            color: white;
        }
        .review-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        /* é™çš„å›³è§£ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .diagram-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin: 25px 0;
        }
        .diagram-box {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-width: 280px;
            max-width: 400px;
        }
        .diagram-box h5 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .diagram-canvas {
            display: block;
            margin: 0 auto;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        .diagram-caption {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }
        
        /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #sim-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        #physicsCanvas {
            display: block;
            width: 100%;
            background: white;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
        .sim-controls {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .sim-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .sim-button.start {
            background: #4CAF50;
            color: white;
        }
        .sim-button.start:hover {
            background: #45a049;
        }
        .sim-button.reset {
            background: #f44336;
            color: white;
        }
        .sim-button.reset:hover {
            background: #da190b;
        }
        .info-panel {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        .info-panel h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #c8e6c9;
        }
        .info-item:last-child {
            border-bottom: none;
        }
        
        /* å•é¡Œã‚¿ãƒ–ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .problem {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }
        .problem h4 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .problem p {
            margin-bottom: 10px;
        }
        details {
            background: #fff;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px solid #ddd;
        }
        summary {
            cursor: pointer;
            font-weight: bold;
            color: #667eea;
            padding: 5px;
        }
        summary:hover {
            color: #764ba2;
        }
        .solution {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            header, .container {
                padding: 15px;
            }
            .tab-btn {
                min-width: 100px;
                font-size: 14px;
            }
            .diagram-container {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="back-link">â† ç›®æ¬¡ã«æˆ»ã‚‹</a>
        <h1>éŸ³ã®åå°„ãƒ»å±ˆæŠ˜</h1>
    </header>
    <div class="container">
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('lecture')">è§£èª¬ç·¨</button>
            <button class="tab-btn" onclick="openTab('problem')">å•é¡Œç·¨</button>
            <button class="tab-btn" onclick="openTab('simulation')">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>
        
        <div id="lecture" class="tab-content active">
            <h2>éŸ³ã®åå°„ãƒ»å±ˆæŠ˜</h2>
            
            <h3>éŸ³ã¯æ³¢ã§ã‚ã‚‹</h3>
            <p>
                éŸ³ã¯ç‰©è³ªä¸­ã‚’ä¼ã‚ã‚‹<strong>ç¸¦æ³¢</strong>ã§ã‚ã‚Šã€æ³¢å‹•ã®ä¸€ç¨®ã§ã™ã€‚
                ãã®ãŸã‚ã€1ç¯€ã§å­¦ã‚“ã æ³¢ã®å…±é€šã®æ€§è³ªã§ã‚ã‚‹<strong>åå°„ãƒ»å±ˆæŠ˜ãƒ»å›æŠ˜ãƒ»å¹²æ¸‰</strong>ãŒã™ã¹ã¦èµ·ãã¾ã™ã€‚
            </p>
            
            <div class="review-box">
                <p><strong>ğŸ“š å¾©ç¿’ãŒå¿…è¦ãªæ–¹ã¯ã“ã¡ã‚‰ï¼š</strong></p>
                <a href="æ³¢ç‰¹æœ‰ã®æ€§è³ª(æ³¢ãŒã¶ã¤ã‹ã£ãŸã‚‰ 1).html" class="review-link">ğŸ”„ åå°„ã®æ³•å‰‡ã‚’å¾©ç¿’</a>
                <a href="æ³¢ç‰¹æœ‰ã®æ€§è³ª(æ³¢ãŒã¶ã¤ã‹ã£ãŸã‚‰ 1).html" class="review-link">â†—ï¸ å±ˆæŠ˜ã®æ³•å‰‡ã‚’å¾©ç¿’</a>
            </div>
            
            <h3>åå°„ãƒ»å±ˆæŠ˜ã®æ³•å‰‡ï¼ˆç¢ºèªï¼‰</h3>
            
            <div class="formula-box">
                <h4>åå°„ã®æ³•å‰‡</h4>
                <p>éŸ³æ³¢ãŒåª’è³ªã®çŠ¶æ…‹ãŒæ€¥ã«å¤‰åŒ–ã™ã‚‹å¢ƒç•Œé¢ã«å…¥å°„ã—ãŸã¨ãã€åå°„ãŒèµ·ãã¾ã™ã€‚ã“ã®ã¨ãï¼š</p>
                $$ \theta = \theta' $$
                <p style="margin-top:10px;">ï¼ˆå…¥å°„è§’ $\theta$ ï¼ åå°„è§’ $\theta'$ï¼‰</p>
            </div>
            
            <div class="formula-box">
                <h4>å±ˆæŠ˜ã®æ³•å‰‡ï¼ˆã‚¹ãƒãƒ«ã®æ³•å‰‡ï¼‰</h4>
                <p>åª’è³ªã®çŠ¶æ…‹ãŒé•ã†å ´æ‰€ã«æ³¢ãŒå…¥å°„ã—ãŸã¨ãã€ä¸€éƒ¨ã¯åå°„ã—ã€ä¸€éƒ¨ã¯å±ˆæŠ˜ã—ã¦é€²ã¿ã¾ã™ï¼š</p>
                $$ \frac{\sin\theta_1}{\sin\theta_2} = \frac{v_1}{v_2} = \frac{\lambda_1}{\lambda_2} = \frac{n_2}{n_1} = n_{12} $$
                <p style="margin-top:10px; font-size:14px;">
                    $\theta_1$ï¼šå…¥å°„è§’ã€$\theta_2$ï¼šå±ˆæŠ˜è§’<br>
                    $v_1, v_2$ï¼šåª’è³ªâ… , â…¡ã§ã®æ³¢ã®é€Ÿã•<br>
                    $\lambda_1, \lambda_2$ï¼šåª’è³ªâ… , â…¡ã§ã®æ³¢é•·<br>
                    $n_1, n_2$ï¼šåª’è³ªâ… , â…¡ã§ã®å±ˆæŠ˜ç‡<br>
                    $n_{12}$ï¼šåª’è³ªâ… ã«å¯¾ã™ã‚‹åª’è³ªâ…¡ã®ç›¸å¯¾å±ˆæŠ˜ç‡
                </p>
            </div>
            
            <h3>æ¸©åº¦ã¨éŸ³é€Ÿã®é–¢ä¿‚</h3>
            <p>
                å…‰ã®å±ˆæŠ˜ã§ã¯ã€åª’è³ªã®ç¨®é¡ï¼ˆç©ºæ°—â†’æ°´ãªã©ï¼‰ãŒå¤‰ã‚ã‚‹ã“ã¨ã§å±ˆæŠ˜ãŒèµ·ãã¾ã—ãŸã€‚
                ã§ã¯ã€éŸ³ã®å ´åˆã¯ã©ã†ã§ã—ã‚‡ã†ã‹ï¼Ÿ
            </p>
            
            <div class="point-box">
                éŸ³é€Ÿã¯<strong>æ¸©åº¦</strong>ã«ã‚ˆã£ã¦å¤‰åŒ–ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€åŒã˜ç©ºæ°—ä¸­ã§ã‚‚<strong>æ¸©åº¦ãŒé•ãˆã°éŸ³é€ŸãŒå¤‰ã‚ã‚Š</strong>ã€å±ˆæŠ˜ãŒèµ·ã“ã‚Šã¾ã™ï¼
            </div>
            
            <p>
                ç©ºæ°—ä¸­ã®éŸ³é€Ÿã¯ã€æ¸©åº¦ $t$ [â„ƒ] ã®ã¨ãã€ãŠã‚ˆãæ¬¡ã®å¼ã§è¡¨ã•ã‚Œã¾ã™ï¼š
            </p>
            $$ v = 331.5 + 0.6t \quad \text{[m/s]} $$
            <p>
                ã“ã®å¼ã‹ã‚‰åˆ†ã‹ã‚‹ã‚ˆã†ã«ã€<strong>æ¸©åº¦ãŒé«˜ã„ã»ã©éŸ³é€Ÿã¯é€Ÿã</strong>ãªã‚Šã¾ã™ã€‚
            </p>
            
            <h3>æ˜¼ã¨å¤œã§éŸ³ã®èã“ãˆæ–¹ãŒé•ã†ç†ç”±</h3>
            <p>
                ã€Œå¤œã®æ–¹ãŒé ãã®éŸ³ãŒã‚ˆãèã“ãˆã‚‹ã€ã¨æ„Ÿã˜ãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ
                ã“ã‚Œã¯æ°—ã®ã›ã„ã§ã¯ãªãã€<strong>å±ˆæŠ˜ã®æ³•å‰‡</strong>ã§èª¬æ˜ã§ãã‚‹ç¾è±¡ã§ã™ã€‚
            </p>
            
            <div class="diagram-container">
                <div class="diagram-box">
                    <h5>â˜€ï¸ æ˜¼é–“ã®å ´åˆ</h5>
                    <canvas id="dayDiagram" class="diagram-canvas" width="350" height="250"></canvas>
                    <p class="diagram-caption">
                        åœ°è¡¨ï¼šé«˜æ¸©ï¼ˆéŸ³é€Ÿ å¤§ï¼‰<br>
                        ä¸Šç©ºï¼šä½æ¸©ï¼ˆéŸ³é€Ÿ å°ï¼‰<br>
                        â†’ éŸ³ã¯<span style="color:#e91e63; font-weight:bold;">ä¸Šå‘ã</span>ã«æ›²ãŒã‚‹<br>
                        â†’ éŸ³ãŒã€Œä¸Šã€ã«é€ƒã’ã¦ã„ã
                    </p>
                </div>
                <div class="diagram-box">
                    <h5>ğŸŒ™ å¤œé–“ã®å ´åˆ</h5>
                    <canvas id="nightDiagram" class="diagram-canvas" width="350" height="250"></canvas>
                    <p class="diagram-caption">
                        åœ°è¡¨ï¼šä½æ¸©ï¼ˆéŸ³é€Ÿ å°ï¼‰<br>
                        ä¸Šç©ºï¼šé«˜æ¸©ï¼ˆéŸ³é€Ÿ å¤§ï¼‰<br>
                        â†’ éŸ³ã¯<span style="color:#2196f3; font-weight:bold;">ä¸‹å‘ã</span>ã«æ›²ãŒã‚‹<br>
                        â†’ éŸ³ãŒã€Œå¥¥ã€ã¾ã§å±Šã
                    </p>
                </div>
            </div>
            
            <div class="point-box">
                <p><strong>å±ˆæŠ˜ã®æ³•å‰‡ã‹ã‚‰è€ƒãˆã‚‹ï¼š</strong></p>
                <p>
                    éŸ³æ³¢ã¯<strong>éŸ³é€ŸãŒé…ã„å´ï¼ˆä½æ¸©å´ï¼‰ã«æ›²ãŒã‚‹</strong>æ€§è³ªãŒã‚ã‚Šã¾ã™ã€‚
                    ã“ã‚Œã¯ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã‹ã‚‰ã‚‚ç†è§£ã§ãã¾ã™ã€‚
                </p>
                <p style="margin-top:10px;">
                    ãƒ»æ˜¼é–“ï¼šåœ°è¡¨ãŒæš–ã‹ã„ â†’ ä¸Šç©ºã®æ–¹ãŒéŸ³é€ŸãŒé…ã„ â†’ éŸ³ã¯ä¸Šã«æ›²ãŒã‚‹<br>
                    ãƒ»å¤œé–“ï¼šåœ°è¡¨ãŒå†·ãŸã„ï¼ˆæ”¾å°„å†·å´ï¼‰â†’ åœ°è¡¨ã®æ–¹ãŒéŸ³é€ŸãŒé…ã„ â†’ éŸ³ã¯ä¸‹ã«æ›²ãŒã‚‹
                </p>
            </div>
            
            <h3>å†¬ã«éŸ³ãŒã‚ˆãéŸ¿ãç†ç”±</h3>
            <p>
                å†¬ã¯å¤ã«æ¯”ã¹ã¦æ°—æ¸©ãŒä½ã„ãŸã‚ã€éŸ³é€Ÿè‡ªä½“ã¯é…ããªã‚Šã¾ã™ã€‚
                ã—ã‹ã—ã€å†¬ã®å¤œé–“ã¯<strong>æ”¾å°„å†·å´</strong>ã«ã‚ˆã‚Šåœ°è¡¨ä»˜è¿‘ã®æ°—æ¸©ãŒç‰¹ã«ä¸‹ãŒã‚Šã‚„ã™ãã€
                æ¸©åº¦å‹¾é…ãŒå¤§ãããªã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€éŸ³ãŒåœ°è¡¨å´ã«å¼·ãå±ˆæŠ˜ã—ã€é ãã¾ã§å±Šãã‚„ã™ããªã‚‹ã®ã§ã™ã€‚
            </p>
            
            <h3>æˆæ¥­è³‡æ–™</h3>
            <iframe src="https://drive.google.com/file/d/1rd3AUHNkj-NLM0IEztEdsiVOdPwxD6EA/preview" width="100%" height="500"></iframe>
        </div>
        
        <div id="problem" class="tab-content">
            <h2>ç¢ºèªå•é¡Œ</h2>
            
            <div class="problem">
                <h4>å•é¡Œ1ï¼šåéŸ¿éŸ³ã¨è·é›¢ã®è¨ˆç®—</h4>
                <p>
                    èˆ¹ã®å‰æ–¹ã«ã‚ã‚‹é™æ­¢ã—ã¦ã„ã‚‹æ°·å±±ã¾ã§ã®è·é›¢ã‚’ã¯ã‹ã‚‹ãŸã‚ã«ã€èˆ¹ä¸Šã§æ±½ç¬›ã‚’é³´ã‚‰ã—ãŸã‚‰
                    <strong>4.0ç§’å¾Œ</strong>ã«åéŸ¿éŸ³ãŒèã“ãˆãŸã€‚
                    éŸ³ã®é€Ÿã•ã‚’ $3.3 \times 10^2$ m/s ã¨ã—ã¦ã€ä»¥ä¸‹ã®å•ã„ã«ç­”ãˆã‚ˆã€‚
                </p>
                <p>ï¼ˆ1ï¼‰èˆ¹ãŒé™æ­¢ã—ã¦ã„ã‚‹å ´åˆã€èˆ¹ã¨æ°·å±±ã¨ã®è·é›¢ã‚’æ±‚ã‚ã‚ˆã€‚</p>
                <p>ï¼ˆ2ï¼‰èˆ¹ãŒ 10 m/s ã®é€Ÿã•ã§æ°·å±±ã«å‘ã‹ã£ã¦é€²ã‚“ã§ã„ã‚‹å ´åˆã€æ±½ç¬›ã‚’é³´ã‚‰ã—ãŸç¬é–“ã®èˆ¹ã¨æ°·å±±ã¨ã®è·é›¢ã‚’æ±‚ã‚ã‚ˆã€‚</p>
                
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="solution">
                        <p><strong>ï¼ˆ1ï¼‰èˆ¹ãŒé™æ­¢ã—ã¦ã„ã‚‹å ´åˆ</strong></p>
                        <p>
                            éŸ³ã¯èˆ¹ã‹ã‚‰æ°·å±±ã¾ã§å¾€å¾©ã™ã‚‹ã®ã§ã€ç‰‡é“ã®è·é›¢ã‚’ $x_1$ ã¨ã™ã‚‹ã¨ï¼š
                        </p>
                        $$ 2x_1 = v \times t = 3.3 \times 10^2 \times 4.0 $$
                        $$ x_1 = \frac{3.3 \times 10^2 \times 4.0}{2} = 6.6 \times 10^2 \text{ m} $$
                        <p style="margin-top:10px;"><strong>ç­”ãˆï¼š660 mï¼ˆ$6.6 \times 10^2$ mï¼‰</strong></p>
                        
                        <hr style="margin: 20px 0; border: none; border-top: 1px dashed #ccc;">
                        
                        <p><strong>ï¼ˆ2ï¼‰èˆ¹ãŒç§»å‹•ã—ã¦ã„ã‚‹å ´åˆ</strong></p>
                        <p>
                            é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š<strong>éŸ³æºï¼ˆèˆ¹ï¼‰ãŒå‹•ã„ã¦ã‚‚ã€éŸ³ã®é€Ÿã•ã¯å¤‰ã‚ã‚‰ãªã„ï¼</strong>
                        </p>
                        <p>
                            æ±½ç¬›ã‚’é³´ã‚‰ã—ãŸç¬é–“ã®è·é›¢ã‚’ $x_2$ ã¨ã™ã‚‹ã€‚<br>
                            éŸ³ãŒæ°·å±±ã«å±Šãã¾ã§ã®æ™‚é–“ã‚’ $t_1$ã€åå°„ã—ã¦æˆ»ã£ã¦ãã‚‹ã¾ã§ã®æ™‚é–“ã‚’ $t_2$ ã¨ã™ã‚‹ã¨ï¼š
                        </p>
                        <p>ãƒ»è¡Œãï¼š$x_2 = v \cdot t_1 = 330 t_1$</p>
                        <p>ãƒ»å¸°ã‚Šï¼šèˆ¹ãŒ $t_1$ ã®é–“ã« $10t_1$ é€²ã‚“ã§ã„ã‚‹ã®ã§ã€æˆ»ã‚Šã®è·é›¢ã¯ $x_2 - 10t_1$</p>
                        $$ x_2 - 10t_1 = v \cdot t_2 = 330 t_2 $$
                        <p>ã¾ãŸã€$t_1 + t_2 = 4.0$ ã‚ˆã‚Š $t_2 = 4.0 - t_1$</p>
                        <p>$x_2 = 330 t_1$ ã‚’ä»£å…¥ï¼š</p>
                        $$ 330t_1 - 10t_1 = 330(4.0 - t_1) $$
                        $$ 320t_1 = 1320 - 330t_1 $$
                        $$ 650t_1 = 1320 $$
                        $$ t_1 = \frac{1320}{650} \approx 2.03 \text{ s} $$
                        $$ x_2 = 330 \times 2.03 \approx 6.7 \times 10^2 \text{ m} $$
                        <p style="margin-top:10px;"><strong>ç­”ãˆï¼šç´„ 670 mï¼ˆ$6.7 \times 10^2$ mï¼‰</strong></p>
                        <p style="margin-top:10px; color:#666; font-size:14px;">
                            â€» åˆ¥è§£ï¼š$2x_2 - 10 \times 4.0 = 330 \times 4.0$ ã‚ˆã‚Š $x_2 = 680$ m ã¨ã—ã¦ã‚‚å¯
                        </p>
                    </div>
                </details>
            </div>
            
            <div class="problem">
                <h4>å•é¡Œ2ï¼šéŸ³ã®å±ˆæŠ˜</h4>
                <p>
                    ç©ºæ°—ä¸­ã®éŸ³ã®é€Ÿã•ã‚’ $3.4 \times 10^2$ m/sã€æ°´ä¸­ã®éŸ³ã®é€Ÿã•ã‚’ $1.4 \times 10^3$ m/s ã¨ã™ã‚‹ã€‚
                    ç©ºæ°—ä¸­ã‹ã‚‰æ°´é¢ã«å‘ã‘ã¦éŸ³æ³¢ã‚’é€ã‚‹ã¨ã€éŸ³æ³¢ã¯æ°´ä¸­ã¸å±ˆæŠ˜ã—ã¦é€²ã‚€ã€‚
                </p>
                <p>ï¼ˆ1ï¼‰éŸ³æ³¢ãŒæ°´é¢ã«æ–œã‚ã«å…¥å°„ã—ã¦é€²ã‚€ã¨ãã€å…¥å°„è§’ã¨å±ˆæŠ˜è§’ã§ã¯ã„ãšã‚ŒãŒå¤§ãã„ã‹ã€‚</p>
                <p>ï¼ˆ2ï¼‰å…¥å°„è§’ãŒ 10Â° ã®ã¨ãã€å±ˆæŠ˜è§’ã® sin ã®å€¤ã‚’æ±‚ã‚ã‚ˆã€‚ãŸã ã—ã€$\sin 10Â° = 0.17$ ã¨ã™ã‚‹ã€‚</p>
                
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="solution">
                        <p><strong>ï¼ˆ1ï¼‰å…¥å°„è§’ã¨å±ˆæŠ˜è§’ã®å¤§å°</strong></p>
                        <p>
                            å±ˆæŠ˜ã®æ³•å‰‡ã‚ˆã‚Šï¼š
                            $$ \frac{\sin\theta_1}{\sin\theta_2} = \frac{v_1}{v_2} $$
                        </p>
                        <p>
                            æ°´ä¸­ã®æ–¹ãŒéŸ³é€ŸãŒé€Ÿã„ï¼ˆ$v_2 > v_1$ï¼‰ã®ã§ã€$\frac{v_1}{v_2} < 1$
                        </p>
                        <p>
                            ã‚ˆã£ã¦ $\sin\theta_1 < \sin\theta_2$ ã¨ãªã‚Šã€<strong>å±ˆæŠ˜è§’ã®æ–¹ãŒå¤§ãã„</strong>ã€‚
                        </p>
                        <p style="margin-top:10px;"><strong>ç­”ãˆï¼šå±ˆæŠ˜è§’</strong></p>
                        
                        <hr style="margin: 20px 0; border: none; border-top: 1px dashed #ccc;">
                        
                        <p><strong>ï¼ˆ2ï¼‰å±ˆæŠ˜è§’ã®sinã®å€¤</strong></p>
                        $$ \frac{\sin 10Â°}{\sin\theta_2} = \frac{3.4 \times 10^2}{1.4 \times 10^3} $$
                        $$ \sin\theta_2 = \frac{1.4 \times 10^3}{3.4 \times 10^2} \times \sin 10Â° $$
                        $$ \sin\theta_2 = \frac{1.4 \times 10^3}{3.4 \times 10^2} \times 0.17 $$
                        $$ \sin\theta_2 \approx 4.1 \times 0.17 \approx 0.70 $$
                        <p style="margin-top:10px;"><strong>ç­”ãˆï¼š$\sin\theta \approx 0.70$</strong></p>
                    </div>
                </details>
            </div>
            
            <div class="problem">
                <h4>å•é¡Œ3ï¼šæ˜¼å¤œã®éŸ³ã®ä¼ã‚ã‚Šæ–¹</h4>
                <p>
                    å¤œé–“ã®æ–¹ãŒæ˜¼é–“ã‚ˆã‚Šã‚‚é ãã®éŸ³ãŒã‚ˆãèã“ãˆã‚‹ã®ã¯ãªãœã‹ã€‚
                    ã€Œæ¸©åº¦ã€ã€ŒéŸ³é€Ÿã€ã€Œå±ˆæŠ˜ã€ã¨ã„ã†èªå¥ã‚’ç”¨ã„ã¦èª¬æ˜ã›ã‚ˆã€‚
                </p>
                
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="solution">
                        <p><strong>æ¨¡ç¯„è§£ç­”ï¼š</strong></p>
                        <p>
                            æ˜¼é–“ã¯åœ°è¡¨ä»˜è¿‘ã®æ¸©åº¦ãŒé«˜ãä¸Šç©ºã»ã©ä½ã„ãŸã‚ã€éŸ³é€Ÿã¯åœ°è¡¨ä»˜è¿‘ã§é€Ÿãä¸Šç©ºã§é…ã„ã€‚
                            ãã®ãŸã‚ã€éŸ³æ³¢ã¯ä¸Šå‘ãã«å±ˆæŠ˜ã—ã€åœ°è¡¨ã‹ã‚‰é›¢ã‚Œã¦ã„ãã€‚
                        </p>
                        <p>
                            ä¸€æ–¹ã€å¤œé–“ã¯æ”¾å°„å†·å´ã«ã‚ˆã‚Šåœ°è¡¨ä»˜è¿‘ã®æ¸©åº¦ãŒä¸‹ãŒã‚Šã€ä¸Šç©ºã®æ–¹ãŒæ¸©åº¦ãŒé«˜ããªã‚‹ã€‚
                            ãã®ãŸã‚ã€éŸ³é€Ÿã¯åœ°è¡¨ä»˜è¿‘ã§é…ãä¸Šç©ºã§é€Ÿããªã‚Šã€éŸ³æ³¢ã¯ä¸‹å‘ãã«å±ˆæŠ˜ã—ã¦åœ°è¡¨ã«æ²¿ã£ã¦ä¼ã‚ã‚‹ã€‚
                        </p>
                        <p>
                            çµæœã¨ã—ã¦ã€å¤œé–“ã®æ–¹ãŒéŸ³ãŒé ãã¾ã§å±Šãã‚„ã™ããªã‚‹ã€‚
                        </p>
                    </div>
                </details>
            </div>
        </div>
        
        <div id="simulation" class="tab-content">
            <h2>åéŸ¿éŸ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            <p>èˆ¹ã‹ã‚‰éŸ³ã‚’ç™ºå°„ã—ã€æ°·å±±ã§åå°„ã—ã¦æˆ»ã£ã¦ãã‚‹æ§˜å­ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚èˆ¹ã®é€Ÿåº¦ã‚’å¤‰ãˆã‚‹ã¨ã€åéŸ¿éŸ³ãŒèã“ãˆã‚‹ã¾ã§ã®æ™‚é–“ãŒã©ã†å¤‰ã‚ã‚‹ã‹ç¢ºèªã§ãã¾ã™ã€‚</p>
            
            <div id="sim-container">
                <canvas id="physicsCanvas"></canvas>
            </div>
            
            <div class="sim-controls">
                <div class="control-group">
                    <label>èˆ¹ã®é€Ÿåº¦ (v): <span class="value-display" id="vDisplay">0 m/s</span></label>
                    <input type="range" id="vSlider" min="-20" max="50" value="0" step="5">
                    <p style="font-size:12px; color:#666;">â€» æ­£ã®å€¤ï¼šæ°·å±±ã«è¿‘ã¥ãã€è² ã®å€¤ï¼šæ°·å±±ã‹ã‚‰é›¢ã‚Œã‚‹</p>
                </div>
                
                <div class="control-group">
                    <label>åˆæœŸè·é›¢ (d): <span class="value-display" id="dDisplay">500 m</span></label>
                    <input type="range" id="dSlider" min="200" max="1000" value="500" step="50">
                </div>
                
                <div class="button-group">
                    <button class="sim-button start" id="startBtn">ğŸ”Š æ±½ç¬›ã‚’é³´ã‚‰ã™</button>
                    <button class="sim-button reset" id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
                
                <div class="info-panel">
                    <h4>ğŸ“Š è¨ˆæ¸¬ãƒ‡ãƒ¼ã‚¿</h4>
                    <div class="info-item">
                        <span>éŸ³é€Ÿ</span>
                        <span id="soundSpeedDisplay">330 m/s</span>
                    </div>
                    <div class="info-item">
                        <span>çµŒéæ™‚é–“</span>
                        <span id="timeDisplay">0.00 ç§’</span>
                    </div>
                    <div class="info-item">
                        <span>ç¾åœ¨ã®èˆ¹ã®ä½ç½®</span>
                        <span id="shipPosDisplay">0 m</span>
                    </div>
                    <div class="info-item">
                        <span>éŸ³æ³¢ã®ä½ç½®</span>
                        <span id="wavePosDisplay">- m</span>
                    </div>
                    <div class="info-item">
                        <span>åéŸ¿éŸ³åˆ°é”æ™‚åˆ»</span>
                        <span id="echoTimeDisplay">- ç§’</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ ---
    function openTab(tabName) {
        var contents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < contents.length; i++) {
            contents[i].style.display = "none";
            contents[i].classList.remove("active");
        }
        var buttons = document.getElementsByClassName("tab-btn");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        if (event) {
            event.currentTarget.classList.add("active");
        }
        
        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–ãŒé–‹ã‹ã‚ŒãŸã‚‰Canvasã‚’ãƒªã‚µã‚¤ã‚º
        if (tabName === 'simulation') {
            resizeCanvas();
        }
    }

    // --- é™çš„å›³è§£ã®æç”» ---
    function drawDayDiagram() {
        const canvas = document.getElementById('dayDiagram');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const w = canvas.width;
        const h = canvas.height;
        
        // èƒŒæ™¯ã‚¯ãƒªã‚¢
        ctx.clearRect(0, 0, w, h);
        
        // èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ˜¼ï¼šä¸‹ãŒæš–è‰²ã€ä¸ŠãŒå¯’è‰²ï¼‰
        const gradient = ctx.createLinearGradient(0, 0, 0, h);
        gradient.addColorStop(0, '#87CEEB');  // ä¸Šç©ºï¼šæ¶¼ã—ã„é’
        gradient.addColorStop(1, '#FFE4B5');  // åœ°è¡¨ï¼šæš–ã‹ã„ã‚ªãƒ¬ãƒ³ã‚¸
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, w, h);
        
        // åœ°é¢
        ctx.fillStyle = '#8B4513';
        ctx.fillRect(0, h - 30, w, 30);
        ctx.fillStyle = '#228B22';
        ctx.fillRect(0, h - 35, w, 8);
        
        // å¤ªé™½
        ctx.fillStyle = '#FFD700';
        ctx.beginPath();
        ctx.arc(50, 40, 25, 0, Math.PI * 2);
        ctx.fill();
        
        // æ¸©åº¦ãƒ»éŸ³é€Ÿãƒ©ãƒ™ãƒ«
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#1565C0';
        ctx.fillText('ä½æ¸©', w - 60, 30);
        ctx.fillText('éŸ³é€Ÿ å°', w - 70, 50);
        
        ctx.fillStyle = '#E65100';
        ctx.fillText('éŸ³é€Ÿ å¤§', 20, h - 50);
        ctx.fillText('é«˜æ¸©', 20, h - 70);
        
        // éŸ³æºï¼ˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ï¼‰
        ctx.fillStyle = '#333';
        ctx.fillRect(60, h - 70, 20, 25);
        ctx.beginPath();
        ctx.moveTo(80, h - 75);
        ctx.lineTo(100, h - 90);
        ctx.lineTo(100, h - 40);
        ctx.lineTo(80, h - 45);
        ctx.closePath();
        ctx.fill();
        
        // éŸ³æ³¢ã®çµŒè·¯ï¼ˆä¸‹ã«å‡¸ã®äºŒæ¬¡é–¢æ•°ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ - ä¸Šã«æ›²ãŒã‚‹ï¼‰
        ctx.strokeStyle = '#E91E63';
        ctx.lineWidth = 3;
        ctx.setLineDash([]);
        ctx.beginPath();
        
        // é–‹å§‹ç‚¹
        const startX = 100;
        const startY = h - 65;
        ctx.moveTo(startX, startY);
        
        // ä¸‹ã«å‡¸ã®æ”¾ç‰©ç·šï¼ˆä¸Šã«å‘ã‹ã£ã¦æ›²ãŒã‚‹ï¼‰
        // y = a(x - h)^2 + k ã®å½¢ã§ã€ä¸‹ã«å‡¸ãªã®ã§ a > 0
        // ãŸã ã—åº§æ¨™ç³»ã§ã¯ä¸ŠãŒå°ã•ã„ã®ã§ã€æç”»ä¸Šã¯ä¸Šã«å‘ã‹ã†
        const endX = 300;
        const endY = 50;
        const controlX = (startX + endX) / 2;
        const controlY = startY + 30; // ä¸‹ã«è†¨ã‚‰ã‚€åˆ¶å¾¡ç‚¹
        
        ctx.quadraticCurveTo(controlX, controlY, endX, endY);
        ctx.stroke();
        
        // çŸ¢å°ã‚’æ›²ç·šã®çµ‚ç‚¹ã«æ­£ã—ãé…ç½®
        const arrowSize = 12;
        // æ›²ç·šã®çµ‚ç‚¹ä»˜è¿‘ã®æ¥ç·šæ–¹å‘ã‚’è¨ˆç®—
        const t = 0.95; // çµ‚ç‚¹ä»˜è¿‘
        const tangentX = 2 * (1 - t) * (controlX - startX) + 2 * t * (endX - controlX);
        const tangentY = 2 * (1 - t) * (controlY - startY) + 2 * t * (endY - controlY);
        const angle = Math.atan2(tangentY, tangentX);
        
        ctx.fillStyle = '#E91E63';
        ctx.beginPath();
        ctx.moveTo(endX, endY);
        ctx.lineTo(endX - arrowSize * Math.cos(angle - Math.PI / 6), endY - arrowSize * Math.sin(angle - Math.PI / 6));
        ctx.lineTo(endX - arrowSize * Math.cos(angle + Math.PI / 6), endY - arrowSize * Math.sin(angle + Math.PI / 6));
        ctx.closePath();
        ctx.fill();
        
        // èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ
        ctx.font = 'bold 12px sans-serif';
        ctx.fillStyle = '#E91E63';
        ctx.fillText('éŸ³ãŒä¸Šã«é€ƒã’ã‚‹', 180, h - 100);
    }
    
    function drawNightDiagram() {
        const canvas = document.getElementById('nightDiagram');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const w = canvas.width;
        const h = canvas.height;
        
        // èƒŒæ™¯ã‚¯ãƒªã‚¢
        ctx.clearRect(0, 0, w, h);
        
        // èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¤œï¼šä¸ŠãŒæš–è‰²ã€ä¸‹ãŒå¯’è‰²ï¼‰
        const gradient = ctx.createLinearGradient(0, 0, 0, h);
        gradient.addColorStop(0, '#2C3E50');  // ä¸Šç©ºï¼šæš—ã„é’
        gradient.addColorStop(0.7, '#34495E');
        gradient.addColorStop(1, '#1a237e');  // åœ°è¡¨ï¼šå†·ãŸã„ç´º
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, w, h);
        
        // åœ°é¢
        ctx.fillStyle = '#1B5E20';
        ctx.fillRect(0, h - 30, w, 30);
        
        // æœˆ
        ctx.fillStyle = '#FFF9C4';
        ctx.beginPath();
        ctx.arc(w - 50, 40, 20, 0, Math.PI * 2);
        ctx.fill();
        // æœˆã®ã‚¯ãƒ¬ãƒ¼ã‚¿ãƒ¼
        ctx.fillStyle = '#E0E0E0';
        ctx.beginPath();
        ctx.arc(w - 55, 35, 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(w - 45, 45, 3, 0, Math.PI * 2);
        ctx.fill();
        
        // æ˜Ÿï¼ˆå›ºå®šä½ç½®ï¼‰
        ctx.fillStyle = 'white';
        const starPositions = [
            {x: 30, y: 25}, {x: 80, y: 50}, {x: 120, y: 20},
            {x: 160, y: 60}, {x: 200, y: 30}, {x: 240, y: 55},
            {x: 50, y: 70}, {x: 140, y: 80}, {x: 180, y: 45},
            {x: 100, y: 35}, {x: 220, y: 70}, {x: 260, y: 25}
        ];
        for (let star of starPositions) {
            ctx.beginPath();
            ctx.arc(star.x, star.y, 1.5, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // æ¸©åº¦ãƒ»éŸ³é€Ÿãƒ©ãƒ™ãƒ«
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#FF8A65';
        ctx.fillText('é«˜æ¸©', w - 60, 80);
        ctx.fillText('éŸ³é€Ÿ å¤§', w - 70, 100);
        
        ctx.fillStyle = '#81D4FA';
        ctx.fillText('éŸ³é€Ÿ å°', 20, h - 50);
        ctx.fillText('ä½æ¸©', 20, h - 70);
        
        // éŸ³æºï¼ˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ï¼‰
        ctx.fillStyle = '#FFF';
        ctx.fillRect(60, h - 70, 20, 25);
        ctx.beginPath();
        ctx.moveTo(80, h - 75);
        ctx.lineTo(100, h - 90);
        ctx.lineTo(100, h - 40);
        ctx.lineTo(80, h - 45);
        ctx.closePath();
        ctx.fill();
        
        // éŸ³æ³¢ã®çµŒè·¯ï¼ˆlogé–¢æ•°ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ - æœ€åˆã¯ä¸ŠãŒã£ã¦ã‹ã‚‰æ°´å¹³ã«è¿‘ã¥ãï¼‰
        ctx.strokeStyle = '#2196F3';
        ctx.lineWidth = 3;
        ctx.setLineDash([]);
        ctx.beginPath();
        
        // é–‹å§‹ç‚¹
        const startX = 100;
        const startY = h - 65;
        ctx.moveTo(startX, startY);
        
        // logé–¢æ•°çš„ãªæ›²ç·šï¼šæœ€åˆæ€¥ã«ä¸ŠãŒã‚Šã€å¾ã€…ã«æ°´å¹³ã«
        // è¤‡æ•°ã®ç‚¹ã‚’ä½¿ã£ã¦æ»‘ã‚‰ã‹ãªæ›²ç·šã‚’æã
        const points = [];
        const numPoints = 50;
        for (let i = 0; i <= numPoints; i++) {
            const t = i / numPoints;
            const x = startX + t * 220;
            // logçš„ãªæ›²ç·š: y = startY - amplitude * log(1 + scale * t)
            const amplitude = 80;
            const scale = 5;
            const y = startY - amplitude * Math.log(1 + scale * t) / Math.log(1 + scale);
            points.push({x, y});
        }
        
        // æ›²ç·šã‚’æç”»
        for (let i = 1; i < points.length; i++) {
            ctx.lineTo(points[i].x, points[i].y);
        }
        ctx.stroke();
        
        // çŸ¢å°ã‚’æ›²ç·šã®çµ‚ç‚¹ã«é…ç½®
        const lastPoint = points[points.length - 1];
        const prevPoint = points[points.length - 2];
        const arrowAngle = Math.atan2(lastPoint.y - prevPoint.y, lastPoint.x - prevPoint.x);
        const arrowSize = 12;
        
        ctx.fillStyle = '#2196F3';
        ctx.beginPath();
        ctx.moveTo(lastPoint.x, lastPoint.y);
        ctx.lineTo(lastPoint.x - arrowSize * Math.cos(arrowAngle - Math.PI / 6), lastPoint.y - arrowSize * Math.sin(arrowAngle - Math.PI / 6));
        ctx.lineTo(lastPoint.x - arrowSize * Math.cos(arrowAngle + Math.PI / 6), lastPoint.y - arrowSize * Math.sin(arrowAngle + Math.PI / 6));
        ctx.closePath();
        ctx.fill();
        
        // èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ
        ctx.font = 'bold 12px sans-serif';
        ctx.fillStyle = '#2196F3';
        ctx.fillText('éŸ³ãŒé ãã¾ã§å±Šã', 180, h - 100);
    }

    // --- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ---
    const canvas = document.getElementById('physicsCanvas');
    const ctx = canvas.getContext('2d');
    
    // ç‰©ç†å®šæ•°
    const SOUND_SPEED = 330; // m/s
    
    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
    let simState = {
        running: false,
        time: 0,
        shipVelocity: 0,      // èˆ¹ã®é€Ÿåº¦ [m/s]
        initialDistance: 500,  // åˆæœŸè·é›¢ [m]
        shipPosition: 0,       // èˆ¹ã®ç¾åœ¨ä½ç½®ï¼ˆåˆæœŸä½ç½®ã‹ã‚‰ã®ç§»å‹•é‡ï¼‰
        wavePosition: null,    // éŸ³æ³¢ã®ä½ç½®ï¼ˆnullã¯ç™ºå°„å‰ï¼‰
        waveDirection: 1,      // 1: å³å‘ãï¼ˆæ°·å±±ã¸ï¼‰ã€-1: å·¦å‘ãï¼ˆæˆ»ã‚Šï¼‰
        waveReflected: false,  // åå°„æ¸ˆã¿ã‹ã©ã†ã‹
        echoReceived: false,
        echoTime: null,
        animationId: null
    };
    
    // æç”»ç”¨ã‚¹ã‚±ãƒ¼ãƒ«
    let scale = 1;
    let offsetX = 50;
    
    // UIè¦ç´ 
    const vSlider = document.getElementById('vSlider');
    const dSlider = document.getElementById('dSlider');
    const vDisplay = document.getElementById('vDisplay');
    const dDisplay = document.getElementById('dDisplay');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const timeDisplay = document.getElementById('timeDisplay');
    const shipPosDisplay = document.getElementById('shipPosDisplay');
    const wavePosDisplay = document.getElementById('wavePosDisplay');
    const echoTimeDisplay = document.getElementById('echoTimeDisplay');
    
    // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
    vSlider.addEventListener('input', function() {
        simState.shipVelocity = parseFloat(this.value);
        vDisplay.textContent = this.value + ' m/s';
    });
    
    dSlider.addEventListener('input', function() {
        simState.initialDistance = parseFloat(this.value);
        dDisplay.textContent = this.value + ' m';
        if (!simState.running) {
            resetSimulation();
        }
    });
    
    // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
    startBtn.addEventListener('click', startSimulation);
    resetBtn.addEventListener('click', resetSimulation);
    
    function startSimulation() {
        if (simState.running) return;
        
        simState.running = true;
        simState.time = 0;
        simState.shipPosition = 0;
        simState.echoReceived = false;
        simState.echoTime = null;
        
        // éŸ³æ³¢ã‚’ç™ºå°„ï¼ˆèˆ¹ã®ä½ç½®ã‹ã‚‰ï¼‰
        simState.wavePosition = 0;
        simState.waveDirection = 1;
        simState.waveReflected = false;
        
        startBtn.disabled = true;
        startBtn.textContent = 'ğŸ”Š ç™ºå°„ä¸­...';
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        let lastTimestamp = null;
        
        function animationStep(timestamp) {
            if (!simState.running) return;
            
            if (lastTimestamp === null) {
                lastTimestamp = timestamp;
            }
            
            const deltaTime = (timestamp - lastTimestamp) / 1000; // ç§’ã«å¤‰æ›
            lastTimestamp = timestamp;
            
            // æ™‚é–“ã‚’é€²ã‚ã‚‹ï¼ˆå®Ÿæ™‚é–“ã®5å€é€Ÿï¼‰
            const simDeltaTime = deltaTime * 5;
            simState.time += simDeltaTime;
            
            // èˆ¹ã®ä½ç½®ã‚’æ›´æ–°
            simState.shipPosition += simState.shipVelocity * simDeltaTime;
            
            // æ°·å±±ã®ä½ç½®ï¼ˆåˆæœŸè·é›¢ã®ä½ç½®ã«å›ºå®šï¼‰
            const icebergX = simState.initialDistance;
            
            // éŸ³æ³¢ã®ä½ç½®ã‚’æ›´æ–°
            if (simState.wavePosition !== null) {
                simState.wavePosition += SOUND_SPEED * simState.waveDirection * simDeltaTime;
                
                // æ°·å±±ã§åå°„
                if (simState.waveDirection === 1 && simState.wavePosition >= icebergX && !simState.waveReflected) {
                    simState.wavePosition = icebergX;
                    simState.waveDirection = -1;
                    simState.waveReflected = true;
                }
                
                // èˆ¹ã«åˆ°é”ï¼ˆåå°„å¾Œï¼‰
                if (simState.waveDirection === -1 && simState.wavePosition <= simState.shipPosition) {
                    if (!simState.echoReceived) {
                        simState.echoReceived = true;
                        simState.echoTime = simState.time;
                        echoTimeDisplay.textContent = simState.echoTime.toFixed(2) + ' ç§’';
                    }
                }
            }
            
            // è¡¨ç¤ºæ›´æ–°
            timeDisplay.textContent = simState.time.toFixed(2) + ' ç§’';
            shipPosDisplay.textContent = simState.shipPosition.toFixed(1) + ' m';
            
            if (simState.wavePosition !== null && !simState.echoReceived) {
                wavePosDisplay.textContent = simState.wavePosition.toFixed(1) + ' m';
            } else if (simState.echoReceived) {
                wavePosDisplay.textContent = 'åˆ°é”æ¸ˆã¿';
            }
            
            draw();
            
            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†åˆ¤å®š
            if (simState.echoReceived || simState.time > 20) {
                simState.running = false;
                startBtn.disabled = false;
                startBtn.textContent = 'ğŸ”Š æ±½ç¬›ã‚’é³´ã‚‰ã™';
                return;
            }
            
            simState.animationId = requestAnimationFrame(animationStep);
        }
        
        simState.animationId = requestAnimationFrame(animationStep);
    }
    
    function resetSimulation() {
        simState.running = false;
        if (simState.animationId) {
            cancelAnimationFrame(simState.animationId);
            simState.animationId = null;
        }
        
        simState.time = 0;
        simState.shipPosition = 0;
        simState.wavePosition = null;
        simState.waveDirection = 1;
        simState.waveReflected = false;
        simState.echoReceived = false;
        simState.echoTime = null;
        
        startBtn.disabled = false;
        startBtn.textContent = 'ğŸ”Š æ±½ç¬›ã‚’é³´ã‚‰ã™';
        
        timeDisplay.textContent = '0.00 ç§’';
        shipPosDisplay.textContent = '0 m';
        wavePosDisplay.textContent = '- m';
        echoTimeDisplay.textContent = '- ç§’';
        
        draw();
    }
    
    function draw() {
        const w = canvas.width;
        const h = canvas.height;
        
        // èƒŒæ™¯
        ctx.fillStyle = '#E3F2FD';
        ctx.fillRect(0, 0, w, h);
        
        // æµ·
        const seaGradient = ctx.createLinearGradient(0, h * 0.6, 0, h);
        seaGradient.addColorStop(0, '#1976D2');
        seaGradient.addColorStop(1, '#0D47A1');
        ctx.fillStyle = seaGradient;
        ctx.fillRect(0, h * 0.6, w, h * 0.4);
        
        // æ³¢æ¨¡æ§˜
        ctx.strokeStyle = 'rgba(255,255,255,0.3)';
        ctx.lineWidth = 2;
        for (let i = 0; i < 5; i++) {
            ctx.beginPath();
            for (let x = 0; x < w; x += 10) {
                const y = h * 0.65 + i * 20 + Math.sin((x + simState.time * 20) / 30) * 5;
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }
        
        // ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
        const maxDist = simState.initialDistance + 150;
        scale = (w - 180) / maxDist;
        offsetX = 100;
        
        const icebergX = simState.initialDistance;
        const shipAbsX = simState.shipPosition;
        
        // å¹³é¢æ³¢ã®æç”»ï¼ˆè–„ã„è‰²ã§1ã¤ã ã‘ï¼‰
        if (simState.wavePosition !== null) {
            const waveScreenX = offsetX + simState.wavePosition * scale;
            
            // æ³¢é¢ã‚’æç”»
            const waveColor = simState.waveDirection === 1 ? 'rgba(255, 152, 0, 0.6)' : 'rgba(76, 175, 80, 0.6)';
            ctx.strokeStyle = waveColor;
            ctx.lineWidth = 4;
            
            // æ³¢é¢ã®ç·šã‚’æç”»ï¼ˆç¯„å›²å†…ã®ã¿ï¼‰
            if (waveScreenX >= offsetX && waveScreenX <= offsetX + icebergX * scale) {
                ctx.beginPath();
                ctx.moveTo(waveScreenX, h * 0.30);
                ctx.lineTo(waveScreenX, h * 0.55);
                ctx.stroke();
                
                // è–„ã„æ³¢ç´‹ã‚‚è¿½åŠ 
                ctx.strokeStyle = simState.waveDirection === 1 ? 'rgba(255, 152, 0, 0.25)' : 'rgba(76, 175, 80, 0.25)';
                ctx.lineWidth = 2;
                for (let i = 1; i <= 3; i++) {
                    const offsetWave = simState.waveDirection === 1 ? -i * 20 : i * 20;
                    const x = waveScreenX + offsetWave;
                    if (x >= offsetX && x <= offsetX + icebergX * scale) {
                        ctx.beginPath();
                        ctx.moveTo(x, h * 0.32);
                        ctx.lineTo(x, h * 0.53);
                        ctx.stroke();
                    }
                }
                
                // æ³¢ã®é€²è¡Œæ–¹å‘çŸ¢å°
                ctx.fillStyle = simState.waveDirection === 1 ? 'rgba(255, 152, 0, 0.9)' : 'rgba(76, 175, 80, 0.9)';
                ctx.beginPath();
                if (simState.waveDirection === 1) {
                    ctx.moveTo(waveScreenX + 15, h * 0.42);
                    ctx.lineTo(waveScreenX + 3, h * 0.38);
                    ctx.lineTo(waveScreenX + 3, h * 0.46);
                } else {
                    ctx.moveTo(waveScreenX - 15, h * 0.42);
                    ctx.lineTo(waveScreenX - 3, h * 0.38);
                    ctx.lineTo(waveScreenX - 3, h * 0.46);
                }
                ctx.closePath();
                ctx.fill();
            }
        }
        
        // æ°·å±±
        const icebergScreenX = offsetX + icebergX * scale;
        ctx.fillStyle = '#B3E5FC';
        ctx.beginPath();
        ctx.moveTo(icebergScreenX - 30, h * 0.6);
        ctx.lineTo(icebergScreenX, h * 0.25);
        ctx.lineTo(icebergScreenX + 40, h * 0.6);
        ctx.closePath();
        ctx.fill();
        
        ctx.fillStyle = '#E1F5FE';
        ctx.beginPath();
        ctx.moveTo(icebergScreenX - 20, h * 0.6);
        ctx.lineTo(icebergScreenX + 5, h * 0.35);
        ctx.lineTo(icebergScreenX + 25, h * 0.6);
        ctx.closePath();
        ctx.fill();
        
        // æ°´ä¸­ã®æ°·å±±
        ctx.fillStyle = 'rgba(179, 229, 252, 0.5)';
        ctx.beginPath();
        ctx.moveTo(icebergScreenX - 40, h * 0.6);
        ctx.lineTo(icebergScreenX, h * 0.9);
        ctx.lineTo(icebergScreenX + 50, h * 0.6);
        ctx.closePath();
        ctx.fill();
        
        // æ°·å±±ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#0277BD';
        ctx.font = 'bold 14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('æ°·å±±', icebergScreenX, h * 0.2);
        
        // èˆ¹ã®æç”»
        const shipScreenX = offsetX + shipAbsX * scale;
        drawShip(ctx, shipScreenX, h);
        
        // è·é›¢è¡¨ç¤º
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;
        ctx.setLineDash([5, 5]);
        
        // ç¾åœ¨ã®è·é›¢ç·š
        const currentDist = icebergX - shipAbsX;
        ctx.beginPath();
        ctx.moveTo(shipScreenX, h * 0.68);
        ctx.lineTo(icebergScreenX, h * 0.68);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // è·é›¢ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#333';
        ctx.font = '12px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('ç¾åœ¨ã®è·é›¢: ' + currentDist.toFixed(0) + ' m', (shipScreenX + icebergScreenX) / 2, h * 0.72);
        
        // åéŸ¿éŸ³å—ä¿¡è¡¨ç¤º
        if (simState.echoReceived) {
            ctx.fillStyle = 'rgba(76, 175, 80, 0.9)';
            ctx.font = 'bold 20px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ”” åéŸ¿éŸ³ã‚’å—ä¿¡ï¼', w / 2, h * 0.12);
            ctx.font = '16px sans-serif';
            ctx.fillText('å¾€å¾©æ™‚é–“: ' + simState.echoTime.toFixed(2) + ' ç§’', w / 2, h * 0.18);
        }
        
        // å‡¡ä¾‹
        ctx.textAlign = 'left';
        ctx.fillStyle = 'rgba(255, 152, 0, 0.8)';
        ctx.fillRect(10, 10, 20, 10);
        ctx.fillStyle = '#333';
        ctx.font = '12px sans-serif';
        ctx.fillText('è¡Œãã®éŸ³æ³¢', 35, 18);
        
        ctx.fillStyle = 'rgba(76, 175, 80, 0.8)';
        ctx.fillRect(10, 25, 20, 10);
        ctx.fillStyle = '#333';
        ctx.fillText('æˆ»ã‚Šã®éŸ³æ³¢', 35, 33);
    }
    
    // èˆ¹ã‚’æç”»ã™ã‚‹é–¢æ•°
    function drawShip(ctx, centerX, canvasHeight) {
        const h = canvasHeight;
        
        // èˆ¹ä½“ï¼ˆä¸€ä½“åŒ–ã—ãŸå½¢çŠ¶ï¼‰
        ctx.fillStyle = '#5D4037';
        ctx.beginPath();
        ctx.moveTo(centerX - 40, h * 0.55);  // å·¦å…ˆç«¯
        ctx.lineTo(centerX - 30, h * 0.60);  // å·¦ä¸‹
        ctx.lineTo(centerX + 35, h * 0.60);  // å³ä¸‹
        ctx.lineTo(centerX + 45, h * 0.55);  // å³å…ˆç«¯
        ctx.lineTo(centerX + 35, h * 0.52);  // å³ä¸Š
        ctx.lineTo(centerX - 30, h * 0.52);  // å·¦ä¸Š
        ctx.closePath();
        ctx.fill();
        
        // èˆ¹ã®ç”²æ¿
        ctx.fillStyle = '#8D6E63';
        ctx.fillRect(centerX - 25, h * 0.48, 45, 5);
        
        // èˆ¹æ©‹ï¼ˆæ“èˆµå®¤ï¼‰
        ctx.fillStyle = '#6D4C41';
        ctx.fillRect(centerX - 10, h * 0.40, 25, 8);
        
        // çª“
        ctx.fillStyle = '#BBDEFB';
        ctx.fillRect(centerX - 5, h * 0.41, 6, 4);
        ctx.fillRect(centerX + 5, h * 0.41, 6, 4);
        
        // ç…™çª
        ctx.fillStyle = '#424242';
        ctx.fillRect(centerX, h * 0.32, 8, 8);
        
        // ç…™çªã®èµ¤ã„ãƒ©ã‚¤ãƒ³
        ctx.fillStyle = '#D32F2F';
        ctx.fillRect(centerX, h * 0.34, 8, 2);
        
        // ç…™ï¼ˆå‹•ã„ã¦ã„ã‚‹ã¨ãï¼‰
        if (simState.running || Math.abs(simState.shipVelocity) > 0) {
            ctx.fillStyle = 'rgba(158, 158, 158, 0.5)';
            for (let i = 0; i < 3; i++) {
                const smokeX = centerX + 4 - i * 6;
                const smokeY = h * 0.28 - i * 6;
                const smokeR = 4 + i * 2;
                ctx.beginPath();
                ctx.arc(smokeX, smokeY, smokeR, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // èˆ¹ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#3E2723';
        ctx.font = 'bold 14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('èˆ¹', centerX, h * 0.26);
    }
    
    function resizeCanvas() {
        const container = canvas.parentElement;
        canvas.width = container.clientWidth;
        canvas.height = 350;
        draw();
    }
    
    // åˆæœŸåŒ–
    window.addEventListener('load', function() {
        resizeCanvas();
        drawDayDiagram();
        drawNightDiagram();
    });
    
    window.addEventListener('resize', function() {
        resizeCanvas();
        drawDayDiagram();
        drawNightDiagram();
    });
    </script>
</body>
</html>