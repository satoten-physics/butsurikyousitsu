<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ ¡ç‰©ç† - å¼¦ãƒ»æ°—æŸ±ã®æŒ¯å‹•</title>
    <script>
      window.MathJax = {
      tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
     }
     };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        h1 {
            color: #333;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        .tab-btn:hover {
            background: #8899f0;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        h3 {
            color: #764ba2;
            margin: 25px 0 15px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #eee;
        }
        h4 {
            color: #555;
            margin: 20px 0 10px 0;
        }
        p {
            line-height: 1.8;
            margin-bottom: 15px;
        }
        .point-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            border-left: 4px solid #667eea;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }
        .point-box h4 {
            color: #667eea;
            margin-top: 0;
        }
        .formula-box {
            background: #fff3e0;
            border: 2px solid #ff9800;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: center;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        .comparison-table th {
            background: #667eea;
            color: white;
        }
        .comparison-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        .note {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 10px 15px;
            margin: 15px 0;
            font-size: 0.95em;
        }
        
        /* å›ºæœ‰æŒ¯å‹•å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ« */
        .building-demo {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .building-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .building-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .building-btn:hover {
            background: #f0f0ff;
        }
        .building-btn.active {
            background: #667eea;
            color: white;
        }
        .building-canvas-container {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        .building-display {
            text-align: center;
        }
        .building-display canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        .building-info {
            margin-top: 10px;
            font-size: 14px;
            color: #555;
        }
        
        /* æ³¢å½¢å¯è¦–åŒ– */
        .wave-visual {
            background: #fafafa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .wave-visual canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            max-width: 100%;
        }
        .wave-visual-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        .wave-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .wave-btn {
            padding: 8px 16px;
            border: 2px solid #764ba2;
            background: white;
            color: #764ba2;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .wave-btn:hover {
            background: #f5f0ff;
        }
        .wave-btn.active {
            background: #764ba2;
            color: white;
        }
        
        /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .sim-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .sim-section h3 {
            border-bottom: none;
            margin-top: 0;
        }
        #sim-container, #sim-container2 {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        #stringCanvas, #pipeCanvas {
            display: block;
            width: 100%;
            background: white;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
        .sim-controls {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }
        .resonance-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            margin-left: 10px;
        }
        .resonance-indicator.resonating {
            background: #4CAF50;
            color: white;
            animation: pulse 0.5s ease-in-out infinite alternate;
        }
        .resonance-indicator.not-resonating {
            background: #f44336;
            color: white;
        }
        @keyframes pulse {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0.8; transform: scale(1.05); }
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .sim-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .sim-button.start {
            background: #4CAF50;
            color: white;
        }
        .sim-button.start:hover {
            background: #45a049;
        }
        .sim-button.reset {
            background: #f44336;
            color: white;
        }
        .sim-button.reset:hover {
            background: #da190b;
        }
        .sim-button.toggle {
            background: #2196F3;
            color: white;
        }
        .sim-button.toggle:hover {
            background: #1976D2;
        }
        .info-display {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        .info-display p {
            margin: 5px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .mode-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .mode-btn.active {
            background: #667eea;
            color: white;
        }
        
        /* å•é¡Œã‚¿ãƒ–ç”¨ */
        .problem {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .problem h4 {
            color: #667eea;
        }
        details {
            margin-top: 15px;
        }
        summary {
            cursor: pointer;
            padding: 10px 15px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-weight: bold;
        }
        summary:hover {
            background: #5a6fd6;
        }
        .answer {
            padding: 15px;
            background: #e8f5e9;
            border-radius: 0 0 10px 10px;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            header, .container {
                padding: 15px;
            }
            .tab-btn {
                min-width: 100px;
                font-size: 14px;
            }
            .comparison-table {
                font-size: 12px;
            }
            .comparison-table th, .comparison-table td {
                padding: 8px 4px;
            }
            .building-canvas-container {
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="back-link">â† ç›®æ¬¡ã«æˆ»ã‚‹</a>
        <h1>å¼¦ãƒ»æ°—æŸ±ã®æŒ¯å‹•</h1>
    </header>
    <div class="container">
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('lecture')">è§£èª¬ç·¨</button>
            <button class="tab-btn" onclick="openTab('problem')">å•é¡Œç·¨</button>
            <button class="tab-btn" onclick="openTab('simulation')">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>
        
        <!-- ========== è§£èª¬ã‚¿ãƒ– ========== -->
        <div id="lecture" class="tab-content active">
            <h2>å¼¦ãƒ»æ°—æŸ±ã®æŒ¯å‹•ã®ãƒã‚¤ãƒ³ãƒˆ</h2>
            
            <h3>1. å›ºæœ‰æŒ¯å‹•ã¨ã¯ï¼Ÿ</h3>
            <p>
                ç‰©ä½“ã«ã¯ãã‚Œãã‚Œ<strong>ã€ŒæŒ¯å‹•ã—ã‚„ã™ã„æŒ¯å‹•æ•°ã€</strong>ãŒå­˜åœ¨ã—ã¾ã™ã€‚ã“ã‚Œã‚’<strong>å›ºæœ‰æŒ¯å‹•æ•°</strong>ã¨ã„ã„ã¾ã™ã€‚
            </p>
            
            <div class="point-box">
                <h4>ğŸ  å»ºç‰©ã®å›ºæœ‰æŒ¯å‹•</h4>
                <p>
                    åœ°éœ‡ãŒèµ·ããŸã¨ãã€å»ºç‰©ã®ç¨®é¡ã«ã‚ˆã£ã¦æºã‚Œæ–¹ãŒç•°ãªã‚Šã¾ã™ã€‚<br>
                    ã“ã‚Œã¯å»ºç‰©ã”ã¨ã«<strong>å›ºæœ‰æŒ¯å‹•æ•°</strong>ãŒé•ã†ã‹ã‚‰ã§ã™ã€‚ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€æºã‚Œæ–¹ã®é•ã„ã‚’è¦³å¯Ÿã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
                </p>
            </div>
            
            <!-- å»ºç‰©ã®å›ºæœ‰æŒ¯å‹•ãƒ‡ãƒ¢ -->
            <div class="building-demo">
                <div class="building-selector">
                    <button class="building-btn active" id="btn-house" onclick="selectBuilding('house', this)">ğŸ  ä¸€æˆ¸å»ºã¦</button>
                    <button class="building-btn" id="btn-apartment" onclick="selectBuilding('apartment', this)">ğŸ¢ ãƒãƒ³ã‚·ãƒ§ãƒ³</button>
                    <button class="building-btn" id="btn-tower" onclick="selectBuilding('tower', this)">ğŸ™ï¸ é«˜å±¤ãƒ“ãƒ«</button>
                    <button class="building-btn" id="btn-bridge" onclick="selectBuilding('bridge', this)">ğŸŒ‰ æ©‹</button>
                </div>
                <div class="building-canvas-container">
                    <div class="building-display">
                        <canvas id="buildingCanvas" width="300" height="300"></canvas>
                        <div class="building-info" id="buildingInfo">
                            å›ºæœ‰æŒ¯å‹•æ•°: ç´„ 5ã€œ10 Hzï¼ˆé€Ÿãå°åˆ»ã¿ã«æºã‚Œã‚‹ï¼‰
                        </div>
                    </div>
                    <div class="building-display">
                        <canvas id="waveformCanvas" width="300" height="150"></canvas>
                        <div class="building-info">æŒ¯å‹•ã®æ³¢å½¢ï¼ˆæ™‚é–“å¤‰åŒ–ï¼‰</div>
                    </div>
                </div>
                <div class="button-group" style="justify-content: center; margin-top: 15px;">
                    <button class="sim-button start" id="buildingStartBtn" onclick="toggleBuildingAnimation()">åœ°éœ‡ç™ºç”Ÿï¼</button>
                </div>
            </div>
            
            <div class="note">
                <strong>ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ</strong><br>
                ãƒ»<strong>ä½ã„å»ºç‰©</strong>ï¼ˆä¸€æˆ¸å»ºã¦ãªã©ï¼‰â†’ å›ºæœ‰æŒ¯å‹•æ•°ãŒ<strong>é«˜ã„</strong>ï¼ˆé€Ÿãæºã‚Œã‚‹ï¼‰<br>
                ãƒ»<strong>é«˜ã„å»ºç‰©</strong>ï¼ˆé«˜å±¤ãƒ“ãƒ«ãªã©ï¼‰â†’ å›ºæœ‰æŒ¯å‹•æ•°ãŒ<strong>ä½ã„</strong>ï¼ˆã‚†ã£ãã‚Šå¤§ããæºã‚Œã‚‹ï¼‰<br>
                ãƒ»åœ°éœ‡æ³¢ã®æŒ¯å‹•æ•°ã¨å»ºç‰©ã®å›ºæœ‰æŒ¯å‹•æ•°ãŒä¸€è‡´ã™ã‚‹ã¨<strong>å…±æŒ¯</strong>ãŒèµ·ãã€å¤§ããæºã‚Œã‚‹ï¼
            </div>
            
            <p>
                ã“ã®ã‚ˆã†ã«ã€å›ºæœ‰æŒ¯å‹•ã¯å»ºç‰©ã ã‘ã§ãªãã€å¼¦æ¥½å™¨ã®å¼¦ã‚„ç®¡æ¥½å™¨ã®æ°—æŸ±ãªã©ã€ã‚ã‚‰ã‚†ã‚‹ç‰©ä½“ã«å­˜åœ¨ã—ã¾ã™ã€‚<br>
                ã“ã“ã§ã¯ã€<strong>å¼¦</strong>ã¨<strong>æ°—æŸ±</strong>ãŒæŒ¯å‹•ã—ãŸã¨ãã®æŒ¯å‹•æ•°ã«ã¤ã„ã¦èª¿ã¹ã¦ã„ãã¾ã™ã€‚
            </p>
            
            <h3>2. å¼¦ã®æŒ¯å‹•</h3>
            <p>
                ã‚®ã‚¿ãƒ¼ã‚„ãƒã‚¤ã‚ªãƒªãƒ³ã®å¼¦ã‚’å¼¾ãã¨ã€å¼¦ã«<strong>æ¨ªæ³¢</strong>ãŒç™ºç”Ÿã—ã€ä¸¡ç«¯ã§åå°„ã—ã¦<strong>å®šå¸¸æ³¢</strong>ãŒã§ãã¾ã™ã€‚
            </p>
            
            <div class="point-box">
                <h4>âš¡ æœ€é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h4>
                <p>
                    å¼¦ã¯<strong>ã€Œä¸¡ç«¯ãŒç¯€ã€</strong>ã«ãªã‚‹ã‚ˆã†ã«æŒ¯å‹•ã™ã‚‹ï¼<br>
                    ï¼ˆä¸¡ç«¯ã¯å›ºå®šã•ã‚Œã¦ã„ã¦å‹•ã‘ãªã„ã‹ã‚‰ï¼‰
                </p>
            </div>
            
            <p>åŸºæœ¬æŒ¯å‹•ã‚’åŸºæº–ã«ã—ã¦ã€å¼¦ã®ä¸­ã«å…¥ã‚‹æ³¢ã®æ•°ï¼ˆ$\frac{\lambda}{2}$ ã®å€‹æ•°ï¼‰ãŒè‡ªç„¶æ•°ãšã¤å¢—ãˆã¦ã„ãã¾ã™ã€‚</p>
            
            <!-- å¼¦ã®æ³¢å½¢å¯è¦–åŒ– -->
            <div class="wave-visual">
                <div class="wave-visual-title">ğŸ¸ å¼¦ã®å®šå¸¸æ³¢ã®å½¢ï¼ˆãƒœã‚¿ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆï¼‰</div>
                <canvas id="stringWaveCanvas" width="600" height="200"></canvas>
                <div class="wave-controls" id="stringWaveControls">
                    <button class="wave-btn active" onclick="setStringHarmonic(1, this)">åŸºæœ¬æŒ¯å‹• (n=1)</button>
                    <button class="wave-btn" onclick="setStringHarmonic(2, this)">2å€æŒ¯å‹• (n=2)</button>
                    <button class="wave-btn" onclick="setStringHarmonic(3, this)">3å€æŒ¯å‹• (n=3)</button>
                    <button class="wave-btn" onclick="setStringHarmonic(4, this)">4å€æŒ¯å‹• (n=4)</button>
                </div>
                <div class="building-info" id="stringWaveInfo" style="margin-top: 10px;">
                    åŸºæœ¬æŒ¯å‹•: L = Î»â‚/2 â†’ Î»â‚ = 2L ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ1å€‹å…¥ã‚‹ï¼‰
                </div>
            </div>
            
            <table class="comparison-table">
                <tr>
                    <th>æŒ¯å‹•ã®ç¨®é¡</th>
                    <th>å¼¦ã®é•·ã•ã¨æ³¢é•·ã®é–¢ä¿‚</th>
                    <th>æ³¢é•· $\lambda_n$</th>
                </tr>
                <tr>
                    <td>åŸºæœ¬æŒ¯å‹•ï¼ˆ$n=1$ï¼‰</td>
                    <td>$L = \dfrac{\lambda_1}{2}$</td>
                    <td>$\lambda_1 = 2L$</td>
                </tr>
                <tr>
                    <td>2å€æŒ¯å‹•ï¼ˆ$n=2$ï¼‰</td>
                    <td>$L = \dfrac{2\lambda_2}{2} = \lambda_2$</td>
                    <td>$\lambda_2 = L$</td>
                </tr>
                <tr>
                    <td>3å€æŒ¯å‹•ï¼ˆ$n=3$ï¼‰</td>
                    <td>$L = \dfrac{3\lambda_3}{2}$</td>
                    <td>$\lambda_3 = \dfrac{2L}{3}$</td>
                </tr>
                <tr>
                    <td>$n$å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{n\lambda_n}{2}$</td>
                    <td>$\lambda_n = \dfrac{2L}{n}$</td>
                </tr>
            </table>
            
            <div class="formula-box">
                <h4>å¼¦ã®å›ºæœ‰æŒ¯å‹•æ•°</h4>
                <p>
                    $f_n = \dfrac{v}{\lambda_n} = \dfrac{nv}{2L} = \dfrac{n}{2L}\sqrt{\dfrac{S}{\rho}}$ ã€€ï¼ˆ$n = 1, 2, 3, ...$ï¼‰
                </p>
                <p style="font-size: 0.9em; text-align: left; margin-top: 10px;">
                    $v$ï¼šå¼¦ã‚’ä¼ã‚ã‚‹æ³¢ã®é€Ÿã• [m/s]ã€$S$ï¼šå¼¦ã®å¼µåŠ› [N]ã€$\rho$ï¼šå¼¦ã®ç·šå¯†åº¦ [kg/m]
                </p>
            </div>
            
            <div class="note">
                <strong>ğŸ’¡ ã‚®ã‚¿ãƒ¼ã§éŸ³ã‚’å¤‰ãˆã‚‹æ–¹æ³•</strong><br>
                ãƒ»ãƒ•ãƒ¬ãƒƒãƒˆã‚’æŠ¼ã•ãˆã‚‹ â†’ å¼¦ã®é•·ã• $L$ ãŒçŸ­ããªã‚‹ â†’ æŒ¯å‹•æ•°ãŒä¸ŠãŒã‚‹ï¼ˆé«˜ã„éŸ³ï¼‰<br>
                ãƒ»å¼¦ã‚’å¼µã‚‹ â†’ å¼µåŠ› $S$ ãŒå¤§ãããªã‚‹ â†’ æŒ¯å‹•æ•°ãŒä¸ŠãŒã‚‹ï¼ˆé«˜ã„éŸ³ï¼‰<br>
                ãƒ»å¤ªã„å¼¦ã‚’ä½¿ã† â†’ ç·šå¯†åº¦ $\rho$ ãŒå¤§ãããªã‚‹ â†’ æŒ¯å‹•æ•°ãŒä¸‹ãŒã‚‹ï¼ˆä½ã„éŸ³ï¼‰
            </div>
            
            <h3>3. æ°—æŸ±ã®æŒ¯å‹•</h3>
            <p>
                ç®¡ã®ä¸­ã®ç©ºæ°—ï¼ˆæ°—æŸ±ï¼‰ã‚‚å›ºæœ‰æŒ¯å‹•æ•°ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ç®¡ã«æ¯ã‚’å¹ãè¾¼ã‚€ã¨ã€æ°—æŸ±ãŒå›ºæœ‰æŒ¯å‹•ã‚’èµ·ã“ã—ã¦éŸ³ãŒå‡ºã¾ã™ã€‚
            </p>
            
            <div class="note">
                ç©ºæ°—ã®å›ºæœ‰æŒ¯å‹•ã¯<strong>ç¸¦æ³¢</strong>ã§ã™ãŒã€ã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«<strong>æ¨ªæ³¢ã«å¤‰æ›ã—ã¦è¡¨ç¤º</strong>ã—ã¾ã™ã€‚
            </div>
            
            <h4>â‘  é–‰ç®¡ï¼ˆä¸€ç«¯ãŒé–‰ã˜ãŸç®¡ï¼‰</h4>
            <div class="point-box">
                <h4>âš¡ é–‰ç®¡ã®ãƒã‚¤ãƒ³ãƒˆ</h4>
                <p>
                    é–‰ç®¡ã¯ã€Œ<strong>å£ãŒè…¹ã€åº•ãŒç¯€</strong>ã€ã«ãªã‚‹ã‚ˆã†ã«æŒ¯å‹•ã™ã‚‹ï¼<br>
                    åŸºæœ¬æŒ¯å‹•ã‚’åŸºæº–ã«ã—ã¦ã€$\frac{\lambda}{4}$ ãŒ<strong>å¥‡æ•°å€</strong>ãšã¤å¢—ãˆã‚‹ã€‚
                </p>
            </div>
            
            <!-- é–‰ç®¡ã®æ³¢å½¢å¯è¦–åŒ– -->
            <div class="wave-visual">
                <div class="wave-visual-title">ğŸº é–‰ç®¡ã®å®šå¸¸æ³¢ã®å½¢ï¼ˆãƒœã‚¿ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆï¼‰</div>
                <canvas id="closedPipeWaveCanvas" width="500" height="250"></canvas>
                <div class="wave-controls" id="closedPipeWaveControls">
                    <button class="wave-btn active" onclick="setClosedPipeHarmonic(1, this)">åŸºæœ¬æŒ¯å‹• (n=1)</button>
                    <button class="wave-btn" onclick="setClosedPipeHarmonic(3, this)">3å€æŒ¯å‹• (n=3)</button>
                    <button class="wave-btn" onclick="setClosedPipeHarmonic(5, this)">5å€æŒ¯å‹• (n=5)</button>
                    <button class="wave-btn" onclick="setClosedPipeHarmonic(7, this)">7å€æŒ¯å‹• (n=7)</button>
                </div>
                <div class="building-info" id="closedPipeWaveInfo" style="margin-top: 10px;">
                    åŸºæœ¬æŒ¯å‹•: L = Î»â‚/4 â†’ Î»â‚ = 4L ï¼ˆç®¡ã®ä¸­ã«1/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰
                </div>
            </div>
            
            <table class="comparison-table">
                <tr>
                    <th>æŒ¯å‹•ã®ç¨®é¡</th>
                    <th>ç®¡ã®é•·ã•ã¨æ³¢é•·ã®é–¢ä¿‚</th>
                    <th>æ³¢é•· $\lambda_n$</th>
                </tr>
                <tr>
                    <td>åŸºæœ¬æŒ¯å‹•</td>
                    <td>$L = \dfrac{\lambda_1}{4}$</td>
                    <td>$\lambda_1 = 4L$</td>
                </tr>
                <tr>
                    <td>3å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{3\lambda_3}{4}$</td>
                    <td>$\lambda_3 = \dfrac{4L}{3}$</td>
                </tr>
                <tr>
                    <td>5å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{5\lambda_5}{4}$</td>
                    <td>$\lambda_5 = \dfrac{4L}{5}$</td>
                </tr>
                <tr>
                    <td>$(2m-1)$å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{(2m-1)\lambda_n}{4}$</td>
                    <td>$\lambda_n = \dfrac{4L}{2m-1}$</td>
                </tr>
            </table>
            
            <div class="formula-box">
                <h4>é–‰ç®¡ã®å›ºæœ‰æŒ¯å‹•æ•°</h4>
                <p>
                    $f_n = \dfrac{V}{\lambda_n} = \dfrac{nV}{4L}$ ã€€ï¼ˆ$n = 1, 3, 5, ...$ å¥‡æ•°ã®ã¿ï¼‰
                </p>
            </div>
            
            <h4>â‘¡ é–‹ç®¡ï¼ˆä¸¡ç«¯ãŒé–‹ã„ãŸç®¡ï¼‰</h4>
            <div class="point-box">
                <h4>âš¡ é–‹ç®¡ã®ãƒã‚¤ãƒ³ãƒˆ</h4>
                <p>
                    é–‹ç®¡ã¯ã€Œ<strong>ä¸¡ç«¯ãŒè…¹</strong>ã€ã«ãªã‚‹ã‚ˆã†ã«æŒ¯å‹•ã™ã‚‹ï¼<br>
                    åŸºæœ¬æŒ¯å‹•ã‚’åŸºæº–ã«ã—ã¦ã€$\frac{\lambda}{4}$ ãŒ<strong>å¶æ•°å€ï¼ˆ=æ•´æ•°å€ï¼‰</strong>ãšã¤å¢—ãˆã‚‹ã€‚
                </p>
            </div>
            
            <!-- é–‹ç®¡ã®æ³¢å½¢å¯è¦–åŒ– -->
            <div class="wave-visual">
                <div class="wave-visual-title">ğŸµ é–‹ç®¡ã®å®šå¸¸æ³¢ã®å½¢ï¼ˆãƒœã‚¿ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆï¼‰</div>
                <canvas id="openPipeWaveCanvas" width="500" height="250"></canvas>
                <div class="wave-controls" id="openPipeWaveControls">
                    <button class="wave-btn active" onclick="setOpenPipeHarmonic(1, this)">åŸºæœ¬æŒ¯å‹• (n=1)</button>
                    <button class="wave-btn" onclick="setOpenPipeHarmonic(2, this)">2å€æŒ¯å‹• (n=2)</button>
                    <button class="wave-btn" onclick="setOpenPipeHarmonic(3, this)">3å€æŒ¯å‹• (n=3)</button>
                    <button class="wave-btn" onclick="setOpenPipeHarmonic(4, this)">4å€æŒ¯å‹• (n=4)</button>
                </div>
                <div class="building-info" id="openPipeWaveInfo" style="margin-top: 10px;">
                    åŸºæœ¬æŒ¯å‹•: L = Î»â‚/2 â†’ Î»â‚ = 2L ï¼ˆç®¡ã®ä¸­ã«åŠæ³¢é•·ãŒå…¥ã‚‹ï¼‰
                </div>
            </div>
            
            <table class="comparison-table">
                <tr>
                    <th>æŒ¯å‹•ã®ç¨®é¡</th>
                    <th>ç®¡ã®é•·ã•ã¨æ³¢é•·ã®é–¢ä¿‚</th>
                    <th>æ³¢é•· $\lambda_n$</th>
                </tr>
                <tr>
                    <td>åŸºæœ¬æŒ¯å‹•ï¼ˆ$n=1$ï¼‰</td>
                    <td>$L = \dfrac{\lambda_1}{2}$</td>
                    <td>$\lambda_1 = 2L$</td>
                </tr>
                <tr>
                    <td>2å€æŒ¯å‹•ï¼ˆ$n=2$ï¼‰</td>
                    <td>$L = \lambda_2$</td>
                    <td>$\lambda_2 = L$</td>
                </tr>
                <tr>
                    <td>3å€æŒ¯å‹•ï¼ˆ$n=3$ï¼‰</td>
                    <td>$L = \dfrac{3\lambda_3}{2}$</td>
                    <td>$\lambda_3 = \dfrac{2L}{3}$</td>
                </tr>
                <tr>
                    <td>$n$å€æŒ¯å‹•</td>
                    <td>$L = \dfrac{n\lambda_n}{2}$</td>
                    <td>$\lambda_n = \dfrac{2L}{n}$</td>
                </tr>
            </table>
            
            <div class="formula-box">
                <h4>é–‹ç®¡ã®å›ºæœ‰æŒ¯å‹•æ•°</h4>
                <p>
                    $f_n = \dfrac{V}{\lambda_n} = \dfrac{nV}{2L}$ ã€€ï¼ˆ$n = 1, 2, 3, ...$ ã™ã¹ã¦ã®è‡ªç„¶æ•°ï¼‰
                </p>
            </div>
            
            <h3>4. é–‹å£ç«¯è£œæ­£</h3>
            <p>
                ã“ã“ã¾ã§ã¯ã€ç®¡ã®ç«¯ï¼ˆé–‹å£ç«¯ï¼‰ã§ã¡ã‚‡ã†ã©è…¹ãŒã§ãã‚‹ã¨è€ƒãˆã¦ãã¾ã—ãŸã€‚<br>
                ã—ã‹ã—ã€å®Ÿéš›ã«ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ãªã©ã§éŸ³ã‚’é³´ã‚‰ãã†ã¨ã™ã‚‹ã¨ã€å£ã«ã´ã£ãŸã‚Šæ¯ã‚’å¹ãã‹ã‘ã‚‹ã‚ˆã‚Šã‚‚ã€<strong>å°‘ã—é›¢ã—ãŸæ–¹ãŒé³´ã‚Šã‚„ã™ã„</strong>ã“ã¨ã«æ°—ã¥ãã¾ã™ã€‚
            </p>
            
            <div class="point-box">
                <h4>ğŸ“Œ é–‹å£ç«¯è£œæ­£ã¨ã¯</h4>
                <p>
                    å®Ÿéš›ã«ç™ºç”Ÿã™ã‚‹å®šå¸¸æ³¢ã®è…¹ã®ä½ç½®ã¯ã€ç®¡ã®å£ã‚ˆã‚Šã‚‚<strong>å°‘ã—å¤–å´</strong>ã«ã‚ã‚Šã¾ã™ã€‚<br>
                    ã“ã®ã‚ºãƒ¬ã‚’<strong>é–‹å£ç«¯è£œæ­£ $\Delta x$</strong> ã¨ã„ã„ã¾ã™ã€‚
                </p>
            </div>
            
            <!-- é–‹å£ç«¯è£œæ­£ã®å¯è¦–åŒ– -->
            <div class="wave-visual">
                <div class="wave-visual-title">ğŸ“ é–‹å£ç«¯è£œæ­£ã®ã‚¤ãƒ¡ãƒ¼ã‚¸</div>
                <canvas id="endCorrectionCanvas" width="500" height="200"></canvas>
                <div class="building-info" style="margin-top: 10px;">
                    å®Ÿéš›ã®è…¹ã®ä½ç½®ã¯ç®¡ã®å£ã‚ˆã‚Š Î”x ã ã‘å¤–å´ã«ã‚ã‚‹
                </div>
            </div>
            
            <p>
                ç®¡ã®é•·ã• $L$ ã«é–‹å£ç«¯è£œæ­£ $\Delta x$ ã‚’è¶³ã—ãŸã‚‚ã®ãŒã€å®ŸåŠ¹çš„ãªæ°—æŸ±ã®é•·ã•ã«ãªã‚Šã¾ã™ã€‚
            </p>
            
            <div class="formula-box">
                <h4>é–‹å£ç«¯è£œæ­£ã‚’å«ã‚€å¼</h4>
                <p>
                    é–‰ç®¡ã®å ´åˆï¼š$L + \Delta x = \dfrac{\lambda_1}{4}$<br><br>
                    é–‹ç®¡ã®å ´åˆï¼š$L + 2\Delta x = \dfrac{\lambda_1}{2}$<br>
                    <span style="font-size: 0.85em;">ï¼ˆé–‹ç®¡ã¯ä¸¡ç«¯ãŒé–‹ã„ã¦ã„ã‚‹ã®ã§ã€è£œæ­£ã¯2å€ï¼‰</span>
                </p>
            </div>
            
            <div class="note">
                <strong>ğŸ’¡ é–‹å£ç«¯è£œæ­£ã‚’æ±‚ã‚ã‚‹å®Ÿé¨“</strong><br>
                å…±é³´å®Ÿé¨“ã§2å›ã®å…±é³´ãŒèµ·ããŸã¨ãã€æ°—æŸ±ã®é•·ã•ã®å·®ã¯ $\dfrac{\lambda}{2}$ ã«ãªã‚Šã¾ã™ã€‚<br>
                ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€é–‹å£ç«¯è£œæ­£ $\Delta x$ ã‚’æ¶ˆå»ã—ã¦æ³¢é•·ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ï¼
            </div>
            
            <h3>5. å…±æŒ¯ãƒ»å…±é³´</h3>
            <p>
                ç‰©ä½“ãŒæŒã¤å›ºæœ‰æŒ¯å‹•æ•°ã‚’å¤–ã‹ã‚‰ä¼ãˆã‚‹ã“ã¨ã§ã€è§¦ã‚Œãšã¨ã‚‚æŒ¯å‹•ã•ã›ã‚‹ç¾è±¡ã‚’<strong>å…±æŒ¯</strong>ã¨ã„ã„ã¾ã™ã€‚<br>
                ã“ã‚ŒãŒéŸ³ã«é–¢ã™ã‚‹å ´åˆã€ç‰¹ã«<strong>å…±é³´</strong>ã¨ã„ã„ã¾ã™ã€‚
            </p>
            <div class="note">
                <strong>ğŸ’¡ å…±é³´ã®ä¾‹</strong><br>
                åŒã˜é•·ã•ã®æŒ¯ã‚Šå­ã‚’ä¸¦ã¹ã¦ä¸€ã¤ã‚’æºã‚‰ã™ã¨ã€åŒã˜é•·ã•ã®æŒ¯ã‚Šå­ã ã‘ãŒå¾ã€…ã«æŒ¯å‹•ã‚’å§‹ã‚ã‚‹ã€‚<br>
                ã“ã‚Œã¯ã€ç³¸ã®é•·ã•ã§æ±ºã¾ã‚‹å›ºæœ‰æŒ¯å‹•æ•°ãŒåŒã˜ã ã‹ã‚‰ï¼
            </div>
            
            <hr style="margin: 30px 0;">
            <h2>æˆæ¥­è³‡æ–™PDF</h2>
            <iframe src="https://drive.google.com/file/d/1rd3AUHNkj-NLM0IEztEdsiVOdPwxD6EA/preview" width="100%" height="500"></iframe>
        </div>
        
        <!-- ========== å•é¡Œã‚¿ãƒ– ========== -->
        <div id="problem" class="tab-content">
            <h2>ç¢ºèªå•é¡Œ</h2>
            
            <div class="problem">
                <h4>å•é¡Œ1ï¼šå¼¦ã®æŒ¯å‹•</h4>
                <p>
                    é•·ã•ãŒ $0.60$ m ã®å¼¦ãŒåŸºæœ¬æŒ¯å‹•ã€2å€æŒ¯å‹•ã€3å€æŒ¯å‹•ã™ã‚‹ã¨ãã®æ³¢é•· $\lambda_1$ã€$\lambda_2$ã€$\lambda_3$ ã‚’ãã‚Œãã‚Œæ±‚ã‚ã‚ˆã€‚<br>
                    ã¾ãŸã€å¼¦ã‚’ä¼ã‚ã‚‹æ³¢ã®é€Ÿã•ã‚’ $120$ m/s ã¨ã™ã‚‹ã¨ãã€ãã‚Œãã‚Œã®å ´åˆã®å›ºæœ‰æŒ¯å‹•æ•° $f_1$ã€$f_2$ã€$f_3$ ã‚’æ±‚ã‚ã‚ˆã€‚
                </p>
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="answer">
                        <p><strong>ã€æ³¢é•·ã®è¨ˆç®—ã€‘</strong></p>
                        <p>
                            å¼¦ã¯ä¸¡ç«¯ãŒç¯€ã«ãªã‚‹ã®ã§ã€$L = \dfrac{n\lambda_n}{2}$ ã‚ˆã‚Š $\lambda_n = \dfrac{2L}{n}$
                        </p>
                        <p>
                            ãƒ»åŸºæœ¬æŒ¯å‹•ï¼ˆ$n=1$ï¼‰ï¼š$\lambda_1 = \dfrac{2 \times 0.60}{1} = 1.2$ m<br>
                            ãƒ»2å€æŒ¯å‹•ï¼ˆ$n=2$ï¼‰ï¼š$\lambda_2 = \dfrac{2 \times 0.60}{2} = 0.60$ m<br>
                            ãƒ»3å€æŒ¯å‹•ï¼ˆ$n=3$ï¼‰ï¼š$\lambda_3 = \dfrac{2 \times 0.60}{3} = 0.40$ m
                        </p>
                        <p><strong>ã€æŒ¯å‹•æ•°ã®è¨ˆç®—ã€‘</strong></p>
                        <p>
                            $v = f\lambda$ ã‚ˆã‚Š $f = \dfrac{v}{\lambda}$
                        </p>
                        <p>
                            ãƒ»$f_1 = \dfrac{120}{1.2} = 100$ Hz<br>
                            ãƒ»$f_2 = \dfrac{120}{0.60} = 200$ Hz<br>
                            ãƒ»$f_3 = \dfrac{120}{0.40} = 300$ Hz
                        </p>
                        <p style="color: #667eea;">
                            <strong>ãƒã‚¤ãƒ³ãƒˆï¼š</strong>æŒ¯å‹•æ•°ã¯åŸºæœ¬æŒ¯å‹•æ•°ã®æ•´æ•°å€ï¼ˆ$f_n = nf_1$ï¼‰ã«ãªã£ã¦ã„ã‚‹ï¼
                        </p>
                    </div>
                </details>
            </div>
            
            <div class="problem">
                <h4>å•é¡Œ2ï¼šé–‰ç®¡ã®æ°—æŸ±å…±é³´</h4>
                <p>
                    é•·ã•ãŒ $0.60$ m ã®é–‰ç®¡å†…ã®æ°—æŸ±ãŒã‚ã‚‹æŒ¯å‹•æ•°ã®éŸ³ã§å…±é³´ã—ãŸã€‚ã“ã®ã¨ãã€ç®¡ã®åº•ä»¥å¤–ã«å®šåœ¨æ³¢ã®ç¯€ãŒ1ã‹æ‰€ã‚ã£ãŸã€‚<br>
                    éŸ³ã®é€Ÿã•ã‚’ $340$ m/s ã¨ã—ã€é–‹å£ç«¯è£œæ­£ã¯ç„¡è¦–ã™ã‚‹ã€‚
                </p>
                <p>
                    (1) é–‰ç®¡å†…ã«ã§ãã‚‹å®šåœ¨æ³¢ã®ã‚ˆã†ã™ã‚’å›³ç¤ºã›ã‚ˆã€‚<br>
                    (2) æ°—æŸ±å†…ã®éŸ³æ³¢ã®æ³¢é•· $\lambda$ ã¯ä½• m ã‹ã€‚<br>
                    (3) æ°—æŸ±å†…ã®éŸ³æ³¢ã®æŒ¯å‹•æ•° $f$ ã¯ä½• Hz ã‹ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="answer">
                        <p><strong>ã€(1) å®šåœ¨æ³¢ã®å›³ã€‘</strong></p>
                        <p>
                            é–‰ç®¡ã¯ã€Œå£ãŒè…¹ã€åº•ãŒç¯€ã€ã€‚åº•ä»¥å¤–ã«ç¯€ãŒ1ã‹æ‰€ã‚ã‚‹ã®ã§ã€ã“ã‚Œã¯<strong>3å€æŒ¯å‹•</strong>ã€‚<br>
                            ç®¡ã®ä¸­ã« $\dfrac{3}{4}\lambda$ ãŒå…¥ã£ã¦ã„ã‚‹çŠ¶æ…‹ã€‚
                        </p>
                        <p><strong>ã€(2) æ³¢é•·ã®è¨ˆç®—ã€‘</strong></p>
                        <p>
                            $L = \dfrac{3\lambda}{4}$ ã‚ˆã‚Š<br>
                            $0.60 = \dfrac{3\lambda}{4}$<br>
                            $\lambda = \dfrac{0.60 \times 4}{3} = 0.80$ m
                        </p>
                        <p><strong>ã€(3) æŒ¯å‹•æ•°ã®è¨ˆç®—ã€‘</strong></p>
                        <p>
                            $f = \dfrac{v}{\lambda} = \dfrac{340}{0.80} = 425$ Hz
                        </p>
                    </div>
                </details>
            </div>
            
            <div class="problem">
                <h4>å•é¡Œ3ï¼šé–‹ç®¡ã®æ°—æŸ±å…±é³´ã¨é–‹å£ç«¯è£œæ­£</h4>
                <p>
                    å›³ã®ã‚ˆã†ãªå…±é³´å®Ÿé¨“ã§ã€$500$ Hz ã®ãŠã‚“ã•ã‚’ç®¡å£ã«è¿‘ã¥ã‘ã€æ°´é¢ã‚’æ¬¡ç¬¬ã«ä¸‹ã’ã¦ã„ã£ãŸã¨ã“ã‚ã€æ°—æŸ±ã®é•·ã•ãŒ $16.4$ cm ã®ã¨ãã«åˆã‚ã¦å…±é³´ãŒèµ·ã“ã‚Šã€æ¬¡ã« $50.2$ cm ã«ãªã£ãŸã¨ãå†ã³å…±é³´ãŒèµ·ã“ã£ãŸã€‚
                </p>
                <p>
                    (1) ã“ã®ã¨ãã®éŸ³ã®é€Ÿã• $V$ ã¯ä½• m/s ã‹ã€‚<br>
                    (2) å…±é³´ã—ãŸã¨ãã®ç®¡å£ã®è…¹ã®ä½ç½®ã¯ã€ç®¡ã®ä¸Šç«¯ã‚ˆã‚Šã©ã‚Œã ã‘ä¸Šã«ã‚ã‚‹ã‹ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="answer">
                        <p><strong>ã€è€ƒãˆæ–¹ã€‘</strong></p>
                        <p>
                            ã“ã‚Œã¯é–‰ç®¡ã®å…±é³´å®Ÿé¨“ã€‚æœ€åˆã®å…±é³´ã¯åŸºæœ¬æŒ¯å‹•ã€2å›ç›®ã¯3å€æŒ¯å‹•ã€‚<br>
                            é–‹å£ç«¯è£œæ­£ã‚’ $\Delta x$ ã¨ã™ã‚‹ã¨ã€
                        </p>
                        <p>
                            åŸºæœ¬æŒ¯å‹•ï¼š$16.4 + \Delta x = \dfrac{\lambda}{4}$<br>
                            3å€æŒ¯å‹•ï¼š$50.2 + \Delta x = \dfrac{3\lambda}{4}$
                        </p>
                        <p><strong>ã€(1) éŸ³ã®é€Ÿã•ã€‘</strong></p>
                        <p>
                            2å¼ã‚’å¼•ãã¨ï¼š$(50.2 - 16.4) = \dfrac{3\lambda}{4} - \dfrac{\lambda}{4} = \dfrac{\lambda}{2}$<br>
                            $33.8 = \dfrac{\lambda}{2}$<br>
                            $\lambda = 67.6$ cm $= 0.676$ m
                        </p>
                        <p>
                            $V = f\lambda = 500 \times 0.676 = 338$ m/s
                        </p>
                        <p><strong>ã€(2) é–‹å£ç«¯è£œæ­£ã€‘</strong></p>
                        <p>
                            $\Delta x = \dfrac{\lambda}{4} - 16.4 = \dfrac{67.6}{4} - 16.4 = 16.9 - 16.4 = 0.5$ cm
                        </p>
                        <p style="color: #667eea;">
                            <strong>ãƒã‚¤ãƒ³ãƒˆï¼š</strong>2å›ã®å…±é³´ã®æ°—æŸ±ã®é•·ã•ã®å·®ã¯ $\dfrac{\lambda}{2}$ ã«ãªã‚‹ï¼
                        </p>
                    </div>
                </details>
            </div>
        </div>
        
        <!-- ========== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– ========== -->
        <div id="simulation" class="tab-content">
            <h2>å®Ÿé¨“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            
            <!-- å¼¦ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="sim-section">
                <h3>ğŸ¸ å¼¦ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
                <p>ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®æŒ¯å‹•æ•°ã‚’å¤‰ãˆã¦ã€å¼¦ãŒå…±é³´ã™ã‚‹æ§˜å­ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚å›ºæœ‰æŒ¯å‹•æ•°ã«ä¸€è‡´ã™ã‚‹ã¨å®šå¸¸æ³¢ãŒã§ãã¾ã™ï¼</p>
                
                <div id="sim-container">
                    <canvas id="stringCanvas"></canvas>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>å¼¦ã®é•·ã• L: <span class="value-display" id="stringLengthDisplay">1.0 m</span></label>
                        <input type="range" id="stringLengthSlider" min="0.5" max="2.0" value="1.0" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label>
                            ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®æŒ¯å‹•æ•° f: <span class="value-display" id="freqDisplay">100 Hz</span>
                            <span class="resonance-indicator not-resonating" id="resonanceIndicator">éå…±é³´</span>
                        </label>
                        <input type="range" id="freqSlider" min="50" max="500" value="100" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>å¼¦ã®å¼µåŠ›ï¼ˆæ³¢ã®é€Ÿã•ã«å½±éŸ¿ï¼‰: <span class="value-display" id="tensionDisplay">200 m/s</span></label>
                        <input type="range" id="tensionSlider" min="100" max="400" value="200" step="10">
                    </div>
                    
                    <div class="button-group">
                        <button class="sim-button start" id="stringStartBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button reset" id="stringResetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                    
                    <div class="info-display">
                        <p><strong>è¨ˆç®—å€¤</strong></p>
                        <p id="stringInfo1">åŸºæœ¬æŒ¯å‹•æ•° fâ‚ = 100.0 Hz</p>
                        <p id="stringInfo2">ç¾åœ¨ã®æŒ¯å‹•: å…±é³´ã—ã¦ã„ã¾ã›ã‚“</p>
                        <p id="stringInfo3">å›ºæœ‰æŒ¯å‹•æ•°: fâ‚=100Hz, fâ‚‚=200Hz, fâ‚ƒ=300Hz, ...</p>
                    </div>
                </div>
            </div>
            
            <!-- æ°—æŸ±ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="sim-section">
                <h3>ğŸº æ°—æŸ±ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
                <p>é–‰ç®¡ã¨é–‹ç®¡ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã€å®šå¸¸æ³¢ã®ã§ãæ–¹ã®é•ã„ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚</p>
                
                <div class="mode-toggle">
                    <button class="mode-btn active" id="closedPipeBtn" onclick="setPipeMode('closed')">é–‰ç®¡ï¼ˆä¸€ç«¯ãŒé–‰ï¼‰</button>
                    <button class="mode-btn" id="openPipeBtn" onclick="setPipeMode('open')">é–‹ç®¡ï¼ˆä¸¡ç«¯ãŒé–‹ï¼‰</button>
                </div>
                
                <div id="sim-container2">
                    <canvas id="pipeCanvas"></canvas>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>ç®¡ã®é•·ã• L: <span class="value-display" id="pipeLengthDisplay">0.5 m</span></label>
                        <input type="range" id="pipeLengthSlider" min="0.2" max="1.0" value="0.5" step="0.05">
                    </div>
                    
                    <div class="control-group">
                        <label>å€æŒ¯å‹•æ•° n: <span class="value-display" id="harmonicDisplay">1 å€æŒ¯å‹•</span></label>
                        <input type="range" id="harmonicSlider" min="1" max="7" value="1" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>
                            <input type="checkbox" id="showLongitudinalCheck"> ç¸¦æ³¢è¡¨ç¤ºã‚‚åŒæ™‚ã«è¦‹ã‚‹
                        </label>
                    </div>
                    
                    <div class="button-group">
                        <button class="sim-button start" id="pipeStartBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button reset" id="pipeResetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                    
                    <div class="info-display">
                        <p><strong>è¨ˆç®—å€¤ï¼ˆéŸ³é€Ÿ V = 340 m/sï¼‰</strong></p>
                        <p id="pipeInfo1">ç®¡ã®ç¨®é¡: é–‰ç®¡</p>
                        <p id="pipeInfo2">æ³¢é•· Î» = 2.00 m</p>
                        <p id="pipeInfo3">æŒ¯å‹•æ•° f = 170 Hz</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ =====
    function openTab(tabName) {
        var contents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < contents.length; i++) {
            contents[i].style.display = "none";
            contents[i].classList.remove("active");
        }
        var buttons = document.getElementsByClassName("tab-btn");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        if (event) {
            event.currentTarget.classList.add("active");
        }
        
        if (tabName === 'simulation') {
            resizeCanvases();
            drawString();
            drawPipe();
        }
    }

    // ===== å»ºç‰©ã®å›ºæœ‰æŒ¯å‹•ãƒ‡ãƒ¢ =====
    const buildingCanvas = document.getElementById('buildingCanvas');
    const buildingCtx = buildingCanvas.getContext('2d');
    const waveformCanvas = document.getElementById('waveformCanvas');
    const waveformCtx = waveformCanvas.getContext('2d');
    
    let selectedBuilding = 'house';
    let buildingAnimating = false;
    let buildingTime = 0;
    let buildingAnimationId = null;
    
    const buildingData = {
        house: { name: 'ä¸€æˆ¸å»ºã¦', frequency: 8, amplitude: 8, floors: 2, width: 80, height: 60, color: '#8B4513', roofColor: '#D2691E', info: 'å›ºæœ‰æŒ¯å‹•æ•°: ç´„ 5ã€œ10 Hzï¼ˆé€Ÿãå°åˆ»ã¿ã«æºã‚Œã‚‹ï¼‰' },
        apartment: { name: 'ãƒãƒ³ã‚·ãƒ§ãƒ³', frequency: 3, amplitude: 15, floors: 5, width: 100, height: 120, color: '#708090', roofColor: '#556677', info: 'å›ºæœ‰æŒ¯å‹•æ•°: ç´„ 2ã€œ5 Hzï¼ˆä¸­ç¨‹åº¦ã®é€Ÿã•ã§æºã‚Œã‚‹ï¼‰' },
        tower: { name: 'é«˜å±¤ãƒ“ãƒ«', frequency: 0.5, amplitude: 25, floors: 15, width: 60, height: 200, color: '#4682B4', roofColor: '#36648B', info: 'å›ºæœ‰æŒ¯å‹•æ•°: ç´„ 0.2ã€œ1 Hzï¼ˆã‚†ã£ãã‚Šå¤§ããæºã‚Œã‚‹ï¼‰' },
        bridge: { name: 'æ©‹', frequency: 1.5, amplitude: 20, floors: 1, width: 200, height: 30, color: '#696969', roofColor: '#A9A9A9', info: 'å›ºæœ‰æŒ¯å‹•æ•°: ç´„ 0.5ã€œ3 Hzï¼ˆã†ã­ã‚‹ã‚ˆã†ã«æºã‚Œã‚‹ï¼‰' }
    };
    
    function selectBuilding(type, btn) {
        selectedBuilding = type;
        document.querySelectorAll('.building-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('buildingInfo').textContent = buildingData[type].info;
        drawBuilding();
        drawWaveform();
    }
    
    function drawBuilding() {
        const W = buildingCanvas.width;
        const H = buildingCanvas.height;
        const data = buildingData[selectedBuilding];
        
        buildingCtx.fillStyle = '#e8f4fc';
        buildingCtx.fillRect(0, 0, W, H);
        
        buildingCtx.fillStyle = '#8B7355';
        buildingCtx.fillRect(0, H - 30, W, 30);
        buildingCtx.fillStyle = '#228B22';
        buildingCtx.fillRect(0, H - 35, W, 10);
        
        const baseX = W / 2;
        const baseY = H - 35;
        let sway = 0;
        if (buildingAnimating) {
            sway = Math.sin(buildingTime * data.frequency * 0.1) * data.amplitude;
        }
        
        if (selectedBuilding === 'bridge') {
            const bridgeY = baseY - 50;
            buildingCtx.fillStyle = '#555';
            buildingCtx.fillRect(baseX - 80, bridgeY, 15, 50);
            buildingCtx.fillRect(baseX + 65, bridgeY, 15, 50);
            
            buildingCtx.fillStyle = data.color;
            buildingCtx.beginPath();
            buildingCtx.moveTo(baseX - 100, bridgeY);
            for (let x = -100; x <= 100; x += 5) {
                const waveSway = buildingAnimating ? Math.sin((x / 50 + buildingTime * data.frequency * 0.1)) * data.amplitude * 0.3 : 0;
                buildingCtx.lineTo(baseX + x, bridgeY + waveSway);
            }
            buildingCtx.lineTo(baseX + 100, bridgeY + data.height);
            buildingCtx.lineTo(baseX - 100, bridgeY + data.height);
            buildingCtx.closePath();
            buildingCtx.fill();
        } else {
            const buildingLeft = baseX - data.width / 2;
            const buildingBottom = baseY;
            const floorHeight = data.height / data.floors;
            
            for (let floor = 0; floor < data.floors; floor++) {
                const floorRatio = (floor + 1) / data.floors;
                const floorSway = sway * floorRatio;
                const floorY = buildingBottom - (floor + 1) * floorHeight;
                
                buildingCtx.fillStyle = data.color;
                buildingCtx.fillRect(buildingLeft + floorSway * floorRatio, floorY, data.width, floorHeight - 2);
                
                buildingCtx.fillStyle = '#87CEEB';
                const windowCount = Math.min(data.floors > 5 ? 3 : 2, Math.floor(data.width / 30));
                const windowWidth = 15;
                const windowHeight = floorHeight * 0.5;
                const windowSpacing = data.width / (windowCount + 1);
                
                for (let w = 0; w < windowCount; w++) {
                    const windowX = buildingLeft + windowSpacing * (w + 1) - windowWidth / 2 + floorSway * floorRatio;
                    const windowY = floorY + (floorHeight - windowHeight) / 2;
                    buildingCtx.fillRect(windowX, windowY, windowWidth, windowHeight);
                }
            }
            
            if (selectedBuilding === 'house') {
                const roofSway = sway;
                buildingCtx.fillStyle = data.roofColor;
                buildingCtx.beginPath();
                buildingCtx.moveTo(buildingLeft - 10 + roofSway, buildingBottom - data.height);
                buildingCtx.lineTo(baseX + roofSway, buildingBottom - data.height - 30);
                buildingCtx.lineTo(buildingLeft + data.width + 10 + roofSway, buildingBottom - data.height);
                buildingCtx.closePath();
                buildingCtx.fill();
            }
        }
        
        buildingCtx.fillStyle = '#333';
        buildingCtx.font = 'bold 14px sans-serif';
        buildingCtx.textAlign = 'center';
        buildingCtx.fillText(data.name, W / 2, 25);
    }
    
    function drawWaveform() {
        const W = waveformCanvas.width;
        const H = waveformCanvas.height;
        const data = buildingData[selectedBuilding];
        
        waveformCtx.fillStyle = '#fafafa';
        waveformCtx.fillRect(0, 0, W, H);
        
        waveformCtx.strokeStyle = '#333';
        waveformCtx.lineWidth = 1;
        waveformCtx.beginPath();
        waveformCtx.moveTo(40, H / 2);
        waveformCtx.lineTo(W - 20, H / 2);
        waveformCtx.moveTo(40, 20);
        waveformCtx.lineTo(40, H - 20);
        waveformCtx.stroke();
        
        waveformCtx.fillStyle = '#333';
        waveformCtx.font = '12px sans-serif';
        waveformCtx.textAlign = 'center';
        waveformCtx.fillText('æ™‚é–“ t', W - 40, H / 2 + 20);
        
        waveformCtx.strokeStyle = '#e53935';
        waveformCtx.lineWidth = 2;
        waveformCtx.beginPath();
        
        const startX = 50;
        const endX = W - 30;
        const amplitude = 40;
        
        for (let x = startX; x <= endX; x++) {
            const t = (x - startX) / (endX - startX) * 4 * Math.PI;
            const phase = buildingAnimating ? buildingTime * data.frequency * 0.1 : 0;
            const y = H / 2 - Math.sin(t * data.frequency / 2 + phase) * amplitude * (data.amplitude / 25);
            if (x === startX) waveformCtx.moveTo(x, y);
            else waveformCtx.lineTo(x, y);
        }
        waveformCtx.stroke();
        
        waveformCtx.fillStyle = '#667eea';
        waveformCtx.font = '11px sans-serif';
        const period = (1 / data.frequency).toFixed(2);
        waveformCtx.fillText(`å‘¨æœŸ T â‰ˆ ${period} ç§’`, W / 2, H - 10);
    }
    
    function toggleBuildingAnimation() {
        if (buildingAnimating) {
            buildingAnimating = false;
            document.getElementById('buildingStartBtn').textContent = 'åœ°éœ‡ç™ºç”Ÿï¼';
            cancelAnimationFrame(buildingAnimationId);
        } else {
            buildingAnimating = true;
            document.getElementById('buildingStartBtn').textContent = 'åœæ­¢';
            animateBuilding();
        }
    }
    
    function animateBuilding() {
        if (!buildingAnimating) return;
        buildingTime++;
        drawBuilding();
        drawWaveform();
        buildingAnimationId = requestAnimationFrame(animateBuilding);
    }

    // ===== å¼¦ã®å®šå¸¸æ³¢å¯è¦–åŒ– =====
    const stringWaveCanvas = document.getElementById('stringWaveCanvas');
    const stringWaveCtx = stringWaveCanvas.getContext('2d');
    let currentStringHarmonic = 1;
    
    function setStringHarmonic(n, btn) {
        currentStringHarmonic = n;
        document.querySelectorAll('#stringWaveControls .wave-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const infoTexts = {
            1: 'åŸºæœ¬æŒ¯å‹•: L = Î»â‚/2 â†’ Î»â‚ = 2L ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ1å€‹å…¥ã‚‹ï¼‰',
            2: '2å€æŒ¯å‹•: L = Î»â‚‚ â†’ Î»â‚‚ = L ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ2å€‹å…¥ã‚‹ï¼‰',
            3: '3å€æŒ¯å‹•: L = 3Î»â‚ƒ/2 â†’ Î»â‚ƒ = 2L/3 ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ3å€‹å…¥ã‚‹ï¼‰',
            4: '4å€æŒ¯å‹•: L = 2Î»â‚„ â†’ Î»â‚„ = L/2 ï¼ˆå¼¦ã®ä¸­ã«åŠæ³¢é•·ãŒ4å€‹å…¥ã‚‹ï¼‰'
        };
        document.getElementById('stringWaveInfo').textContent = infoTexts[n];
        drawStringWave();
    }
    
    function drawStringWave() {
        const W = stringWaveCanvas.width;
        const H = stringWaveCanvas.height;
        const n = currentStringHarmonic;
        
        stringWaveCtx.fillStyle = '#fafafa';
        stringWaveCtx.fillRect(0, 0, W, H);
        
        const margin = 60;
        const stringY = H / 2;
        const stringStartX = margin;
        const stringEndX = W - margin;
        const stringLength = stringEndX - stringStartX;
        const amplitude = 50;
        
        // å£
        stringWaveCtx.fillStyle = '#555';
        stringWaveCtx.fillRect(stringStartX - 15, stringY - 40, 15, 80);
        stringWaveCtx.fillRect(stringEndX, stringY - 40, 15, 80);
        
        // é™æ­¢ä½ç½®ã®ç·š
        stringWaveCtx.strokeStyle = '#ccc';
        stringWaveCtx.lineWidth = 1;
        stringWaveCtx.setLineDash([5, 5]);
        stringWaveCtx.beginPath();
        stringWaveCtx.moveTo(stringStartX, stringY);
        stringWaveCtx.lineTo(stringEndX, stringY);
        stringWaveCtx.stroke();
        stringWaveCtx.setLineDash([]);
        
        // åŒ…çµ¡ç·šï¼ˆç ´ç·šï¼‰
        stringWaveCtx.strokeStyle = '#e53935';
        stringWaveCtx.lineWidth = 1;
        stringWaveCtx.setLineDash([5, 5]);
        
        stringWaveCtx.beginPath();
        for (let px = 0; px <= stringLength; px++) {
            const x = stringStartX + px;
            const ratio = px / stringLength;
            const envelope = Math.abs(Math.sin(n * Math.PI * ratio));
            const y = stringY - amplitude * envelope;
            if (px === 0) stringWaveCtx.moveTo(x, y);
            else stringWaveCtx.lineTo(x, y);
        }
        stringWaveCtx.stroke();
        
        stringWaveCtx.beginPath();
        for (let px = 0; px <= stringLength; px++) {
            const x = stringStartX + px;
            const ratio = px / stringLength;
            const envelope = Math.abs(Math.sin(n * Math.PI * ratio));
            const y = stringY + amplitude * envelope;
            if (px === 0) stringWaveCtx.moveTo(x, y);
            else stringWaveCtx.lineTo(x, y);
        }
        stringWaveCtx.stroke();
        stringWaveCtx.setLineDash([]);
        
        // ç¾åœ¨ã®æ³¢å½¢ï¼ˆå®Ÿç·šï¼‰
        stringWaveCtx.strokeStyle = '#e53935';
        stringWaveCtx.lineWidth = 3;
        stringWaveCtx.beginPath();
        for (let px = 0; px <= stringLength; px++) {
            const x = stringStartX + px;
            const ratio = px / stringLength;
            const y = stringY - amplitude * Math.sin(n * Math.PI * ratio);
            if (px === 0) stringWaveCtx.moveTo(x, y);
            else stringWaveCtx.lineTo(x, y);
        }
        stringWaveCtx.stroke();
        
        // ç¯€ã®ä½ç½®ï¼ˆé’ä¸¸ï¼‰- sin = 0 ã®ä½ç½®: ratio = 0, 1/n, 2/n, ..., 1
        stringWaveCtx.fillStyle = '#2196F3';
        for (let i = 0; i <= n; i++) {
            const nodeX = stringStartX + (i / n) * stringLength;
            stringWaveCtx.beginPath();
            stringWaveCtx.arc(nodeX, stringY, 8, 0, Math.PI * 2);
            stringWaveCtx.fill();
        }
        
        // è…¹ã®ä½ç½®ï¼ˆç·‘ä¸¸ï¼‰- sin = Â±1 ã®ä½ç½®: ratio = 0.5/n, 1.5/n, ...
        stringWaveCtx.fillStyle = '#4CAF50';
        for (let i = 0; i < n; i++) {
            const antiNodeRatio = (i + 0.5) / n;
            const antiNodeX = stringStartX + antiNodeRatio * stringLength;
            const antiNodeY = stringY - amplitude * Math.sin(n * Math.PI * antiNodeRatio);
            stringWaveCtx.beginPath();
            stringWaveCtx.arc(antiNodeX, antiNodeY, 8, 0, Math.PI * 2);
            stringWaveCtx.fill();
        }
        
        // é•·ã•è¡¨ç¤º
        stringWaveCtx.strokeStyle = '#667eea';
        stringWaveCtx.lineWidth = 2;
        stringWaveCtx.beginPath();
        stringWaveCtx.moveTo(stringStartX, stringY + 70);
        stringWaveCtx.lineTo(stringEndX, stringY + 70);
        stringWaveCtx.stroke();
        
        stringWaveCtx.fillStyle = '#667eea';
        stringWaveCtx.beginPath();
        stringWaveCtx.moveTo(stringStartX, stringY + 70);
        stringWaveCtx.lineTo(stringStartX + 10, stringY + 65);
        stringWaveCtx.lineTo(stringStartX + 10, stringY + 75);
        stringWaveCtx.closePath();
        stringWaveCtx.fill();
        
        stringWaveCtx.beginPath();
        stringWaveCtx.moveTo(stringEndX, stringY + 70);
        stringWaveCtx.lineTo(stringEndX - 10, stringY + 65);
        stringWaveCtx.lineTo(stringEndX - 10, stringY + 75);
        stringWaveCtx.closePath();
        stringWaveCtx.fill();
        
        stringWaveCtx.font = '14px sans-serif';
        stringWaveCtx.textAlign = 'center';
        stringWaveCtx.fillText('L', (stringStartX + stringEndX) / 2, stringY + 90);
        
        // å‡¡ä¾‹
        stringWaveCtx.font = '12px sans-serif';
        stringWaveCtx.textAlign = 'left';
        stringWaveCtx.fillStyle = '#4CAF50';
        stringWaveCtx.fillText('â— è…¹', 10, 20);
        stringWaveCtx.fillStyle = '#2196F3';
        stringWaveCtx.fillText('â— ç¯€', 10, 38);
        
        // åŠæ³¢é•·ã®æ•°ã‚’è¡¨ç¤º
        stringWaveCtx.fillStyle = '#764ba2';
        stringWaveCtx.font = 'bold 14px sans-serif';
        stringWaveCtx.textAlign = 'center';
        stringWaveCtx.fillText(`Î»/2 ãŒ ${n} å€‹å…¥ã‚‹`, (stringStartX + stringEndX) / 2, 25);
    }

    // ===== é–‰ç®¡ã®å®šå¸¸æ³¢å¯è¦–åŒ– =====
    const closedPipeWaveCanvas = document.getElementById('closedPipeWaveCanvas');
    const closedPipeWaveCtx = closedPipeWaveCanvas.getContext('2d');
    let currentClosedPipeHarmonic = 1;
    
    function setClosedPipeHarmonic(n, btn) {
        currentClosedPipeHarmonic = n;
        document.querySelectorAll('#closedPipeWaveControls .wave-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const infoTexts = {
            1: 'åŸºæœ¬æŒ¯å‹•: L = Î»â‚/4 â†’ Î»â‚ = 4L ï¼ˆç®¡ã®ä¸­ã«1/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            3: '3å€æŒ¯å‹•: L = 3Î»â‚ƒ/4 â†’ Î»â‚ƒ = 4L/3 ï¼ˆç®¡ã®ä¸­ã«3/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            5: '5å€æŒ¯å‹•: L = 5Î»â‚…/4 â†’ Î»â‚… = 4L/5 ï¼ˆç®¡ã®ä¸­ã«5/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            7: '7å€æŒ¯å‹•: L = 7Î»â‚‡/4 â†’ Î»â‚‡ = 4L/7 ï¼ˆç®¡ã®ä¸­ã«7/4æ³¢é•·ãŒå…¥ã‚‹ï¼‰'
        };
        document.getElementById('closedPipeWaveInfo').textContent = infoTexts[n];
        drawClosedPipeWave();
    }
    
    function drawClosedPipeWave() {
        const W = closedPipeWaveCanvas.width;
        const H = closedPipeWaveCanvas.height;
        const n = currentClosedPipeHarmonic;
        
        closedPipeWaveCtx.fillStyle = '#fafafa';
        closedPipeWaveCtx.fillRect(0, 0, W, H);
        
        const pipeTop = 40;
        const pipeBottom = H - 40;
        const pipeHeight = pipeBottom - pipeTop;
        const pipeWidth = 60;
        const pipeCenterX = W / 2;
        const pipeLeft = pipeCenterX - pipeWidth / 2;
        const pipeRight = pipeCenterX + pipeWidth / 2;
        const amplitude = 40;
        
        // ç®¡ã®å£
        closedPipeWaveCtx.strokeStyle = '#555';
        closedPipeWaveCtx.lineWidth = 4;
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeLeft, pipeTop);
        closedPipeWaveCtx.lineTo(pipeLeft, pipeBottom);
        closedPipeWaveCtx.lineTo(pipeRight, pipeBottom);
        closedPipeWaveCtx.lineTo(pipeRight, pipeTop);
        closedPipeWaveCtx.stroke();
        
        // åº•ã®æ–œç·š
        closedPipeWaveCtx.strokeStyle = '#888';
        closedPipeWaveCtx.lineWidth = 2;
        for (let i = 0; i < pipeWidth; i += 8) {
            closedPipeWaveCtx.beginPath();
            closedPipeWaveCtx.moveTo(pipeLeft + i, pipeBottom);
            closedPipeWaveCtx.lineTo(pipeLeft + i + 8, pipeBottom + 8);
            closedPipeWaveCtx.stroke();
        }
        
        // ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³
        closedPipeWaveCtx.fillStyle = '#333';
        closedPipeWaveCtx.font = '20px sans-serif';
        closedPipeWaveCtx.textAlign = 'center';
        closedPipeWaveCtx.fillText('ğŸ”Š', pipeCenterX, pipeTop - 10);
        
        // é™æ­¢ä½ç½®ã®ç·š
        closedPipeWaveCtx.strokeStyle = '#ccc';
        closedPipeWaveCtx.lineWidth = 1;
        closedPipeWaveCtx.setLineDash([5, 5]);
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeCenterX, pipeTop);
        closedPipeWaveCtx.lineTo(pipeCenterX, pipeBottom);
        closedPipeWaveCtx.stroke();
        closedPipeWaveCtx.setLineDash([]);
        
        // é–‰ç®¡ã®å®šå¸¸æ³¢: å£(top)ãŒè…¹ã€åº•(bottom)ãŒç¯€
        // å¤‰ä½åˆ†å¸ƒ: cos(n*Ï€/2 * (1 - ratio)) = cos(n*Ï€/2 - n*Ï€*ratio/2)
        // ratio=0 (å£) â†’ cos(n*Ï€/2) ... n=1ã®ã¨ã cos(Ï€/2)=0 ??? ã“ã‚Œã¯ãŠã‹ã—ã„
        // ä¿®æ­£: é–‰ç®¡ã¯å£ãŒè…¹ã€åº•ãŒç¯€ãªã®ã§ã€å£ã§cos=1ã€åº•ã§cos=0ã«ãªã‚‹ã¹ã
        // ã¤ã¾ã‚Š cos(Ï€/2 * ratio * n) ã§ ratio=0â†’1, åº•ã§n*Ï€/2ãŒå¥‡æ•°Ã—Ï€/2
        // å®Ÿéš›ã«ã¯: å£ã‹ã‚‰æ¸¬ã£ãŸè·é›¢ã‚’yã¨ã™ã‚‹ã¨ã€å¤‰ä½âˆcos(k*y) ã§ k=nÏ€/(2L)
        // y=0(å£)ã§cos(0)=1(è…¹)ã€y=L(åº•)ã§cos(nÏ€/2)
        // n=1: cos(Ï€/2)=0 â†’ ç¯€ âœ“
        // n=3: cos(3Ï€/2)=0 â†’ ç¯€ âœ“
        
        // åŒ…çµ¡ç·š
        closedPipeWaveCtx.strokeStyle = '#e53935';
        closedPipeWaveCtx.lineWidth = 1;
        closedPipeWaveCtx.setLineDash([5, 5]);
        
        closedPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight; // 0=å£, 1=åº•
            const envelope = Math.abs(Math.cos(n * Math.PI * ratio / 2)) * amplitude;
            if (py === 0) closedPipeWaveCtx.moveTo(pipeCenterX + envelope, y);
            else closedPipeWaveCtx.lineTo(pipeCenterX + envelope, y);
        }
        closedPipeWaveCtx.stroke();
        
        closedPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const envelope = Math.abs(Math.cos(n * Math.PI * ratio / 2)) * amplitude;
            if (py === 0) closedPipeWaveCtx.moveTo(pipeCenterX - envelope, y);
            else closedPipeWaveCtx.lineTo(pipeCenterX - envelope, y);
        }
        closedPipeWaveCtx.stroke();
        closedPipeWaveCtx.setLineDash([]);
        
        // å®šå¸¸æ³¢ï¼ˆå®Ÿç·šï¼‰
        closedPipeWaveCtx.strokeStyle = '#e53935';
        closedPipeWaveCtx.lineWidth = 3;
        closedPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const displacement = Math.cos(n * Math.PI * ratio / 2) * amplitude;
            const x = pipeCenterX + displacement;
            if (py === 0) closedPipeWaveCtx.moveTo(x, y);
            else closedPipeWaveCtx.lineTo(x, y);
        }
        closedPipeWaveCtx.stroke();
        
        // è…¹ã®ä½ç½®: cos = Â±1 â†’ n*Ï€*ratio/2 = 0, Ï€, 2Ï€, ... â†’ ratio = 0, 2/n, 4/n, ...
        closedPipeWaveCtx.fillStyle = '#4CAF50';
        for (let k = 0; k <= n; k++) {
            const ratio = (2 * k) / n;
            if (ratio <= 1) {
                const markerY = pipeTop + ratio * pipeHeight;
                const displacement = Math.cos(n * Math.PI * ratio / 2) * amplitude;
                closedPipeWaveCtx.beginPath();
                closedPipeWaveCtx.arc(pipeCenterX + displacement, markerY, 8, 0, Math.PI * 2);
                closedPipeWaveCtx.fill();
            }
        }
        
        // ç¯€ã®ä½ç½®: cos = 0 â†’ n*Ï€*ratio/2 = Ï€/2, 3Ï€/2, ... â†’ ratio = 1/n, 3/n, 5/n, ...
        closedPipeWaveCtx.fillStyle = '#2196F3';
        for (let k = 0; k <= n; k++) {
            const ratio = (2 * k + 1) / n;
            if (ratio <= 1) {
                const markerY = pipeTop + ratio * pipeHeight;
                closedPipeWaveCtx.beginPath();
                closedPipeWaveCtx.arc(pipeCenterX, markerY, 8, 0, Math.PI * 2);
                closedPipeWaveCtx.fill();
            }
        }
        
        // é•·ã•è¡¨ç¤º
        closedPipeWaveCtx.strokeStyle = '#667eea';
        closedPipeWaveCtx.lineWidth = 2;
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeLeft - 30, pipeTop);
        closedPipeWaveCtx.lineTo(pipeLeft - 30, pipeBottom);
        closedPipeWaveCtx.stroke();
        
        closedPipeWaveCtx.fillStyle = '#667eea';
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeLeft - 30, pipeTop);
        closedPipeWaveCtx.lineTo(pipeLeft - 35, pipeTop + 10);
        closedPipeWaveCtx.lineTo(pipeLeft - 25, pipeTop + 10);
        closedPipeWaveCtx.closePath();
        closedPipeWaveCtx.fill();
        
        closedPipeWaveCtx.beginPath();
        closedPipeWaveCtx.moveTo(pipeLeft - 30, pipeBottom);
        closedPipeWaveCtx.lineTo(pipeLeft - 35, pipeBottom - 10);
        closedPipeWaveCtx.lineTo(pipeLeft - 25, pipeBottom - 10);
        closedPipeWaveCtx.closePath();
        closedPipeWaveCtx.fill();
        
        closedPipeWaveCtx.font = '14px sans-serif';
        closedPipeWaveCtx.textAlign = 'center';
        closedPipeWaveCtx.save();
        closedPipeWaveCtx.translate(pipeLeft - 50, (pipeTop + pipeBottom) / 2);
        closedPipeWaveCtx.rotate(-Math.PI / 2);
        closedPipeWaveCtx.fillText('L', 0, 0);
        closedPipeWaveCtx.restore();
        
        // ãƒ©ãƒ™ãƒ«
        closedPipeWaveCtx.font = '12px sans-serif';
        closedPipeWaveCtx.textAlign = 'left';
        closedPipeWaveCtx.fillStyle = '#333';
        closedPipeWaveCtx.fillText('å£ï¼ˆé–‹ï¼‰â†’ è…¹', pipeRight + 50, pipeTop + 5);
        closedPipeWaveCtx.fillText('åº•ï¼ˆé–‰ï¼‰â†’ ç¯€', pipeRight + 50, pipeBottom + 5);
        
        // å‡¡ä¾‹
        closedPipeWaveCtx.fillStyle = '#4CAF50';
        closedPipeWaveCtx.fillText('â— è…¹', 10, 20);
        closedPipeWaveCtx.fillStyle = '#2196F3';
        closedPipeWaveCtx.fillText('â— ç¯€', 10, 38);
        
        // æ³¢é•·ã®æ•°ã‚’è¡¨ç¤º
        closedPipeWaveCtx.fillStyle = '#764ba2';
        closedPipeWaveCtx.font = 'bold 14px sans-serif';
        closedPipeWaveCtx.textAlign = 'right';
        closedPipeWaveCtx.fillText(`Î»/4 ãŒ ${n} å€‹å…¥ã‚‹`, W - 10, 25);
    }

    // ===== é–‹ç®¡ã®å®šå¸¸æ³¢å¯è¦–åŒ– =====
    const openPipeWaveCanvas = document.getElementById('openPipeWaveCanvas');
    const openPipeWaveCtx = openPipeWaveCanvas.getContext('2d');
    let currentOpenPipeHarmonic = 1;
    
    function setOpenPipeHarmonic(n, btn) {
        currentOpenPipeHarmonic = n;
        document.querySelectorAll('#openPipeWaveControls .wave-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const infoTexts = {
            1: 'åŸºæœ¬æŒ¯å‹•: L = Î»â‚/2 â†’ Î»â‚ = 2L ï¼ˆç®¡ã®ä¸­ã«åŠæ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            2: '2å€æŒ¯å‹•: L = Î»â‚‚ â†’ Î»â‚‚ = L ï¼ˆç®¡ã®ä¸­ã«1æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            3: '3å€æŒ¯å‹•: L = 3Î»â‚ƒ/2 â†’ Î»â‚ƒ = 2L/3 ï¼ˆç®¡ã®ä¸­ã«3/2æ³¢é•·ãŒå…¥ã‚‹ï¼‰',
            4: '4å€æŒ¯å‹•: L = 2Î»â‚„ â†’ Î»â‚„ = L/2 ï¼ˆç®¡ã®ä¸­ã«2æ³¢é•·ãŒå…¥ã‚‹ï¼‰'
        };
        document.getElementById('openPipeWaveInfo').textContent = infoTexts[n];
        drawOpenPipeWave();
    }
    
    function drawOpenPipeWave() {
        const W = openPipeWaveCanvas.width;
        const H = openPipeWaveCanvas.height;
        const n = currentOpenPipeHarmonic;
        
        openPipeWaveCtx.fillStyle = '#fafafa';
        openPipeWaveCtx.fillRect(0, 0, W, H);
        
        const pipeTop = 40;
        const pipeBottom = H - 40;
        const pipeHeight = pipeBottom - pipeTop;
        const pipeWidth = 60;
        const pipeCenterX = W / 2;
        const pipeLeft = pipeCenterX - pipeWidth / 2;
        const pipeRight = pipeCenterX + pipeWidth / 2;
        const amplitude = 40;
        
        // ç®¡ã®å£ï¼ˆä¸¡ç«¯é–‹æ”¾ï¼‰
        openPipeWaveCtx.strokeStyle = '#555';
        openPipeWaveCtx.lineWidth = 4;
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeLeft, pipeTop);
        openPipeWaveCtx.lineTo(pipeLeft, pipeBottom);
        openPipeWaveCtx.stroke();
        
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeRight, pipeTop);
        openPipeWaveCtx.lineTo(pipeRight, pipeBottom);
        openPipeWaveCtx.stroke();
        
        // ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³
        openPipeWaveCtx.fillStyle = '#333';
        openPipeWaveCtx.font = '20px sans-serif';
        openPipeWaveCtx.textAlign = 'center';
        openPipeWaveCtx.fillText('ğŸ”Š', pipeCenterX, pipeTop - 10);
        
        // é™æ­¢ä½ç½®ã®ç·š
        openPipeWaveCtx.strokeStyle = '#ccc';
        openPipeWaveCtx.lineWidth = 1;
        openPipeWaveCtx.setLineDash([5, 5]);
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeCenterX, pipeTop);
        openPipeWaveCtx.lineTo(pipeCenterX, pipeBottom);
        openPipeWaveCtx.stroke();
        openPipeWaveCtx.setLineDash([]);
        
        // é–‹ç®¡: ä¸¡ç«¯ãŒè…¹ â†’ cos(n*Ï€*ratio) ã§ ratio=0ã¨1ã§cos=Â±1
        
        // åŒ…çµ¡ç·š
        openPipeWaveCtx.strokeStyle = '#e53935';
        openPipeWaveCtx.lineWidth = 1;
        openPipeWaveCtx.setLineDash([5, 5]);
        
        openPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const envelope = Math.abs(Math.cos(n * Math.PI * ratio)) * amplitude;
            if (py === 0) openPipeWaveCtx.moveTo(pipeCenterX + envelope, y);
            else openPipeWaveCtx.lineTo(pipeCenterX + envelope, y);
        }
        openPipeWaveCtx.stroke();
        
        openPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const envelope = Math.abs(Math.cos(n * Math.PI * ratio)) * amplitude;
            if (py === 0) openPipeWaveCtx.moveTo(pipeCenterX - envelope, y);
            else openPipeWaveCtx.lineTo(pipeCenterX - envelope, y);
        }
        openPipeWaveCtx.stroke();
        openPipeWaveCtx.setLineDash([]);
        
        // å®šå¸¸æ³¢ï¼ˆå®Ÿç·šï¼‰
        openPipeWaveCtx.strokeStyle = '#e53935';
        openPipeWaveCtx.lineWidth = 3;
        openPipeWaveCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            const displacement = Math.cos(n * Math.PI * ratio) * amplitude;
            const x = pipeCenterX + displacement;
            if (py === 0) openPipeWaveCtx.moveTo(x, y);
            else openPipeWaveCtx.lineTo(x, y);
        }
        openPipeWaveCtx.stroke();
        
        // è…¹ã®ä½ç½®: cos = Â±1 â†’ n*Ï€*ratio = 0, Ï€, 2Ï€, ... â†’ ratio = 0, 1/n, 2/n, ...
        openPipeWaveCtx.fillStyle = '#4CAF50';
        for (let k = 0; k <= n; k++) {
            const ratio = k / n;
            const markerY = pipeTop + ratio * pipeHeight;
            const displacement = Math.cos(n * Math.PI * ratio) * amplitude;
            openPipeWaveCtx.beginPath();
            openPipeWaveCtx.arc(pipeCenterX + displacement, markerY, 8, 0, Math.PI * 2);
            openPipeWaveCtx.fill();
        }
        
        // ç¯€ã®ä½ç½®: cos = 0 â†’ n*Ï€*ratio = Ï€/2, 3Ï€/2, ... â†’ ratio = 1/(2n), 3/(2n), ...
        openPipeWaveCtx.fillStyle = '#2196F3';
        for (let k = 0; k < n; k++) {
            const ratio = (2 * k + 1) / (2 * n);
            const markerY = pipeTop + ratio * pipeHeight;
            openPipeWaveCtx.beginPath();
            openPipeWaveCtx.arc(pipeCenterX, markerY, 8, 0, Math.PI * 2);
            openPipeWaveCtx.fill();
        }
        
        // é•·ã•è¡¨ç¤º
        openPipeWaveCtx.strokeStyle = '#667eea';
        openPipeWaveCtx.lineWidth = 2;
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeLeft - 30, pipeTop);
        openPipeWaveCtx.lineTo(pipeLeft - 30, pipeBottom);
        openPipeWaveCtx.stroke();
        
        openPipeWaveCtx.fillStyle = '#667eea';
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeLeft - 30, pipeTop);
        openPipeWaveCtx.lineTo(pipeLeft - 35, pipeTop + 10);
        openPipeWaveCtx.lineTo(pipeLeft - 25, pipeTop + 10);
        openPipeWaveCtx.closePath();
        openPipeWaveCtx.fill();
        
        openPipeWaveCtx.beginPath();
        openPipeWaveCtx.moveTo(pipeLeft - 30, pipeBottom);
        openPipeWaveCtx.lineTo(pipeLeft - 35, pipeBottom - 10);
        openPipeWaveCtx.lineTo(pipeLeft - 25, pipeBottom - 10);
        openPipeWaveCtx.closePath();
        openPipeWaveCtx.fill();
        
        openPipeWaveCtx.font = '14px sans-serif';
        openPipeWaveCtx.textAlign = 'center';
        openPipeWaveCtx.save();
        openPipeWaveCtx.translate(pipeLeft - 50, (pipeTop + pipeBottom) / 2);
        openPipeWaveCtx.rotate(-Math.PI / 2);
        openPipeWaveCtx.fillText('L', 0, 0);
        openPipeWaveCtx.restore();
        
        // ãƒ©ãƒ™ãƒ«
        openPipeWaveCtx.font = '12px sans-serif';
        openPipeWaveCtx.textAlign = 'left';
        openPipeWaveCtx.fillStyle = '#333';
        openPipeWaveCtx.fillText('å£ï¼ˆé–‹ï¼‰â†’ è…¹', pipeRight + 50, pipeTop + 5);
        openPipeWaveCtx.fillText('åº•ï¼ˆé–‹ï¼‰â†’ è…¹', pipeRight + 50, pipeBottom + 5);
        
        // å‡¡ä¾‹
        openPipeWaveCtx.fillStyle = '#4CAF50';
        openPipeWaveCtx.fillText('â— è…¹', 10, 20);
        openPipeWaveCtx.fillStyle = '#2196F3';
        openPipeWaveCtx.fillText('â— ç¯€', 10, 38);
        
        // æ³¢é•·ã®æ•°ã‚’è¡¨ç¤º
        openPipeWaveCtx.fillStyle = '#764ba2';
        openPipeWaveCtx.font = 'bold 14px sans-serif';
        openPipeWaveCtx.textAlign = 'right';
        openPipeWaveCtx.fillText(`Î»/2 ãŒ ${n} å€‹å…¥ã‚‹`, W - 10, 25);
    }

    // ===== é–‹å£ç«¯è£œæ­£ã®å¯è¦–åŒ– =====
    const endCorrectionCanvas = document.getElementById('endCorrectionCanvas');
    const endCorrectionCtx = endCorrectionCanvas.getContext('2d');
    
    function drawEndCorrection() {
        const W = endCorrectionCanvas.width;
        const H = endCorrectionCanvas.height;
        
        endCorrectionCtx.fillStyle = '#fafafa';
        endCorrectionCtx.fillRect(0, 0, W, H);
        
        const pipeLeft = 60;
        const pipeRight = W - 140;
        const pipeY = H / 2;
        const pipeWidth = 40;
        const amplitude = 25;
        
        // ç®¡ã®å£ï¼ˆæ¨ªå‘ãï¼šå·¦ãŒé–‰ã€å³ãŒé–‹ï¼‰
        endCorrectionCtx.strokeStyle = '#555';
        endCorrectionCtx.lineWidth = 4;
        // ä¸Šå£
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeLeft, pipeY - pipeWidth);
        endCorrectionCtx.lineTo(pipeRight, pipeY - pipeWidth);
        endCorrectionCtx.stroke();
        // ä¸‹å£
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeLeft, pipeY + pipeWidth);
        endCorrectionCtx.lineTo(pipeRight, pipeY + pipeWidth);
        endCorrectionCtx.stroke();
        // å·¦å£ï¼ˆé–‰ã˜ãŸç«¯ï¼‰
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeLeft, pipeY - pipeWidth);
        endCorrectionCtx.lineTo(pipeLeft, pipeY + pipeWidth);
        endCorrectionCtx.stroke();
        
        // æ–œç·šï¼ˆé–‰ã˜ãŸç«¯ï¼‰
        endCorrectionCtx.strokeStyle = '#888';
        endCorrectionCtx.lineWidth = 2;
        for (let y = -pipeWidth; y < pipeWidth; y += 10) {
            endCorrectionCtx.beginPath();
            endCorrectionCtx.moveTo(pipeLeft, pipeY + y);
            endCorrectionCtx.lineTo(pipeLeft - 10, pipeY + y + 10);
            endCorrectionCtx.stroke();
        }
        
        // é–‹å£ç«¯è£œæ­£ã®ç¯„å›²
        const deltaX = 35;
        const actualEnd = pipeRight + deltaX;
        
        // Î”xã®é ˜åŸŸã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        endCorrectionCtx.fillStyle = 'rgba(255, 152, 0, 0.2)';
        endCorrectionCtx.fillRect(pipeRight, pipeY - pipeWidth - 10, deltaX, pipeWidth * 2 + 20);
        
        // å®šå¸¸æ³¢ï¼ˆåŸºæœ¬æŒ¯å‹•ï¼šå·¦ãŒç¯€ã€å³ãŒè…¹ï¼‰
        // æ¨ªå‘ããªã®ã§ã€xæ–¹å‘ã«æ²¿ã£ã¦cosæ³¢ã‚’æã
        // x=pipeLeft(ç¯€)ã§cos=0ã€x=actualEnd(è…¹)ã§cos=1
        // â†’ sin( Ï€/2 * (x - pipeLeft) / (actualEnd - pipeLeft) )
        endCorrectionCtx.strokeStyle = '#e53935';
        endCorrectionCtx.lineWidth = 3;
        endCorrectionCtx.beginPath();
        
        const totalLength = actualEnd - pipeLeft;
        for (let px = 0; px <= totalLength; px++) {
            const x = pipeLeft + px;
            const ratio = px / totalLength;
            // ç¯€(å·¦)ã‹ã‚‰è…¹(å³)ã¸: sin(Ï€/2 * ratio)
            const displacement = Math.sin(Math.PI / 2 * ratio) * amplitude;
            const y = pipeY - displacement;
            if (px === 0) endCorrectionCtx.moveTo(x, y);
            else endCorrectionCtx.lineTo(x, y);
        }
        endCorrectionCtx.stroke();
        
        // ç®¡ã®ç«¯ã®ä½ç½®ï¼ˆç ´ç·šï¼‰
        endCorrectionCtx.strokeStyle = '#2196F3';
        endCorrectionCtx.lineWidth = 2;
        endCorrectionCtx.setLineDash([5, 5]);
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeRight, pipeY - pipeWidth - 20);
        endCorrectionCtx.lineTo(pipeRight, pipeY + pipeWidth + 30);
        endCorrectionCtx.stroke();
        endCorrectionCtx.setLineDash([]);
        
        // ç¯€ã®ãƒãƒ¼ã‚«ãƒ¼ï¼ˆå·¦ç«¯ï¼‰
        endCorrectionCtx.fillStyle = '#2196F3';
        endCorrectionCtx.beginPath();
        endCorrectionCtx.arc(pipeLeft, pipeY, 8, 0, Math.PI * 2);
        endCorrectionCtx.fill();
        
        // å®Ÿéš›ã®è…¹ã®ä½ç½®ï¼ˆå³ç«¯å¤–å´ï¼‰
        endCorrectionCtx.fillStyle = '#4CAF50';
        endCorrectionCtx.beginPath();
        endCorrectionCtx.arc(actualEnd, pipeY - amplitude, 8, 0, Math.PI * 2);
        endCorrectionCtx.fill();
        
        // Î”x ã®è¡¨ç¤º
        endCorrectionCtx.strokeStyle = '#ff9800';
        endCorrectionCtx.lineWidth = 2;
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeRight, pipeY + pipeWidth + 45);
        endCorrectionCtx.lineTo(actualEnd, pipeY + pipeWidth + 45);
        endCorrectionCtx.stroke();
        
        // çŸ¢å°
        endCorrectionCtx.fillStyle = '#ff9800';
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(pipeRight, pipeY + pipeWidth + 45);
        endCorrectionCtx.lineTo(pipeRight + 8, pipeY + pipeWidth + 40);
        endCorrectionCtx.lineTo(pipeRight + 8, pipeY + pipeWidth + 50);
        endCorrectionCtx.closePath();
        endCorrectionCtx.fill();
        
        endCorrectionCtx.beginPath();
        endCorrectionCtx.moveTo(actualEnd, pipeY + pipeWidth + 45);
        endCorrectionCtx.lineTo(actualEnd - 8, pipeY + pipeWidth + 40);
        endCorrectionCtx.lineTo(actualEnd - 8, pipeY + pipeWidth + 50);
        endCorrectionCtx.closePath();
        endCorrectionCtx.fill();
        
        endCorrectionCtx.font = 'bold 14px sans-serif';
        endCorrectionCtx.textAlign = 'center';
        endCorrectionCtx.fillText('Î”x', (pipeRight + actualEnd) / 2, pipeY + pipeWidth + 65);
        
        // ãƒ©ãƒ™ãƒ«
        endCorrectionCtx.fillStyle = '#333';
        endCorrectionCtx.font = '12px sans-serif';
        endCorrectionCtx.textAlign = 'left';
        endCorrectionCtx.fillText('ç¯€ï¼ˆé–‰ã˜ãŸç«¯ï¼‰', pipeLeft - 30, pipeY - pipeWidth - 15);
        
        endCorrectionCtx.fillStyle = '#2196F3';
        endCorrectionCtx.textAlign = 'center';
        endCorrectionCtx.fillText('ç®¡ã®ç«¯', pipeRight, pipeY - pipeWidth - 25);
        
        endCorrectionCtx.fillStyle = '#4CAF50';
        endCorrectionCtx.fillText('å®Ÿéš›ã®è…¹', actualEnd, pipeY - amplitude - 20);
    }

    // ===== å¼¦ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–ç”¨ï¼‰ =====
    const stringCanvas = document.getElementById('stringCanvas');
    const stringCtx = stringCanvas.getContext('2d');
    
    let stringLength = 1.0;
    let driverFreq = 100;
    let waveSpeed = 200;
    let stringAnimating = false;
    let stringTime = 0;
    let stringAnimationId = null;
    
    const stringLengthSlider = document.getElementById('stringLengthSlider');
    const freqSlider = document.getElementById('freqSlider');
    const tensionSlider = document.getElementById('tensionSlider');
    const stringLengthDisplay = document.getElementById('stringLengthDisplay');
    const freqDisplay = document.getElementById('freqDisplay');
    const tensionDisplay = document.getElementById('tensionDisplay');
    const resonanceIndicator = document.getElementById('resonanceIndicator');
    
    function getStringNaturalFrequencies() {
        const f1 = waveSpeed / (2 * stringLength);
        return [f1, 2*f1, 3*f1, 4*f1, 5*f1];
    }
    
    function getResonanceMode() {
        const freqs = getStringNaturalFrequencies();
        const tolerance = 5;
        for (let n = 0; n < freqs.length; n++) {
            if (Math.abs(driverFreq - freqs[n]) < tolerance) return n + 1;
        }
        return 0;
    }
    
    function drawString() {
        const W = stringCanvas.width;
        const H = stringCanvas.height;
        
        stringCtx.fillStyle = '#f8f9fa';
        stringCtx.fillRect(0, 0, W, H);
        
        const margin = 80;
        const stringY = H * 0.5;
        const stringStartX = margin;
        const stringEndX = W - margin;
        const stringPixelLength = stringEndX - stringStartX;
        
        stringCtx.fillStyle = '#555';
        stringCtx.fillRect(stringStartX - 20, stringY - 60, 20, 120);
        stringCtx.fillRect(stringEndX, stringY - 60, 20, 120);
        
        const fretX = stringStartX;
        const fretSize = 15;
        stringCtx.fillStyle = '#8B4513';
        stringCtx.beginPath();
        stringCtx.moveTo(fretX, stringY - fretSize);
        stringCtx.lineTo(fretX + fretSize, stringY);
        stringCtx.lineTo(fretX, stringY + fretSize);
        stringCtx.closePath();
        stringCtx.fill();
        
        const speakerY = stringY + fretSize + 20;
        const speakerSize = 25;
        const speakerOffset = stringAnimating ? Math.sin(stringTime * driverFreq * 2 * Math.PI / 60) * 3 : 0;
        
        stringCtx.fillStyle = '#333';
        stringCtx.fillRect(fretX - speakerSize/2 + speakerOffset, speakerY, speakerSize, speakerSize);
        stringCtx.fillStyle = '#666';
        stringCtx.beginPath();
        stringCtx.arc(fretX + speakerOffset, speakerY + speakerSize/2, speakerSize/3, 0, Math.PI * 2);
        stringCtx.fill();
        
        if (stringAnimating) {
            stringCtx.strokeStyle = '#ff9800';
            stringCtx.lineWidth = 2;
            for (let i = 0; i < 3; i++) {
                const wavePhase = (stringTime * 0.1 + i * 0.3) % 1;
                const waveRadius = 10 + wavePhase * 20;
                stringCtx.globalAlpha = 1 - wavePhase;
                stringCtx.beginPath();
                stringCtx.arc(fretX, speakerY - 5, waveRadius, -Math.PI/2 - 0.5, -Math.PI/2 + 0.5);
                stringCtx.stroke();
            }
            stringCtx.globalAlpha = 1;
        }
        
        stringCtx.fillStyle = '#333';
        stringCtx.font = '12px sans-serif';
        stringCtx.textAlign = 'center';
        stringCtx.fillText('ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼', fretX, speakerY + speakerSize + 15);
        
        const resonanceMode = getResonanceMode();
        const amplitude = resonanceMode > 0 ? 40 : 5;
        
        stringCtx.strokeStyle = resonanceMode > 0 ? '#e53935' : '#333';
        stringCtx.lineWidth = resonanceMode > 0 ? 3 : 2;
        stringCtx.beginPath();
        
        for (let px = 0; px <= stringPixelLength; px++) {
            const x = stringStartX + px;
            const ratio = px / stringPixelLength;
            let y = stringY;
            if (stringAnimating && resonanceMode > 0) {
                const n = resonanceMode;
                const spatialPart = Math.sin(n * Math.PI * ratio);
                const temporalPart = Math.cos(stringTime * 0.1);
                y = stringY - amplitude * spatialPart * temporalPart;
            } else if (stringAnimating) {
                y = stringY - amplitude * Math.sin(ratio * 10 + stringTime * 0.2) * Math.cos(ratio * 5 - stringTime * 0.15);
            }
            if (px === 0) stringCtx.moveTo(x, y);
            else stringCtx.lineTo(x, y);
        }
        stringCtx.stroke();
        
        if (resonanceMode > 0 && stringAnimating) {
            const n = resonanceMode;
            stringCtx.fillStyle = '#2196F3';
            for (let i = 0; i <= n; i++) {
                const nodeX = stringStartX + (i / n) * stringPixelLength;
                stringCtx.beginPath();
                stringCtx.arc(nodeX, stringY, 6, 0, Math.PI * 2);
                stringCtx.fill();
            }
            stringCtx.fillStyle = '#4CAF50';
            for (let i = 0; i < n; i++) {
                const antiNodeX = stringStartX + ((i + 0.5) / n) * stringPixelLength;
                stringCtx.beginPath();
                stringCtx.arc(antiNodeX, stringY, 6, 0, Math.PI * 2);
                stringCtx.fill();
            }
        }
        
        stringCtx.strokeStyle = '#667eea';
        stringCtx.lineWidth = 1;
        stringCtx.setLineDash([5, 5]);
        stringCtx.beginPath();
        stringCtx.moveTo(stringStartX, stringY + 80);
        stringCtx.lineTo(stringEndX, stringY + 80);
        stringCtx.stroke();
        stringCtx.setLineDash([]);
        
        stringCtx.fillStyle = '#667eea';
        stringCtx.beginPath();
        stringCtx.moveTo(stringStartX, stringY + 80);
        stringCtx.lineTo(stringStartX + 10, stringY + 75);
        stringCtx.lineTo(stringStartX + 10, stringY + 85);
        stringCtx.closePath();
        stringCtx.fill();
        stringCtx.beginPath();
        stringCtx.moveTo(stringEndX, stringY + 80);
        stringCtx.lineTo(stringEndX - 10, stringY + 75);
        stringCtx.lineTo(stringEndX - 10, stringY + 85);
        stringCtx.closePath();
        stringCtx.fill();
        
        stringCtx.font = '14px sans-serif';
        stringCtx.textAlign = 'center';
        stringCtx.fillText('L = ' + stringLength.toFixed(1) + ' m', (stringStartX + stringEndX)/2, stringY + 100);
        
        stringCtx.font = '12px sans-serif';
        stringCtx.textAlign = 'left';
        stringCtx.fillStyle = '#2196F3';
        stringCtx.fillText('â— ç¯€', W - 100, 30);
        stringCtx.fillStyle = '#4CAF50';
        stringCtx.fillText('â— è…¹', W - 100, 50);
    }
    
    function animateString() {
        if (!stringAnimating) return;
        stringTime++;
        drawString();
        stringAnimationId = requestAnimationFrame(animateString);
    }
    
    function updateStringInfo() {
        const freqs = getStringNaturalFrequencies();
        const f1 = freqs[0];
        document.getElementById('stringInfo1').textContent = 'åŸºæœ¬æŒ¯å‹•æ•° fâ‚ = ' + f1.toFixed(1) + ' Hz';
        const mode = getResonanceMode();
        if (mode > 0) {
            document.getElementById('stringInfo2').textContent = 'ç¾åœ¨ã®æŒ¯å‹•: ' + mode + 'å€æŒ¯å‹•ã§å…±é³´ä¸­ï¼';
            resonanceIndicator.textContent = mode + 'å€æŒ¯å‹•ã§å…±é³´ï¼';
            resonanceIndicator.className = 'resonance-indicator resonating';
        } else {
            document.getElementById('stringInfo2').textContent = 'ç¾åœ¨ã®æŒ¯å‹•: å…±é³´ã—ã¦ã„ã¾ã›ã‚“';
            resonanceIndicator.textContent = 'éå…±é³´';
            resonanceIndicator.className = 'resonance-indicator not-resonating';
        }
        const freqList = freqs.slice(0, 5).map((f, i) => 'fâ‚Ã—' + (i+1) + '=' + Math.round(f) + 'Hz').join(', ');
        document.getElementById('stringInfo3').textContent = 'å›ºæœ‰æŒ¯å‹•æ•°: ' + freqList;
    }
    
    stringLengthSlider.addEventListener('input', function() {
        stringLength = parseFloat(this.value);
        stringLengthDisplay.textContent = stringLength.toFixed(1) + ' m';
        updateStringInfo();
        drawString();
    });
    freqSlider.addEventListener('input', function() {
        driverFreq = parseFloat(this.value);
        freqDisplay.textContent = driverFreq + ' Hz';
        updateStringInfo();
        drawString();
    });
    tensionSlider.addEventListener('input', function() {
        waveSpeed = parseFloat(this.value);
        tensionDisplay.textContent = waveSpeed + ' m/s';
        updateStringInfo();
        drawString();
    });
    document.getElementById('stringStartBtn').addEventListener('click', function() {
        if (stringAnimating) {
            stringAnimating = false;
            this.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
            cancelAnimationFrame(stringAnimationId);
        } else {
            stringAnimating = true;
            this.textContent = 'åœæ­¢';
            animateString();
        }
    });
    document.getElementById('stringResetBtn').addEventListener('click', function() {
        stringAnimating = false;
        stringTime = 0;
        document.getElementById('stringStartBtn').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
        cancelAnimationFrame(stringAnimationId);
        drawString();
    });

    // ===== æ°—æŸ±ã®æŒ¯å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ =====
    const pipeCanvas = document.getElementById('pipeCanvas');
    const pipeCtx = pipeCanvas.getContext('2d');
    
    let pipeLength = 0.5;
    let harmonic = 1;
    let pipeMode = 'closed';
    let soundSpeed = 340;
    let pipeAnimating = false;
    let pipeTime = 0;
    let pipeAnimationId = null;
    let showLongitudinal = false;
    
    const pipeLengthSlider = document.getElementById('pipeLengthSlider');
    const harmonicSlider = document.getElementById('harmonicSlider');
    const pipeLengthDisplay = document.getElementById('pipeLengthDisplay');
    const harmonicDisplay = document.getElementById('harmonicDisplay');
    
    function setPipeMode(mode) {
        pipeMode = mode;
        document.getElementById('closedPipeBtn').classList.toggle('active', mode === 'closed');
        document.getElementById('openPipeBtn').classList.toggle('active', mode === 'open');
        updateHarmonicSlider();
        updatePipeInfo();
        drawPipe();
    }
    
    function updateHarmonicSlider() {
        if (pipeMode === 'closed') {
            const currentValue = parseInt(harmonicSlider.value);
            if (currentValue % 2 === 0) {
                harmonic = currentValue - 1;
                harmonicSlider.value = harmonic;
            }
        }
        harmonicDisplay.textContent = harmonic + ' å€æŒ¯å‹•';
    }
    
    function getPipeWavelength() {
        if (pipeMode === 'closed') return 4 * pipeLength / harmonic;
        else return 2 * pipeLength / harmonic;
    }
    
    function getPipeFrequency() {
        return soundSpeed / getPipeWavelength();
    }
    
    function drawPipe() {
        const W = pipeCanvas.width;
        const H = pipeCanvas.height;
        
        pipeCtx.fillStyle = '#f8f9fa';
        pipeCtx.fillRect(0, 0, W, H);
        
        const pipeTop = 60;
        const pipeBottom = H - 60;
        const pipeHeight = pipeBottom - pipeTop;
        const pipeWidth = 80;
        const pipeCenterX = W / 2;
        const pipeLeft = pipeCenterX - pipeWidth / 2;
        const pipeRight = pipeCenterX + pipeWidth / 2;
        
        pipeCtx.strokeStyle = '#555';
        pipeCtx.lineWidth = 4;
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeLeft, pipeTop);
        pipeCtx.lineTo(pipeLeft, pipeBottom);
        pipeCtx.stroke();
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeRight, pipeTop);
        pipeCtx.lineTo(pipeRight, pipeBottom);
        pipeCtx.stroke();
        
        if (pipeMode === 'closed') {
            pipeCtx.beginPath();
            pipeCtx.moveTo(pipeLeft, pipeBottom);
            pipeCtx.lineTo(pipeRight, pipeBottom);
            pipeCtx.stroke();
            pipeCtx.strokeStyle = '#888';
            pipeCtx.lineWidth = 2;
            for (let i = 0; i < pipeWidth; i += 10) {
                pipeCtx.beginPath();
                pipeCtx.moveTo(pipeLeft + i, pipeBottom);
                pipeCtx.lineTo(pipeLeft + i + 10, pipeBottom + 10);
                pipeCtx.stroke();
            }
        }
        
        const speakerY = pipeTop - 30;
        const speakerSize = 40;
        const speakerOffset = pipeAnimating ? Math.sin(pipeTime * 0.15) * 3 : 0;
        pipeCtx.fillStyle = '#333';
        pipeCtx.fillRect(pipeCenterX - speakerSize/2, speakerY - speakerSize/2 + speakerOffset, speakerSize, speakerSize/2);
        pipeCtx.fillStyle = '#666';
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeCenterX - speakerSize/3, speakerY + speakerOffset);
        pipeCtx.lineTo(pipeCenterX, speakerY + 15 + speakerOffset);
        pipeCtx.lineTo(pipeCenterX + speakerSize/3, speakerY + speakerOffset);
        pipeCtx.closePath();
        pipeCtx.fill();
        
        if (pipeAnimating) {
            pipeCtx.strokeStyle = '#ff9800';
            pipeCtx.lineWidth = 2;
            for (let i = 0; i < 3; i++) {
                const wavePhase = (pipeTime * 0.05 + i * 0.3) % 1;
                const waveRadius = 5 + wavePhase * 15;
                pipeCtx.globalAlpha = 1 - wavePhase;
                pipeCtx.beginPath();
                pipeCtx.arc(pipeCenterX, speakerY + 20, waveRadius, Math.PI/4, Math.PI*3/4);
                pipeCtx.stroke();
            }
            pipeCtx.globalAlpha = 1;
        }
        
        const waveAmplitude = 30;
        const n = harmonic;
        
        pipeCtx.strokeStyle = '#e53935';
        pipeCtx.lineWidth = 3;
        pipeCtx.beginPath();
        
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            let displacement = 0;
            if (pipeAnimating) {
                if (pipeMode === 'closed') {
                    displacement = Math.cos(n * Math.PI * ratio / 2) * Math.cos(pipeTime * 0.1);
                } else {
                    displacement = Math.cos(n * Math.PI * ratio) * Math.cos(pipeTime * 0.1);
                }
            }
            const x = pipeCenterX + displacement * waveAmplitude;
            if (py === 0) pipeCtx.moveTo(x, y);
            else pipeCtx.lineTo(x, y);
        }
        pipeCtx.stroke();
        
        // åŒ…çµ¡ç·š
        pipeCtx.strokeStyle = '#e53935';
        pipeCtx.lineWidth = 1;
        pipeCtx.setLineDash([5, 5]);
        pipeCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            let envelope = pipeMode === 'closed' ? Math.abs(Math.cos(n * Math.PI * ratio / 2)) : Math.abs(Math.cos(n * Math.PI * ratio));
            if (py === 0) pipeCtx.moveTo(pipeCenterX + envelope * waveAmplitude, y);
            else pipeCtx.lineTo(pipeCenterX + envelope * waveAmplitude, y);
        }
        pipeCtx.stroke();
        pipeCtx.beginPath();
        for (let py = 0; py <= pipeHeight; py++) {
            const y = pipeTop + py;
            const ratio = py / pipeHeight;
            let envelope = pipeMode === 'closed' ? Math.abs(Math.cos(n * Math.PI * ratio / 2)) : Math.abs(Math.cos(n * Math.PI * ratio));
            if (py === 0) pipeCtx.moveTo(pipeCenterX - envelope * waveAmplitude, y);
            else pipeCtx.lineTo(pipeCenterX - envelope * waveAmplitude, y);
        }
        pipeCtx.stroke();
        pipeCtx.setLineDash([]);
        
        // ãƒãƒ¼ã‚«ãƒ¼
        if (pipeMode === 'closed') {
            pipeCtx.fillStyle = '#4CAF50';
            for (let k = 0; k <= n; k++) {
                const ratio = (2 * k) / n;
                if (ratio <= 1) {
                    const markerY = pipeTop + ratio * pipeHeight;
                    pipeCtx.beginPath();
                    pipeCtx.arc(pipeRight + 20, markerY, 6, 0, Math.PI * 2);
                    pipeCtx.fill();
                }
            }
            pipeCtx.fillStyle = '#2196F3';
            for (let k = 0; k <= n; k++) {
                const ratio = (2 * k + 1) / n;
                if (ratio <= 1) {
                    const markerY = pipeTop + ratio * pipeHeight;
                    pipeCtx.beginPath();
                    pipeCtx.arc(pipeRight + 20, markerY, 6, 0, Math.PI * 2);
                    pipeCtx.fill();
                }
            }
        } else {
            pipeCtx.fillStyle = '#4CAF50';
            for (let k = 0; k <= n; k++) {
                const ratio = k / n;
                const markerY = pipeTop + ratio * pipeHeight;
                pipeCtx.beginPath();
                pipeCtx.arc(pipeRight + 20, markerY, 6, 0, Math.PI * 2);
                pipeCtx.fill();
            }
            pipeCtx.fillStyle = '#2196F3';
            for (let k = 0; k < n; k++) {
                const ratio = (2 * k + 1) / (2 * n);
                const markerY = pipeTop + ratio * pipeHeight;
                pipeCtx.beginPath();
                pipeCtx.arc(pipeRight + 20, markerY, 6, 0, Math.PI * 2);
                pipeCtx.fill();
            }
        }
        
        pipeCtx.strokeStyle = '#667eea';
        pipeCtx.lineWidth = 1;
        pipeCtx.setLineDash([5, 5]);
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeLeft - 30, pipeTop);
        pipeCtx.lineTo(pipeLeft - 30, pipeBottom);
        pipeCtx.stroke();
        pipeCtx.setLineDash([]);
        
        pipeCtx.fillStyle = '#667eea';
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeLeft - 30, pipeTop);
        pipeCtx.lineTo(pipeLeft - 35, pipeTop + 10);
        pipeCtx.lineTo(pipeLeft - 25, pipeTop + 10);
        pipeCtx.closePath();
        pipeCtx.fill();
        pipeCtx.beginPath();
        pipeCtx.moveTo(pipeLeft - 30, pipeBottom);
        pipeCtx.lineTo(pipeLeft - 35, pipeBottom - 10);
        pipeCtx.lineTo(pipeLeft - 25, pipeBottom - 10);
        pipeCtx.closePath();
        pipeCtx.fill();
        
        pipeCtx.font = '14px sans-serif';
        pipeCtx.textAlign = 'center';
        pipeCtx.save();
        pipeCtx.translate(pipeLeft - 50, (pipeTop + pipeBottom) / 2);
        pipeCtx.rotate(-Math.PI / 2);
        pipeCtx.fillText('L = ' + pipeLength.toFixed(2) + ' m', 0, 0);
        pipeCtx.restore();
        
        pipeCtx.font = '14px sans-serif';
        pipeCtx.textAlign = 'left';
        pipeCtx.fillStyle = '#333';
        pipeCtx.fillText(pipeMode === 'closed' ? 'é–‰ç®¡' : 'é–‹ç®¡', 20, 30);
        pipeCtx.fillText(harmonic + 'å€æŒ¯å‹•', 20, 50);
        
        pipeCtx.fillStyle = '#4CAF50';
        pipeCtx.fillText('â— è…¹', W - 100, 30);
        pipeCtx.fillStyle = '#2196F3';
        pipeCtx.fillText('â— ç¯€', W - 100, 50);
        
        if (showLongitudinal && pipeAnimating) {
            drawLongitudinalWave();
        }
    }
    
    function drawLongitudinalWave() {
        const W = pipeCanvas.width;
        const H = pipeCanvas.height;
        const pipeTop = 60;
        const pipeBottom = H - 60;
        const pipeHeight = pipeBottom - pipeTop;
        const longitudinalX = W - 150;
        
        pipeCtx.fillStyle = '#333';
        pipeCtx.font = '12px sans-serif';
        pipeCtx.textAlign = 'center';
        pipeCtx.fillText('ç¸¦æ³¢è¡¨ç¤º', longitudinalX, pipeTop - 10);
        
        const particleCount = 30;
        const particleSpacing = pipeHeight / particleCount;
        
        for (let i = 0; i < particleCount; i++) {
            const baseY = pipeTop + i * particleSpacing;
            const ratio = i / particleCount;
            let displacement = 0;
            if (pipeMode === 'closed') {
                displacement = Math.sin(harmonic * Math.PI * ratio / 2) * Math.sin(pipeTime * 0.1);
            } else {
                displacement = Math.sin(harmonic * Math.PI * ratio) * Math.sin(pipeTime * 0.1);
            }
            const y = baseY + displacement * 15;
            const density = 1 - displacement * 0.3;
            const colorValue = Math.floor(100 + density * 100);
            pipeCtx.fillStyle = `rgb(${colorValue}, ${colorValue}, ${colorValue})`;
            pipeCtx.beginPath();
            pipeCtx.arc(longitudinalX, y, 4, 0, Math.PI * 2);
            pipeCtx.fill();
        }
    }
    
    function animatePipe() {
        if (!pipeAnimating) return;
        pipeTime++;
        drawPipe();
        pipeAnimationId = requestAnimationFrame(animatePipe);
    }
    
    function updatePipeInfo() {
        const wavelength = getPipeWavelength();
        const frequency = getPipeFrequency();
        document.getElementById('pipeInfo1').textContent = 'ç®¡ã®ç¨®é¡: ' + (pipeMode === 'closed' ? 'é–‰ç®¡ï¼ˆä¸€ç«¯é–‰ï¼‰' : 'é–‹ç®¡ï¼ˆä¸¡ç«¯é–‹ï¼‰');
        document.getElementById('pipeInfo2').textContent = 'æ³¢é•· Î» = ' + wavelength.toFixed(3) + ' m';
        document.getElementById('pipeInfo3').textContent = 'æŒ¯å‹•æ•° f = ' + frequency.toFixed(1) + ' Hz';
    }
    
    pipeLengthSlider.addEventListener('input', function() {
        pipeLength = parseFloat(this.value);
        pipeLengthDisplay.textContent = pipeLength.toFixed(2) + ' m';
        updatePipeInfo();
        drawPipe();
    });
    harmonicSlider.addEventListener('input', function() {
        let value = parseInt(this.value);
        if (pipeMode === 'closed') {
            if (value % 2 === 0) value = value - 1;
            this.value = value;
        }
        harmonic = value;
        harmonicDisplay.textContent = harmonic + ' å€æŒ¯å‹•';
        updatePipeInfo();
        drawPipe();
    });
    document.getElementById('showLongitudinalCheck').addEventListener('change', function() {
        showLongitudinal = this.checked;
        drawPipe();
    });
    document.getElementById('pipeStartBtn').addEventListener('click', function() {
        if (pipeAnimating) {
            pipeAnimating = false;
            this.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
            cancelAnimationFrame(pipeAnimationId);
        } else {
            pipeAnimating = true;
            this.textContent = 'åœæ­¢';
            animatePipe();
        }
    });
    document.getElementById('pipeResetBtn').addEventListener('click', function() {
        pipeAnimating = false;
        pipeTime = 0;
        document.getElementById('pipeStartBtn').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
        cancelAnimationFrame(pipeAnimationId);
        drawPipe();
    });

    // ===== å…±é€šå‡¦ç† =====
    function resizeCanvases() {
        stringCanvas.width = stringCanvas.parentElement.clientWidth - 40;
        stringCanvas.height = 300;
        pipeCanvas.width = pipeCanvas.parentElement.clientWidth - 40;
        pipeCanvas.height = 450;
    }
    
    // åˆæœŸåŒ–
    window.addEventListener('load', function() {
        resizeCanvases();
        drawBuilding();
        drawWaveform();
        drawStringWave();
        drawClosedPipeWave();
        drawOpenPipeWave();
        drawEndCorrection();
        updateStringInfo();
        updatePipeInfo();
        drawString();
        drawPipe();
    });
    
    window.addEventListener('resize', function() {
        resizeCanvases();
        drawString();
        drawPipe();
    });
    </script>
</body>
</html>