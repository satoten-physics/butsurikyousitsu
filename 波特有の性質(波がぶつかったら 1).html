<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ ¡ç‰©ç† - æ³¢ç‰¹æœ‰ã®æ€§è³ª(æ³¢ãŒã¶ã¤ã‹ã£ãŸã‚‰)</title>
    <script>
      window.MathJax = {
      tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
     }
     };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        h1 {
            color: #333;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        .tab-btn:hover {
            background: #8899f0;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        h3 {
            color: #764ba2;
            margin: 25px 0 15px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #eee;
        }
        h4 {
            color: #555;
            margin: 20px 0 10px 0;
        }
        .pdf-placeholder {
            background: #f9f9f9;
            padding: 40px;
            text-align: center;
            border-radius: 5px;
            color: #666;
        }
        
        /* è§£èª¬ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .lecture-content {
            line-height: 1.8;
            color: #333;
        }
        .lecture-content p {
            margin-bottom: 15px;
            text-align: justify;
        }
        .point-box {
            background: linear-gradient(135deg, #e8f4fc 0%, #f0e8fc 100%);
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }
        .point-box h4 {
            color: #667eea;
            margin-top: 0;
        }
        .formula-box {
            background: #fff9e6;
            border: 2px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: center;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 15px;
            text-align: center;
        }
        .comparison-table th {
            background: #667eea;
            color: white;
        }
        .comparison-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        .image-placeholder {
            background: #f0f0f0;
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            margin: 15px 0;
            color: #666;
            font-style: italic;
        }
        .note-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .note-box::before {
            content: "ğŸ’¡ ";
        }

        /* å•é¡Œç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .problem-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        .problem-section h4 {
            color: #667eea;
            margin-bottom: 15px;
        }
        details {
            margin-top: 15px;
            padding: 15px;
            background: #e8f4fc;
            border-radius: 5px;
        }
        summary {
            cursor: pointer;
            font-weight: bold;
            color: #667eea;
        }
        details[open] summary {
            margin-bottom: 15px;
        }
        
        /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .sim-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .sim-tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 15px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .sim-tab-btn.active {
            background: #667eea;
            color: white;
        }
        .sim-tab-btn:hover {
            background: #8899f0;
            color: white;
        }
        .sim-panel {
            display: none;
        }
        .sim-panel.active {
            display: block;
        }
        #sim-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .canvas-wrapper {
            background: white;
            border-radius: 5px;
            border: 2px solid #ddd;
            overflow: hidden;
        }
        canvas {
            display: block;
            width: 100%;
        }
        .sim-controls {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .sim-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .sim-button.start {
            background: #4CAF50;
            color: white;
        }
        .sim-button.start:hover {
            background: #45a049;
        }
        .sim-button.reset {
            background: #f44336;
            color: white;
        }
        .sim-button.reset:hover {
            background: #da190b;
        }
        .toggle-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .toggle-btn {
            flex: 1;
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .toggle-btn.active {
            background: #667eea;
            color: white;
        }
        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 15px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 30px;
            height: 4px;
            border-radius: 2px;
        }
        .info-display {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        .info-display p {
            margin: 5px 0;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            header, .container {
                padding: 15px;
            }
            .tab-btn {
                min-width: 100px;
                font-size: 14px;
            }
            .sim-tab-btn {
                min-width: 80px;
                font-size: 12px;
                padding: 8px 10px;
            }
            .comparison-table th, .comparison-table td {
                padding: 10px 5px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="back-link">â† ç›®æ¬¡ã«æˆ»ã‚‹</a>
        <h1>æ³¢ç‰¹æœ‰ã®æ€§è³ªï¼ˆæ³¢ãŒã¶ã¤ã‹ã£ãŸã‚‰ï¼‰</h1>
    </header>
    <div class="container">
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('lecture')">è§£èª¬ç·¨</button>
            <button class="tab-btn" onclick="openTab('problem')">å•é¡Œç·¨</button>
            <button class="tab-btn" onclick="openTab('simulation')">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>
        
        <!-- ==================== è§£èª¬ã‚¿ãƒ– ==================== -->
        <div id="lecture" class="tab-content active">
            <h2>æˆæ¥­è³‡æ–™</h2>
            <iframe src="https://drive.google.com/file/d/1rd3AUHNkj-NLM0IEztEdsiVOdPwxD6EA/preview" width="100%" height="500"></iframe>
            
            <div class="lecture-content">
                <h3>1. æ³¢ãŒã¶ã¤ã‹ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ ï½é‡ã­åˆã‚ã›ã®åŸç†ï½</h3>
                
                <p>æ³¢ã¯æŒ¯å‹•ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒä¼ã‚ã£ã¦ã„ãç¾è±¡ã§ã™ã€‚ã§ã¯ã€2ã¤ã®æ³¢ãŒå‡ºä¼šã£ãŸã¨ãã€ãã‚Œãã‚Œã®æ³¢ã¯ã©ã†ãªã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p>
                
                <p>ãƒœãƒ¼ãƒ«ãŒ2ã¤ã¶ã¤ã‹ã‚Œã°è·³ã­è¿”ã‚Šã¾ã™ãŒã€æ³¢ã®å ´åˆã¯é•ã„ã¾ã™ã€‚2ã¤ã®æ³¢ãŒã¶ã¤ã‹ã‚‹ã¨ã€ãã®å ´æ‰€ã§ã®å¤‰ä½ã¯<strong>è¶³ã—åˆã‚ã•ã‚Œã¾ã™</strong>ã€‚ã“ã‚Œã‚’<strong>é‡ã­åˆã‚ã›ã®åŸç†</strong>ã¨ã„ã„ã¾ã™ã€‚</p>
                
                <div class="formula-box">
                    <h4>é‡ã­åˆã‚ã›ã®åŸç†</h4>
                    <p>ã‚ã‚‹åœ°ç‚¹ã§æ³¢Aã®å¤‰ä½ãŒ $y_A$ã€æ³¢Bã®å¤‰ä½ãŒ $y_B$ ã®ã¨ãã€åˆæˆæ³¢ã®å¤‰ä½ $y$ ã¯</p>
                    $$ y = y_A + y_B $$
                </div>
                
                <div class="point-box">
                    <h4>ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆï¼šå¤‰ä½ã®ã€Œå‘ãã€ã«æ³¨æ„ï¼</h4>
                    <p>å¤‰ä½ã«ã¯æ­£ï¼ˆä¸Šå‘ãï¼‰ã¨è² ï¼ˆä¸‹å‘ãï¼‰ãŒã‚ã‚Šã¾ã™ã€‚</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>ä¸¡æ–¹ãŒæ­£ï¼ˆå±±ã¨å±±ï¼‰â†’ å¤‰ä½ã¯å¤§ãããªã‚‹ï¼ˆ<strong>å¼·ã‚åˆã†</strong>ï¼‰</li>
                        <li>ä¸€æ–¹ãŒæ­£(å±±)ã€ä¸€æ–¹ãŒè² (è°·)â†’ å¤‰ä½ã¯ã‚¼ãƒ­ã«ãªã‚‹ï¼ˆ<strong>å®Œå…¨ã«å¼±ã‚åˆã†</strong>ï¼‰</li>
                    </ul>
                </div>
                
                <h4>æ³¢ã®ç‹¬ç«‹æ€§</h4>
                <p>é‡ã­åˆã‚ã›ã®å¾Œã€2ã¤ã®æ³¢ã¯ã©ã†ãªã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿå®Ÿã¯ã€<strong>ä½•äº‹ã‚‚ãªã‹ã£ãŸã‹ã®ã‚ˆã†ã«ã€ãã®ã¾ã¾é€šã‚Šéãã¦ã„ãã¾ã™</strong>ã€‚ã“ã‚Œã‚’<strong>æ³¢ã®ç‹¬ç«‹æ€§</strong>ã¨ã„ã„ã¾ã™ã€‚</p>
                <p>ãƒœãƒ¼ãƒ«ã¨ã¯é•ã„ã€æ³¢åŒå£«ã¯äº’ã„ã«å½±éŸ¿ã‚’ä¸ãˆãšã«ã™ã‚ŠæŠœã‘ã¦ã„ãã®ã§ã™ã€‚ã“ã‚Œã¯æ³¢ç‰¹æœ‰ã®æ€§è³ªã§ã‚ã‚Šã€å…‰ã‚„éŸ³ãŒäº¤å·®ã—ã¦ã‚‚æ··ã–ã‚‰ãªã„ç†ç”±ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚</p>
                
                <h3>2. æ³¢ã®åå°„ ï½å›ºå®šç«¯ã¨è‡ªç”±ç«¯ï½</h3>
                
                <p>æ³¢ã¯å£ã‚„éšœå®³ç‰©ã«å½“ãŸã‚‹ã¨ä¸€éƒ¨ã®æŒ¯å‹•ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’è·³ã­è¿”ã—ã¾ã™ã€‚ã“ã‚Œã‚’<strong>åå°„</strong>ã¨ã„ã„ã¾ã™ã€‚</p>
                <p style="font-size: 14px; color: #666; margin-top: -10px;">â€»ä¸€éƒ¨ã‚’åå°„ã—ã¦ãã‚Œä»¥å¤–ã¯ãã®ã¾ã¾é€²ã‚“ã§è¡Œã£ãŸã‚Šã€éŸ³ã‚„ç†±ã«å¤‰ã‚ã£ãŸã‚Šã—ã¾ã™ã€‚</p>
                
                <div class="formula-box">
                    <h4>åå°„ã®æ³•å‰‡</h4>
                    <p>å…¥å°„è§’ã‚’ $\theta$ã€åå°„è§’ã‚’ $\theta'$ ã¨ã™ã‚‹ã¨</p>
                    $$ \theta = \theta' $$
                    <p style="font-size: 14px; color: #666; margin-top: 10px;">â€»å…¥å°„è§’ãƒ»åå°„è§’ã¯ã€åå°„é¢ã«å‚ç›´ãªç·šï¼ˆæ³•ç·šï¼‰ã¨ã®è§’åº¦</p>
                </div>
                
                <p>ã“ã“ã§é‡è¦ãªã®ã¯ã€<strong>åå°„ã™ã‚‹å ´æ‰€ï¼ˆç«¯ï¼‰ã®çŠ¶æ…‹</strong>ã«ã‚ˆã£ã¦ã€åå°„æ³¢ã®æ§˜å­ãŒå¤§ããå¤‰ã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚</p>
                
                <h4>ğŸ”’ å›ºå®šç«¯åå°„</h4>
                <p>åª’è³ªã®ç«¯ãŒå›ºå®šã•ã‚Œã¦å‹•ã‘ãªã„å ´åˆã®åå°„ã§ã™ã€‚ä¾‹ãˆã°ã€ãƒ­ãƒ¼ãƒ—ã®ç«¯ã‚’å£ã«å›ºå®šã—ãŸå ´åˆãŒã“ã‚Œã«ã‚ãŸã‚Šã¾ã™ã€‚</p>
                
                <div class="point-box">
                    <h4>å›ºå®šç«¯åå°„ã®ç‰¹å¾´</h4>
                    <ul style="margin-left: 20px;">
                        <li>ç«¯ã¯å‹•ã‘ãªã„ã®ã§ã€å¸¸ã«å¤‰ä½ãŒã‚¼ãƒ­</li>
                        <li>å…¥å°„æ³¢ã®å±±ã¯ã€åå°„ã™ã‚‹ã¨<strong>è°·</strong>ã«ãªã£ã¦è¿”ã£ã¦ãã‚‹</li>
                        <li>ä½ç›¸ãŒ<strong> $\pi$ï¼ˆ180Â°ï¼‰ãšã‚Œã‚‹</strong></li>
                        <li>ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼šã€Œå±±ã§å…¥å°„ã—ãŸã‚‰ã€è°·ã§è¿”ã‚‹ã€</li>
                    </ul>
                </div>
                
                <h4>ğŸ”“ è‡ªç”±ç«¯åå°„</h4>
                <p>åª’è³ªã®ç«¯ãŒè‡ªç”±ã«å‹•ã‘ã‚‹å ´åˆã®åå°„ã§ã™ã€‚ä¾‹ãˆã°ã€ãƒ­ãƒ¼ãƒ—ã®ç«¯ã«ãƒªãƒ³ã‚°ã‚’ã¤ã‘ã¦æ£’ã«é€šã—ã€è‡ªç”±ã«ä¸Šä¸‹ã§ãã‚‹ã‚ˆã†ã«ã—ãŸå ´åˆã§ã™ã€‚</p>
                
                <div class="point-box">
                    <h4>è‡ªç”±ç«¯åå°„ã®ç‰¹å¾´</h4>
                    <ul style="margin-left: 20px;">
                        <li>ç«¯ã¯è‡ªç”±ã«å‹•ã‘ã‚‹ã®ã§ã€å¤‰ä½ãŒæœ€å¤§ã«ãªã‚Šã‚„ã™ã„</li>
                        <li>å…¥å°„æ³¢ã®å±±ã¯ã€åå°„ã—ã¦ã‚‚<strong>å±±</strong>ã®ã¾ã¾è¿”ã£ã¦ãã‚‹</li>
                        <li>ä½ç›¸ã¯<strong>ãšã‚Œãªã„ï¼ˆãã®ã¾ã¾ï¼‰</strong></li>
                        <li>ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼šã€Œãã®ã¾ã¾è·³ã­è¿”ã‚‹ã€</li>
                    </ul>
                </div>
                
                <table class="comparison-table">
                    <tr>
                        <th></th>
                        <th>å›ºå®šç«¯åå°„</th>
                        <th>è‡ªç”±ç«¯åå°„</th>
                    </tr>
                    <tr>
                        <td><strong>ç«¯ã®çŠ¶æ…‹</strong></td>
                        <td>å‹•ã‘ãªã„ï¼ˆå›ºå®šï¼‰</td>
                        <td>è‡ªç”±ã«å‹•ã‘ã‚‹</td>
                    </tr>
                    <tr>
                        <td><strong>ç«¯ã®å¤‰ä½</strong></td>
                        <td>å¸¸ã«ã‚¼ãƒ­</td>
                        <td>æœ€å¤§ï¼ˆå…¥å°„æ³¢ã®2å€ï¼‰</td>
                    </tr>
                    <tr>
                        <td><strong>ä½ç›¸ã®ãšã‚Œ</strong></td>
                        <td>$\pi$ï¼ˆé€†ä½ç›¸ï¼‰</td>
                        <td>ãªã—ï¼ˆåŒä½ç›¸ï¼‰</td>
                    </tr>
                    <tr>
                        <td><strong>å±±ã®åå°„</strong></td>
                        <td>è°·ã«ãªã‚‹</td>
                        <td>å±±ã®ã¾ã¾</td>
                    </tr>
                    <tr>
                        <td><strong>ä¾‹</strong></td>
                        <td>å£ã«å›ºå®šã—ãŸãƒ­ãƒ¼ãƒ—</td>
                        <td>ãƒªãƒ³ã‚°ã§åŠã‚‹ã—ãŸãƒ­ãƒ¼ãƒ—</td>
                    </tr>
                </table>
                
                <h3>3. å®šå¸¸æ³¢ï¼ˆå®šåœ¨æ³¢ï¼‰</h3>
                
                <p>æ³¢ãŒåå°„ã™ã‚‹ã¨ã€å…¥å°„æ³¢ã¨åå°„æ³¢ãŒåŒã˜åª’è³ªä¸­ã‚’é€†å‘ãã«é€²ã‚€ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã“ã®ã¨ãã€ç‰¹åˆ¥ãªæ¡ä»¶ãŒæƒã†ã¨ã€ã¨ã¦ã‚‚ä¸æ€è­°ãªç¾è±¡ãŒèµ·ã“ã‚Šã¾ã™ã€‚</p>
                
                <div class="formula-box">
                    <h4>å®šå¸¸æ³¢ã¨ã¯</h4>
                    <p><strong>åŒã˜æ³¢é•·ãƒ»åŒã˜æŒ¯å¹…</strong>ã§<strong>é€†å‘ãã«é€²ã‚€</strong>2ã¤ã®æ³¢ãŒé‡ãªã£ãŸã¨ãã€<br>
                    <strong>é€²ã¾ãªã„ã§ã€ãã®å ´ã§æŒ¯å‹•ã—ç¶šã‘ã‚‹æ³¢</strong>ãŒç¾ã‚Œã¾ã™ã€‚<br>
                    ã“ã‚Œã‚’<strong>å®šå¸¸æ³¢ï¼ˆå®šåœ¨æ³¢ï¼‰</strong>ã¨ã„ã„ã¾ã™ã€‚</p>
                </div>
                
                <h4>å®šå¸¸æ³¢ã®æ€§è³ª</h4>
                
                <div class="point-box">
                    <h4>æ€§è³ª1ï¼šè…¹ã¨ç¯€</h4>
                    <p>å®šå¸¸æ³¢ã§ã¯ã€å ´æ‰€ã«ã‚ˆã£ã¦æŒ¯å‹•ã®å¤§ãã•ãŒç•°ãªã‚Šã¾ã™ã€‚</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>è…¹ï¼ˆã¯ã‚‰ï¼‰</strong>ï¼šæœ€ã‚‚å¤§ããæŒ¯å‹•ã™ã‚‹ç‚¹ã€‚æŒ¯å¹…ã¯å…ƒã®æ³¢ã®<strong>2å€</strong>ã«ãªã‚‹</li>
                        <li><strong>ç¯€ï¼ˆãµã—ï¼‰</strong>ï¼šå…¨ãæŒ¯å‹•ã—ãªã„ç‚¹ã€‚å¸¸ã«å¤‰ä½ãŒã‚¼ãƒ­</li>
                    </ul>
                    <p style="margin-top: 10px;">è…¹ã¨è…¹ã®é–“éš”ã€ç¯€ã¨ç¯€ã®é–“éš”ã¯ã¨ã‚‚ã« $\dfrac{\lambda}{2}$ï¼ˆåŠæ³¢é•·ï¼‰ã§ã™ã€‚</p>
                </div>
                
                <div class="point-box">
                    <h4>æ€§è³ª2ï¼šæ³¢ã¯ã€Œé€²ã¾ãªã„ã€ã‚ˆã†ã«è¦‹ãˆã‚‹</h4>
                    <p>æ™®é€šã®æ³¢ï¼ˆé€²è¡Œæ³¢ï¼‰ã¯å±±ã‚„è°·ãŒç§»å‹•ã—ã¦ã„ãã¾ã™ãŒã€å®šå¸¸æ³¢ã§ã¯å±±ã¨è°·ã®ä½ç½®ãŒå¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚åŒã˜å ´æ‰€ã§æŒ¯å‹•ã‚’ç¹°ã‚Šè¿”ã™ã ã‘ã§ã™ã€‚ã ã‹ã‚‰ã€Œå®šã¾ã£ã¦å¸¸ã«ã‚ã‚‹æ³¢ã€ï¼ã€Œå®šå¸¸æ³¢ã€ã¨ã„ã†ã®ã§ã™ã€‚</p>
                </div>
                
                <div class="point-box">
                    <h4>æ€§è³ª3ï¼šæŒ¯å¹…ãŒ2å€ã«ãªã‚‹ç†ç”±</h4>
                    <p>è…¹ã®ä½ç½®ã§ã¯ã€2ã¤ã®æ³¢ãŒå¸¸ã«å¼·ã‚åˆã„ã¾ã™ã€‚æŒ¯å¹… $A$ ã®æ³¢ãŒ2ã¤é‡ãªã‚‹ã®ã§ã€æœ€å¤§å¤‰ä½ã¯ $2A$ ã«ãªã‚Šã¾ã™ã€‚</p>
                </div>
                
                <h4>å®šå¸¸æ³¢ãŒã§ãã‚‹æ¡ä»¶</h4>
                <p>è‡ªç„¶ç•Œã§å®šå¸¸æ³¢ãŒã§ãã‚‹ã®ã¯ç°¡å˜ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»¥ä¸‹ã®3ã¤ã®æ¡ä»¶ãŒå¿…è¦ã§ã™ã€‚</p>
                <ol style="margin-left: 25px; line-height: 2;">
                    <li>2ã¤ã®æ³¢ãŒ<strong>é€†å‘ã</strong>ã«é€²ã‚€ã“ã¨</li>
                    <li>2ã¤ã®æ³¢ã®<strong>æŒ¯å¹…ãŒåŒã˜</strong>ã§ã‚ã‚‹ã“ã¨</li>
                    <li>2ã¤ã®æ³¢ã®<strong>æ³¢é•·ï¼ˆæŒ¯å‹•æ•°ï¼‰ãŒåŒã˜</strong>ã§ã‚ã‚‹ã“ã¨</li>
                </ol>
                
                <div class="note-box">
                    <strong>å…¥å°„æ³¢ã¨åå°„æ³¢ã®é–¢ä¿‚</strong><br>
                    å®Ÿã¯ã€ã“ã®3æ¡ä»¶ãŒè‡ªç„¶ã«æƒã†ã®ãŒã€Œå…¥å°„æ³¢ã¨åå°„æ³¢ã€ã®é–¢ä¿‚ã§ã™ã€‚åå°„æ³¢ã¯å…¥å°„æ³¢ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ã®ã§ã€æŒ¯å¹…ãƒ»æ³¢é•·ãƒ»é€Ÿã•ãŒã™ã¹ã¦åŒã˜ã§ã€é€²è¡Œæ–¹å‘ã ã‘ãŒé€†ã«ãªã‚Šã¾ã™ã€‚å¼¦æ¥½å™¨ã‚„ç®¡æ¥½å™¨ã§ã¯å®šå¸¸æ³¢ãŒé‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚
                </div>
                
                <h4>å›ºå®šç«¯ãƒ»è‡ªç”±ç«¯ã¨å®šå¸¸æ³¢</h4>
                <p>å›ºå®šç«¯ã§ã¯ç«¯ãŒç¯€ã«ã€è‡ªç”±ç«¯ã§ã¯ç«¯ãŒè…¹ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯åå°„ã®æ€§è³ªã‹ã‚‰ç†è§£ã§ãã¾ã™ã€‚</p>
                <ul style="margin-left: 25px; line-height: 2;">
                    <li><strong>å›ºå®šç«¯</strong>ï¼šç«¯ã¯å‹•ã‘ãªã„ â†’ å¤‰ä½ã¯å¸¸ã«ã‚¼ãƒ­ â†’ <strong>ç¯€</strong>ã«ãªã‚‹</li>
                    <li><strong>è‡ªç”±ç«¯</strong>ï¼šç«¯ã¯è‡ªç”±ã«å‹•ã‘ã‚‹ â†’ å¤‰ä½ãŒæœ€å¤§ â†’ <strong>è…¹</strong>ã«ãªã‚‹</li>
                </ul>
            </div>
        </div>
        
        <!-- ==================== å•é¡Œã‚¿ãƒ– ==================== -->
        <div id="problem" class="tab-content">
            <h2>ç¢ºèªå•é¡Œ</h2>
            
            <div class="problem-section">
                <h4>å•é¡Œ1ï¼šé‡ã­åˆã‚ã›ã®åŸç†</h4>
                <p>ã‚ã‚‹ç‚¹ã«ãŠã„ã¦ã€æ³¢Aã«ã‚ˆã‚‹å¤‰ä½ãŒ $+3$ cmã€æ³¢Bã«ã‚ˆã‚‹å¤‰ä½ãŒ $-5$ cm ã§ã‚ã£ãŸã€‚ã“ã®ç‚¹ã§ã®åˆæˆæ³¢ã®å¤‰ä½ã‚’æ±‚ã‚ã‚ˆã€‚</p>
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <p><strong>è§£ç­”ï¼š$-2$ cm</strong></p>
                    <p>é‡ã­åˆã‚ã›ã®åŸç†ã‚ˆã‚Šã€åˆæˆæ³¢ã®å¤‰ä½ã¯å„æ³¢ã®å¤‰ä½ã®å’Œã«ãªã‚Šã¾ã™ã€‚</p>
                    $$ y = y_A + y_B = (+3) + (-5) = -2 \text{ cm} $$
                    <p>å¤‰ä½ãŒè² ãªã®ã§ã€ã“ã®ç‚¹ã§ã¯åª’è³ªã¯åŸºæº–ä½ç½®ã‚ˆã‚Šä¸‹ï¼ˆè°·ã®æ–¹å‘ï¼‰ã«å¤‰ä½ã—ã¦ã„ã¾ã™ã€‚</p>
                </details>
            </div>
            
            <div class="problem-section">
                <h4>å•é¡Œ2ï¼šå›ºå®šç«¯åå°„ã¨è‡ªç”±ç«¯åå°„</h4>
                <p>æ¬¡ã®æ–‡ç« ã®ï¼ˆã‚¢ï¼‰ï½ï¼ˆã‚¨ï¼‰ã«å…¥ã‚‹é©åˆ‡ãªèªå¥ã‚’ç­”ãˆã‚ˆã€‚</p>
                <p style="margin: 15px 0; padding: 15px; background: #f0f0f0; border-radius: 5px;">
                    ãƒ­ãƒ¼ãƒ—ã®ç«¯ã‚’å£ã«å›ºå®šã—ã¦æ³¢ã‚’é€ã‚‹ã¨ã€ï¼ˆã‚¢ï¼‰åå°„ãŒèµ·ã“ã‚Šã€å…¥å°„æ³¢ã¨åå°„æ³¢ã®ä½ç›¸ã¯ï¼ˆã‚¤ï¼‰ãšã‚Œã‚‹ã€‚ä¸€æ–¹ã€ãƒ­ãƒ¼ãƒ—ã®ç«¯ãŒè‡ªç”±ã«å‹•ã‘ã‚‹å ´åˆã¯ï¼ˆã‚¦ï¼‰åå°„ã¨ãªã‚Šã€ä½ç›¸ã¯ï¼ˆã‚¨ï¼‰ã€‚
                </p>
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <p><strong>è§£ç­”</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>ï¼ˆã‚¢ï¼‰å›ºå®šç«¯</li>
                        <li>ï¼ˆã‚¤ï¼‰$\pi$ï¼ˆã¾ãŸã¯180Â°ã€åŠæ³¢é•·åˆ†ï¼‰</li>
                        <li>ï¼ˆã‚¦ï¼‰è‡ªç”±ç«¯</li>
                        <li>ï¼ˆã‚¨ï¼‰ãšã‚Œãªã„ï¼ˆã¾ãŸã¯åŒä½ç›¸ã€0ï¼‰</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>è§£èª¬</strong></p>
                    <p>å›ºå®šç«¯åå°„ã§ã¯ã€ç«¯ãŒå‹•ã‘ãªã„ãŸã‚å¤‰ä½ãŒå¸¸ã«ã‚¼ãƒ­ã«ãªã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€å…¥å°„æ³¢ã¨åå°„æ³¢ãŒæ‰“ã¡æ¶ˆã—åˆã†ã‚ˆã†ã«ã€åå°„æ³¢ã¯é€†ä½ç›¸ï¼ˆä½ç›¸ãŒ $\pi$ ãšã‚Œã‚‹ï¼‰ã«ãªã‚Šã¾ã™ã€‚</p>
                    <p>è‡ªç”±ç«¯åå°„ã§ã¯ã€ç«¯ãŒè‡ªç”±ã«å‹•ã‘ã‚‹ãŸã‚ã€ä½ç›¸ã®ãšã‚Œã¯ç”Ÿã˜ã¾ã›ã‚“ã€‚å…¥å°„æ³¢ã®å±±ã¯å±±ã®ã¾ã¾åå°„ã•ã‚Œã¾ã™ã€‚</p>
                </details>
            </div>
            
            <div class="problem-section">
                <h4>å•é¡Œ3ï¼šå®šå¸¸æ³¢</h4>
                <p>æ³¢é•· $\lambda = 0.60$ m ã®æ³¢ã«ã‚ˆã£ã¦å®šå¸¸æ³¢ãŒç”Ÿã˜ã¦ã„ã‚‹ã€‚ã“ã®ã¨ãã€éš£ã‚Šåˆã†è…¹ã¨è…¹ã®é–“éš”ã€ãŠã‚ˆã³è…¹ã¨ç¯€ã®é–“éš”ã‚’ãã‚Œãã‚Œæ±‚ã‚ã‚ˆã€‚</p>
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <p><strong>è§£ç­”</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>è…¹ã¨è…¹ã®é–“éš”ï¼š$0.30$ m</li>
                        <li>è…¹ã¨ç¯€ã®é–“éš”ï¼š$0.15$ m</li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>è§£èª¬</strong></p>
                    <p>å®šå¸¸æ³¢ã«ãŠã„ã¦ã€</p>
                    <ul style="margin-left: 20px;">
                        <li>éš£ã‚Šåˆã†è…¹ã¨è…¹ã®é–“éš” ï¼ éš£ã‚Šåˆã†ç¯€ã¨ç¯€ã®é–“éš” ï¼ $\dfrac{\lambda}{2}$</li>
                        <li>è…¹ã¨ç¯€ã®é–“éš” ï¼ $\dfrac{\lambda}{4}$</li>
                    </ul>
                    <p style="margin-top: 10px;">ã—ãŸãŒã£ã¦ã€</p>
                    $$ \text{è…¹ã¨è…¹ã®é–“éš”} = \frac{\lambda}{2} = \frac{0.60}{2} = 0.30 \text{ m} $$
                    $$ \text{è…¹ã¨ç¯€ã®é–“éš”} = \frac{\lambda}{4} = \frac{0.60}{4} = 0.15 \text{ m} $$
                </details>
            </div>
        </div>
        
        <!-- ==================== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– ==================== -->
        <div id="simulation" class="tab-content">
            <h2>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            
            <div class="sim-tabs">
                <button class="sim-tab-btn active" onclick="openSimTab('superposition')">é‡ã­åˆã‚ã›</button>
                <button class="sim-tab-btn" onclick="openSimTab('standing')">å®šå¸¸æ³¢</button>
                <button class="sim-tab-btn" onclick="openSimTab('reflection')">åå°„</button>
            </div>
            
            <!-- ===== é‡ã­åˆã‚ã›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===== -->
            <div id="superposition" class="sim-panel active">
                <p>2ã¤ã®æ³¢ãŒå‡ºä¼šã†ã¨ãã€å¤‰ä½ãŒè¶³ã—åˆã‚ã•ã‚Œã‚‹æ§˜å­ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚</p>
                
                <div id="sim-container">
                    <div class="canvas-wrapper">
                        <canvas id="superpositionCanvas"></canvas>
                    </div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e74c3c;"></div>
                        <span>æ³¢Aï¼ˆå³å‘ãï¼‰</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <span>æ³¢Bï¼ˆå·¦å‘ãï¼‰</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2ecc71; height: 6px;"></div>
                        <span>åˆæˆæ³¢</span>
                    </div>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>æ³¢Aã®æŒ¯å¹…: <span class="value-display" id="ampADisplay">30 px</span></label>
                        <input type="range" id="ampASlider" min="10" max="50" value="30" step="5">
                    </div>
                    <div class="control-group">
                        <label>æ³¢Bã®æŒ¯å¹…: <span class="value-display" id="ampBDisplay">30 px</span></label>
                        <input type="range" id="ampBSlider" min="10" max="50" value="30" step="5">
                    </div>
                    <div class="control-group">
                        <label>æ³¢é•·: <span class="value-display" id="wlDisplay">100 px</span></label>
                        <input type="range" id="wlSlider" min="50" max="200" value="100" step="10">
                    </div>
                    <div class="control-group">
                        <label>é€Ÿã•: <span class="value-display" id="speedDisplay">0.5</span></label>
                        <input type="range" id="speedSlider" min="0.1" max="2" value="0.5" step="0.1">
                    </div>
                    <div class="button-group">
                        <button class="sim-button start" id="superpositionStartBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button reset" id="superpositionResetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
            </div>
            
            <!-- ===== å®šå¸¸æ³¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===== -->
            <div id="standing" class="sim-panel">
                <p>åŒã˜æŒ¯å¹…ãƒ»æ³¢é•·ã®æ³¢ãŒé€†å‘ãã«é€²ã‚€ã¨ã€å®šå¸¸æ³¢ãŒç”Ÿã˜ã¾ã™ã€‚è…¹ã¨ç¯€ã®ä½ç½®ã«æ³¨ç›®ã—ã¾ã—ã‚‡ã†ã€‚</p>
                
                <div id="sim-container">
                    <div class="canvas-wrapper">
                        <canvas id="standingCanvas"></canvas>
                    </div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(231, 76, 60, 0.5);"></div>
                        <span>å…¥å°„æ³¢</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(52, 152, 219, 0.5);"></div>
                        <span>åå°„æ³¢</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2ecc71; height: 6px;"></div>
                        <span>å®šå¸¸æ³¢</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #9b59b6; height: 8px; border-radius: 50%; width: 8px;"></div>
                        <span>è…¹</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e67e22; height: 8px; border-radius: 50%; width: 8px;"></div>
                        <span>ç¯€</span>
                    </div>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>æŒ¯å¹…: <span class="value-display" id="standingAmpDisplay">30 px</span></label>
                        <input type="range" id="standingAmpSlider" min="10" max="50" value="30" step="5">
                    </div>
                    <div class="control-group">
                        <label>æ³¢é•·: <span class="value-display" id="standingWlDisplay">120 px</span></label>
                        <input type="range" id="standingWlSlider" min="60" max="240" value="120" step="20">
                    </div>
                    <div class="button-group">
                        <button class="sim-button start" id="standingStartBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button reset" id="standingResetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
                
                <div class="info-display">
                    <p><strong>è…¹ã¨è…¹ã®é–“éš”:</strong> <span id="antinodeDistance">60</span> pxï¼ˆ= Î»/2ï¼‰</p>
                    <p><strong>è…¹ã§ã®æœ€å¤§æŒ¯å¹…:</strong> <span id="maxAmplitude">60</span> pxï¼ˆ= 2Aï¼‰</p>
                </div>
            </div>
            
            <!-- ===== åå°„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===== -->
            <div id="reflection" class="sim-panel">
                <p>å›ºå®šç«¯ã¨è‡ªç”±ç«¯ã§ã€åå°„ã®æ§˜å­ãŒã©ã†é•ã†ã‹è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚</p>
                <p>ä¸Šæ‰‹ã«ãƒ‘ãƒ«ã‚¹æ³¢ã‚’é€ã‚Šå‡ºã™ã¨å®šå¸¸æ³¢ã‚’ä½œã‚Šå‡ºã™ã“ã¨ãŒã§ãã¾ã™ã‚ˆã€‚</p>
                
                <div id="sim-container">
                    <div class="canvas-wrapper">
                        <canvas id="reflectionCanvas"></canvas>
                    </div>
                </div>
                
                <div class="toggle-group">
                    <button class="toggle-btn active" id="fixedEndBtn" onclick="setEndType('fixed')">å›ºå®šç«¯</button>
                    <button class="toggle-btn" id="freeEndBtn" onclick="setEndType('free')">è‡ªç”±ç«¯</button>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>ãƒ‘ãƒ«ã‚¹å¹…: <span class="value-display" id="pulseWidthDisplay">60 px</span></label>
                        <input type="range" id="pulseWidthSlider" min="30" max="100" value="60" step="10">
                    </div>
                    <div class="control-group">
                        <label>ãƒ‘ãƒ«ã‚¹é«˜ã•: <span class="value-display" id="pulseHeightDisplay">50 px</span></label>
                        <input type="range" id="pulseHeightSlider" min="20" max="80" value="50" step="10">
                    </div>
                    <div class="button-group">
                        <button class="sim-button start" id="reflectionStartBtn">ãƒ‘ãƒ«ã‚¹ã‚’é€ã‚‹</button>
                        <button class="sim-button" id="reflectionPauseBtn" style="background: #ff9800; color: white;">ä¸€æ™‚åœæ­¢</button>
                        <button class="sim-button reset" id="reflectionResetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
                
                <div class="info-display" id="reflectionInfo">
                    <p><strong>ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰:</strong> <span id="currentMode">å›ºå®šç«¯åå°„</span></p>
                    <p><strong>ç‰¹å¾´:</strong> <span id="modeDescription">ç«¯ã¯å‹•ã‹ãšã€ä½ç›¸ãŒ Ï€ ãšã‚Œã¦åå°„ã—ã¾ã™</span></p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // ========================================
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    // ========================================
    function openTab(tabName) {
        var contents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < contents.length; i++) {
            contents[i].style.display = "none";
            contents[i].classList.remove("active");
        }
        var buttons = document.getElementsByClassName("tab-btn");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        if (event && event.currentTarget) {
            event.currentTarget.classList.add("active");
        }
        
        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–ãŒé–‹ã‹ã‚ŒãŸã‚‰ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’åˆæœŸåŒ–
        if (tabName === 'simulation') {
            setTimeout(() => {
                initAllSimulations();
            }, 100);
        }
    }
    
    function openSimTab(tabName) {
        var panels = document.getElementsByClassName("sim-panel");
        for (var i = 0; i < panels.length; i++) {
            panels[i].style.display = "none";
            panels[i].classList.remove("active");
        }
        var buttons = document.getElementsByClassName("sim-tab-btn");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        if (event && event.currentTarget) {
            event.currentTarget.classList.add("active");
        }
        
        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ãƒªã‚µã‚¤ã‚º
        setTimeout(() => {
            resizeAllCanvases();
        }, 50);
    }
    
    // ========================================
    // å…±é€šå¤‰æ•°ãƒ»é–¢æ•°
    // ========================================
    let animationIds = {
        superposition: null,
        standing: null,
        reflection: null
    };
    
    function resizeCanvas(canvas, height = 250) {
        const container = canvas.parentElement;
        const dpr = window.devicePixelRatio || 1;
        const width = container.clientWidth;
        canvas.width = width * dpr;
        canvas.height = height * dpr;
        canvas.style.width = width + 'px';
        canvas.style.height = height + 'px';
        const ctx = canvas.getContext('2d');
        ctx.scale(dpr, dpr);
        return { width, height };
    }
    
    function resizeAllCanvases() {
        if (document.getElementById('superposition').classList.contains('active')) {
            initSuperposition();
        }
        if (document.getElementById('standing').classList.contains('active')) {
            initStanding();
        }
        if (document.getElementById('reflection').classList.contains('active')) {
            initReflection();
        }
    }
    
    function initAllSimulations() {
        initSuperposition();
        initStanding();
        initReflection();
    }
    
    // ========================================
    // é‡ã­åˆã‚ã›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    // ========================================
    let superpositionState = {
        running: false,
        time: 0,
        ampA: 30,
        ampB: 30,
        wavelength: 100,
        speed: 0.5
    };
    
    function initSuperposition() {
        const canvas = document.getElementById('superpositionCanvas');
        const { width, height } = resizeCanvas(canvas);
        drawSuperposition(canvas, width, height);
    }
    
    function drawSuperposition(canvas, width, height) {
        const ctx = canvas.getContext('2d');
        const state = superpositionState;
        const centerY = height / 2;
        
        ctx.clearRect(0, 0, width, height);
        
        // èƒŒæ™¯ã‚°ãƒªãƒƒãƒ‰
        ctx.strokeStyle = '#eee';
        ctx.lineWidth = 1;
        for (let y = 0; y <= height; y += 25) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(width, y);
            ctx.stroke();
        }
        
        // ä¸­å¿ƒç·š
        ctx.strokeStyle = '#ccc';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(0, centerY);
        ctx.lineTo(width, centerY);
        ctx.stroke();
        ctx.setLineDash([]);
        
        const k = 2 * Math.PI / state.wavelength;
        const omega = state.speed * k;
        
        // æ³¢Aï¼ˆå³å‘ãï¼‰
        ctx.strokeStyle = '#e74c3c';
        ctx.lineWidth = 2;
        ctx.beginPath();
        for (let x = 0; x <= width; x++) {
            const y = state.ampA * Math.sin(k * x - omega * state.time);
            if (x === 0) ctx.moveTo(x, centerY - y);
            else ctx.lineTo(x, centerY - y);
        }
        ctx.stroke();
        
        // æ³¢Bï¼ˆå·¦å‘ãï¼‰
        ctx.strokeStyle = '#3498db';
        ctx.lineWidth = 2;
        ctx.beginPath();
        for (let x = 0; x <= width; x++) {
            const y = state.ampB * Math.sin(k * x + omega * state.time);
            if (x === 0) ctx.moveTo(x, centerY - y);
            else ctx.lineTo(x, centerY - y);
        }
        ctx.stroke();
        
        // åˆæˆæ³¢
        ctx.strokeStyle = '#2ecc71';
        ctx.lineWidth = 4;
        ctx.beginPath();
        for (let x = 0; x <= width; x++) {
            const yA = state.ampA * Math.sin(k * x - omega * state.time);
            const yB = state.ampB * Math.sin(k * x + omega * state.time);
            const y = yA + yB;
            if (x === 0) ctx.moveTo(x, centerY - y);
            else ctx.lineTo(x, centerY - y);
        }
        ctx.stroke();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.font = '14px sans-serif';
        ctx.fillStyle = '#333';
        ctx.fillText('å¤‰ä½', 10, 20);
        ctx.fillText('ä½ç½® x', width - 50, height - 10);
    }
    
    function animateSuperposition() {
        if (!superpositionState.running) return;
        
        const canvas = document.getElementById('superpositionCanvas');
        const width = canvas.width / (window.devicePixelRatio || 1);
        const height = canvas.height / (window.devicePixelRatio || 1);
        
        superpositionState.time += 1;
        drawSuperposition(canvas, width, height);
        
        animationIds.superposition = requestAnimationFrame(animateSuperposition);
    }
    
    // é‡ã­åˆã‚ã›ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.getElementById('ampASlider').addEventListener('input', function() {
        superpositionState.ampA = parseFloat(this.value);
        document.getElementById('ampADisplay').textContent = this.value + ' px';
        if (!superpositionState.running) initSuperposition();
    });
    
    document.getElementById('ampBSlider').addEventListener('input', function() {
        superpositionState.ampB = parseFloat(this.value);
        document.getElementById('ampBDisplay').textContent = this.value + ' px';
        if (!superpositionState.running) initSuperposition();
    });
    
    document.getElementById('wlSlider').addEventListener('input', function() {
        superpositionState.wavelength = parseFloat(this.value);
        document.getElementById('wlDisplay').textContent = this.value + ' px';
        if (!superpositionState.running) initSuperposition();
    });
    
    document.getElementById('speedSlider').addEventListener('input', function() {
        superpositionState.speed = parseFloat(this.value);
        document.getElementById('speedDisplay').textContent = this.value;
    });
    
    document.getElementById('superpositionStartBtn').addEventListener('click', function() {
        if (superpositionState.running) {
            superpositionState.running = false;
            this.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
            cancelAnimationFrame(animationIds.superposition);
        } else {
            superpositionState.running = true;
            this.textContent = 'åœæ­¢';
            animateSuperposition();
        }
    });
    
    document.getElementById('superpositionResetBtn').addEventListener('click', function() {
        superpositionState.running = false;
        superpositionState.time = 0;
        document.getElementById('superpositionStartBtn').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
        cancelAnimationFrame(animationIds.superposition);
        initSuperposition();
    });
    
    // ========================================
    // å®šå¸¸æ³¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    // ========================================
    let standingState = {
        running: false,
        time: 0,
        amplitude: 30,
        wavelength: 120
    };
    
    function initStanding() {
        const canvas = document.getElementById('standingCanvas');
        const { width, height } = resizeCanvas(canvas);
        updateStandingInfo();
        drawStanding(canvas, width, height);
    }
    
    function updateStandingInfo() {
        document.getElementById('antinodeDistance').textContent = standingState.wavelength / 2;
        document.getElementById('maxAmplitude').textContent = standingState.amplitude * 2;
    }
    
    function drawStanding(canvas, width, height) {
        const ctx = canvas.getContext('2d');
        const state = standingState;
        const centerY = height / 2;
        
        ctx.clearRect(0, 0, width, height);
        
        // èƒŒæ™¯ã‚°ãƒªãƒƒãƒ‰
        ctx.strokeStyle = '#eee';
        ctx.lineWidth = 1;
        for (let y = 0; y <= height; y += 25) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(width, y);
            ctx.stroke();
        }
        
        // ä¸­å¿ƒç·š
        ctx.strokeStyle = '#ccc';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(0, centerY);
        ctx.lineTo(width, centerY);
        ctx.stroke();
        ctx.setLineDash([]);
        
        const k = 2 * Math.PI / state.wavelength;
        const omega = 0.02;
        
        // å…¥å°„æ³¢ï¼ˆè–„ãï¼‰
        ctx.strokeStyle = 'rgba(231, 76, 60, 0.4)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        for (let x = 0; x <= width; x++) {
            const y = state.amplitude * Math.sin(k * x - omega * state.time);
            if (x === 0) ctx.moveTo(x, centerY - y);
            else ctx.lineTo(x, centerY - y);
        }
        ctx.stroke();
        
        // åå°„æ³¢ï¼ˆè–„ãï¼‰
        ctx.strokeStyle = 'rgba(52, 152, 219, 0.4)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        for (let x = 0; x <= width; x++) {
            const y = state.amplitude * Math.sin(k * x + omega * state.time);
            if (x === 0) ctx.moveTo(x, centerY - y);
            else ctx.lineTo(x, centerY - y);
        }
        ctx.stroke();
        
        // å®šå¸¸æ³¢ï¼ˆåˆæˆæ³¢ï¼‰
        ctx.strokeStyle = '#2ecc71';
        ctx.lineWidth = 4;
        ctx.beginPath();
        for (let x = 0; x <= width; x++) {
            // å®šå¸¸æ³¢: 2A * cos(omega*t) * sin(k*x)
            const y = 2 * state.amplitude * Math.cos(omega * state.time) * Math.sin(k * x);
            if (x === 0) ctx.moveTo(x, centerY - y);
            else ctx.lineTo(x, centerY - y);
        }
        ctx.stroke();
        
        // è…¹ã¨ç¯€ã®ãƒãƒ¼ã‚­ãƒ³ã‚°
        const halfWavelength = state.wavelength / 2;
        const quarterWavelength = state.wavelength / 4;
        
        // ç¯€ï¼ˆsin(kx) = 0 ã¨ãªã‚‹ç‚¹: x = n * Î»/2ï¼‰
        ctx.fillStyle = '#e67e22';
        for (let x = 0; x <= width; x += halfWavelength) {
            ctx.beginPath();
            ctx.arc(x, centerY, 6, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        // è…¹ï¼ˆsin(kx) = Â±1 ã¨ãªã‚‹ç‚¹: x = Î»/4 + n * Î»/2ï¼‰
        ctx.fillStyle = '#9b59b6';
        for (let x = quarterWavelength; x <= width; x += halfWavelength) {
            ctx.beginPath();
            ctx.arc(x, centerY, 6, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        // ãƒ©ãƒ™ãƒ«
        ctx.font = '12px sans-serif';
        ctx.fillStyle = '#9b59b6';
        ctx.fillText('è…¹', quarterWavelength - 8, centerY - 15);
        ctx.fillStyle = '#e67e22';
        ctx.fillText('ç¯€', 5, centerY - 15);
    }
    
    function animateStanding() {
        if (!standingState.running) return;
        
        const canvas = document.getElementById('standingCanvas');
        const width = canvas.width / (window.devicePixelRatio || 1);
        const height = canvas.height / (window.devicePixelRatio || 1);
        
        standingState.time += 1;
        drawStanding(canvas, width, height);
        
        animationIds.standing = requestAnimationFrame(animateStanding);
    }
    
    // å®šå¸¸æ³¢ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.getElementById('standingAmpSlider').addEventListener('input', function() {
        standingState.amplitude = parseFloat(this.value);
        document.getElementById('standingAmpDisplay').textContent = this.value + ' px';
        updateStandingInfo();
        if (!standingState.running) initStanding();
    });
    
    document.getElementById('standingWlSlider').addEventListener('input', function() {
        standingState.wavelength = parseFloat(this.value);
        document.getElementById('standingWlDisplay').textContent = this.value + ' px';
        updateStandingInfo();
        if (!standingState.running) initStanding();
    });
    
    document.getElementById('standingStartBtn').addEventListener('click', function() {
        if (standingState.running) {
            standingState.running = false;
            this.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
            cancelAnimationFrame(animationIds.standing);
        } else {
            standingState.running = true;
            this.textContent = 'åœæ­¢';
            animateStanding();
        }
    });
    
    document.getElementById('standingResetBtn').addEventListener('click', function() {
        standingState.running = false;
        standingState.time = 0;
        document.getElementById('standingStartBtn').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
        cancelAnimationFrame(animationIds.standing);
        initStanding();
    });
    
    // ========================================
    // åå°„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    // ========================================
    let reflectionState = {
        running: false,
        paused: false,
        endType: 'fixed', // 'fixed' or 'free'
        pulseWidth: 60,
        pulseHeight: 50,
        speed: 1.5,
        pulses: [] // è¤‡æ•°ã®ãƒ‘ãƒ«ã‚¹ã‚’ç®¡ç†ã™ã‚‹é…åˆ—
    };
    
    function initReflection() {
        const canvas = document.getElementById('reflectionCanvas');
        const { width, height } = resizeCanvas(canvas);
        reflectionState.pulses = [];
        reflectionState.running = false;
        reflectionState.paused = false;
        document.getElementById('reflectionPauseBtn').textContent = 'ä¸€æ™‚åœæ­¢';
        drawReflection(canvas, width, height);
    }
    
    function setEndType(type) {
        reflectionState.endType = type;
        document.getElementById('fixedEndBtn').classList.toggle('active', type === 'fixed');
        document.getElementById('freeEndBtn').classList.toggle('active', type === 'free');
        
        if (type === 'fixed') {
            document.getElementById('currentMode').textContent = 'å›ºå®šç«¯åå°„';
            document.getElementById('modeDescription').textContent = 'ç«¯ã¯å‹•ã‹ãšã€ä½ç›¸ãŒ Ï€ ãšã‚Œã¦åå°„ã—ã¾ã™';
        } else {
            document.getElementById('currentMode').textContent = 'è‡ªç”±ç«¯åå°„';
            document.getElementById('modeDescription').textContent = 'ç«¯ã¯è‡ªç”±ã«å‹•ãã€ä½ç›¸ã¯ãã®ã¾ã¾åå°„ã—ã¾ã™';
        }
        
        initReflection();
    }
    
    function gaussianPulse(x, center, width, height) {
        const sigma = width / 3;
        return height * Math.exp(-Math.pow(x - center, 2) / (2 * sigma * sigma));
    }
    
    function addPulse() {
        const canvas = document.getElementById('reflectionCanvas');
        const width = canvas.width / (window.devicePixelRatio || 1);
        
        reflectionState.pulses.push({
            x: 50,
            reflected: false,
            reflectedX: width + 100,
            width: reflectionState.pulseWidth,
            height: reflectionState.pulseHeight
        });
    }
    
    function drawReflection(canvas, width, height) {
        const ctx = canvas.getContext('2d');
        const state = reflectionState;
        const centerY = height / 2;
        const wallX = width - 40;
        
        ctx.clearRect(0, 0, width, height);
        
        // èƒŒæ™¯
        ctx.fillStyle = '#f9f9f9';
        ctx.fillRect(0, 0, width, height);
        
        // ä¸­å¿ƒç·šï¼ˆãƒ­ãƒ¼ãƒ—ï¼‰
        ctx.strokeStyle = '#aaa';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(0, centerY);
        ctx.lineTo(wallX, centerY);
        ctx.stroke();
        
        // å£
        ctx.fillStyle = state.endType === 'fixed' ? '#555' : '#3498db';
        ctx.fillRect(wallX, centerY - 60, 20, 120);
        
        // å›ºå®šç«¯/è‡ªç”±ç«¯ã®è¡¨ç¤º
        if (state.endType === 'free') {
            // è‡ªç”±ç«¯ï¼šãƒªãƒ³ã‚°
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.arc(wallX, centerY, 10, 0, 2 * Math.PI);
            ctx.stroke();
        } else {
            // å›ºå®šç«¯ï¼šå›ºå®šç‚¹
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(wallX, centerY, 8, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        // æ³¢å½¢ã®æç”»ï¼ˆã™ã¹ã¦ã®ãƒ‘ãƒ«ã‚¹ã‚’åˆæˆï¼‰
        ctx.strokeStyle = '#667eea';
        ctx.lineWidth = 4;
        ctx.beginPath();
        
        for (let x = 0; x <= wallX; x++) {
            let y = 0;
            
            // ã™ã¹ã¦ã®ãƒ‘ãƒ«ã‚¹ã‚’åˆæˆ
            for (const pulse of state.pulses) {
                // å…¥å°„ãƒ‘ãƒ«ã‚¹
                if (pulse.x > -pulse.width * 2 && pulse.x < wallX + pulse.width) {
                    y += gaussianPulse(x, pulse.x, pulse.width, pulse.height);
                }
                
                // åå°„ãƒ‘ãƒ«ã‚¹
                if (pulse.reflected) {
                    const sign = state.endType === 'fixed' ? -1 : 1;
                    y += sign * gaussianPulse(x, pulse.reflectedX, pulse.width, pulse.height);
                }
            }
            
            // å›ºå®šç«¯ã§ã¯ç«¯ã®å¤‰ä½ã¯0
            if (state.endType === 'fixed' && x >= wallX - 5) {
                y = 0;
            }
            
            if (x === 0) ctx.moveTo(x, centerY - y);
            else ctx.lineTo(x, centerY - y);
        }
        ctx.stroke();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#333';
        ctx.fillText(state.endType === 'fixed' ? 'å›ºå®šç«¯' : 'è‡ªç”±ç«¯', wallX - 25, height - 20);
        
        // ãƒ‘ãƒ«ã‚¹æ•°ã®è¡¨ç¤º
        ctx.font = '12px sans-serif';
        ctx.fillStyle = '#666';
        ctx.fillText('ãƒ‘ãƒ«ã‚¹æ•°: ' + state.pulses.length, 10, 20);
    }
    
    function animateReflection() {
        if (!reflectionState.running || reflectionState.paused) return;
        
        const canvas = document.getElementById('reflectionCanvas');
        const width = canvas.width / (window.devicePixelRatio || 1);
        const height = canvas.height / (window.devicePixelRatio || 1);
        const wallX = width - 40;
        
        // å„ãƒ‘ãƒ«ã‚¹ã‚’æ›´æ–°
        for (const pulse of reflectionState.pulses) {
            // ãƒ‘ãƒ«ã‚¹ã‚’é€²ã‚ã‚‹
            pulse.x += reflectionState.speed;
            
            // åå°„åˆ¤å®š
            if (pulse.x >= wallX - pulse.width / 2 && !pulse.reflected) {
                pulse.reflected = true;
                pulse.reflectedX = wallX - (pulse.x - wallX);
            }
            
            // åå°„æ³¢ã‚’é€²ã‚ã‚‹
            if (pulse.reflected) {
                pulse.reflectedX -= reflectionState.speed;
            }
        }
        
        // ç”»é¢å¤–ã«å‡ºãŸãƒ‘ãƒ«ã‚¹ã‚’å‰Šé™¤
        reflectionState.pulses = reflectionState.pulses.filter(pulse => {
            const outOfBounds = pulse.x > width + 100 && pulse.reflectedX < -100;
            return !outOfBounds;
        });
        
        drawReflection(canvas, width, height);
        
        animationIds.reflection = requestAnimationFrame(animateReflection);
    }
    
    // åå°„ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.getElementById('pulseWidthSlider').addEventListener('input', function() {
        reflectionState.pulseWidth = parseFloat(this.value);
        document.getElementById('pulseWidthDisplay').textContent = this.value + ' px';
    });
    
    document.getElementById('pulseHeightSlider').addEventListener('input', function() {
        reflectionState.pulseHeight = parseFloat(this.value);
        document.getElementById('pulseHeightDisplay').textContent = this.value + ' px';
    });
    
    document.getElementById('reflectionStartBtn').addEventListener('click', function() {
        // ãƒ‘ãƒ«ã‚¹ã‚’è¿½åŠ 
        addPulse();
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ï¼ˆã¾ã é–‹å§‹ã—ã¦ã„ãªã„å ´åˆï¼‰
        if (!reflectionState.running) {
            reflectionState.running = true;
            reflectionState.paused = false;
            document.getElementById('reflectionPauseBtn').textContent = 'ä¸€æ™‚åœæ­¢';
            animateReflection();
        }
    });
    
    document.getElementById('reflectionPauseBtn').addEventListener('click', function() {
        if (reflectionState.paused) {
            reflectionState.paused = false;
            this.textContent = 'ä¸€æ™‚åœæ­¢';
            animateReflection();
        } else {
            reflectionState.paused = true;
            this.textContent = 'å†é–‹';
        }
    });
    
    document.getElementById('reflectionResetBtn').addEventListener('click', function() {
        reflectionState.running = false;
        reflectionState.paused = false;
        cancelAnimationFrame(animationIds.reflection);
        initReflection();
    });
    
    // ========================================
    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
    // ========================================
    window.addEventListener('resize', function() {
        resizeAllCanvases();
    });
    
    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
        // æœ€åˆã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå ´åˆã®ã¿åˆæœŸåŒ–
        if (document.getElementById('simulation').classList.contains('active')) {
            initAllSimulations();
        }
    });
    </script>
</body>
</html>