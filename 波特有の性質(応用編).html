<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ ¡ç‰©ç† - æ³¢ç‰¹æœ‰ã®æ€§è³ªï¼ˆå¿œç”¨ç·¨ï¼‰</title>
    <script>
      window.MathJax = {
      tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
     }
     };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .back-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        h1 {
            color: #333;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        .tab-btn:hover {
            background: #8899f0;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        h2 {
            color: #667eea;
            margin-bottom: 15px;
            margin-top: 30px;
        }
        h2:first-child {
            margin-top: 0;
        }
        h3 {
            color: #555;
            margin: 20px 0 10px 0;
            padding-left: 10px;
            border-left: 4px solid #667eea;
        }
        p {
            line-height: 1.8;
            margin-bottom: 15px;
            text-align: justify;
        }
        .pdf-placeholder {
            background: #f9f9f9;
            padding: 40px;
            text-align: center;
            border-radius: 5px;
            color: #666;
        }
        
        /* è§£èª¬ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .concept-box {
            background: linear-gradient(135deg, #e8f4fd 0%, #f0e6ff 100%);
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }
        .concept-box h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .point-box {
            background: #fff3e0;
            border: 2px solid #ff9800;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .point-box h4 {
            color: #e65100;
            margin-bottom: 10px;
        }
        .figure-container {
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        .figure-container canvas {
            max-width: 100%;
            border: 1px solid #eee;
            background: white;
        }
        .figure-caption {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        /* ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹åŸç†ã‚¹ãƒ†ãƒƒãƒ—ãƒ„ãƒ¼ãƒ« */
        .huygens-tool {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .huygens-steps {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .step-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .step-btn.active {
            background: #667eea;
            color: white;
        }
        .step-btn:hover {
            background: #8899f0;
            color: white;
        }
        .step-description {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            min-height: 80px;
        }
        
        /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #sim-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        #physicsCanvas, #slitCanvas {
            display: block;
            width: 100%;
            background: white;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
        .sim-controls {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
        }
        .control-group {
            margin-bottom: 20px;
        }
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .sim-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .sim-button.start {
            background: #4CAF50;
            color: white;
        }
        .sim-button.start:hover {
            background: #45a049;
        }
        .sim-button.reset {
            background: #f44336;
            color: white;
        }
        .sim-button.reset:hover {
            background: #da190b;
        }
        .sim-section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px dashed #ddd;
        }
        .sim-section:last-child {
            border-bottom: none;
        }
        .sim-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #667eea;
        }
        .toggle-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .toggle-btn {
            padding: 10px 25px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .toggle-btn.active {
            background: #667eea;
            color: white;
        }
        
        /* å•é¡Œç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .problem {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .problem h4 {
            color: #333;
            margin-bottom: 15px;
        }
        .problem p {
            margin-bottom: 10px;
        }
        details {
            margin-top: 15px;
        }
        summary {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        summary:hover {
            background: #5568d8;
        }
        .answer {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 0 0 10px 10px;
            margin-top: 5px;
        }
        
        .application-hint {
            background: linear-gradient(135deg, #e3f2fd 0%, #fce4ec 100%);
            border: 2px solid #9c27b0;
            padding: 20px;
            margin: 30px 0;
            border-radius: 10px;
        }
        .application-hint h4 {
            color: #7b1fa2;
            margin-bottom: 15px;
        }
        .application-hint ul {
            margin-left: 20px;
        }
        .application-hint li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            header, .container {
                padding: 15px;
            }
            .tab-btn {
                min-width: 100px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="back-link">â† ç›®æ¬¡ã«æˆ»ã‚‹</a>
        <h1>æ³¢ç‰¹æœ‰ã®æ€§è³ªï¼ˆå¿œç”¨ç·¨ï¼‰ã€œæ³¢é¢ã¨ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã€œ</h1>
    </header>
    <div class="container">
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('lecture')">è§£èª¬ç·¨</button>
            <button class="tab-btn" onclick="openTab('problem')">å•é¡Œç·¨</button>
            <button class="tab-btn" onclick="openTab('simulation')">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>
        
        <!-- ========== è§£èª¬ã‚¿ãƒ– ========== -->
        <div id="lecture" class="tab-content active">
            
            <h2>1. æ³¢é¢ã¨ã¯ä½•ã‹</h2>
            
            <p>
                æ°´é¢ã«çŸ³ã‚’è½ã¨ã™ã¨ã€è½ä¸‹ç‚¹ã‚’ä¸­å¿ƒã«å††å½¢ã®æ³¢ç´‹ãŒåºƒãŒã£ã¦ã„ãæ§˜å­ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚
                ã“ã®ã¨ãã€æ³¢ã®ã€Œå±±ã€ã‚„ã€Œè°·ã€ã¯ã©ã®ã‚ˆã†ã«åºƒãŒã£ã¦ã„ã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ
            </p>
            
            <div class="figure-container">
                <canvas id="wavefrontFig1" width="500" height="250"></canvas>
                <p class="figure-caption">å›³1ï¼šæ°´é¢æ³¢ã®åºƒãŒã‚Šï¼ˆä¸Šã‹ã‚‰è¦‹ãŸæ§˜å­ï¼‰</p>
            </div>
            
            <p>
                ã‚ˆãè¦³å¯Ÿã™ã‚‹ã¨ã€æ³¢ã®å±±ã¯åŒå¿ƒå††çŠ¶ã«åºƒãŒã‚Šã€è°·ã‚‚åŒæ§˜ã«åŒå¿ƒå††çŠ¶ã«åºƒãŒã£ã¦ã„ã¾ã™ã€‚
                ã¤ã¾ã‚Šã€<strong>åŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§åŒã˜æŒ¯å‹•çŠ¶æ…‹ã«ã‚ã‚‹ç‚¹</strong>ï¼ˆåŒä½ç›¸ã®ç‚¹ï¼‰ã‚’çµã¶ã¨ã€ãã‚Œã„ãªå††ã«ãªã‚‹ã®ã§ã™ã€‚
            </p>
            
            <div class="concept-box">
                <h4>ğŸ“ æ³¢é¢ã®å®šç¾©</h4>
                <p>
                    <strong>æ³¢é¢ï¼ˆwave frontï¼‰</strong>ã¨ã¯ã€<strong>åŒä½ç›¸ã®ç‚¹ã‚’é€£ã­ã¦ã§ãã‚‹ç·šã¾ãŸã¯é¢</strong>ã®ã“ã¨ã§ã™ã€‚
                </p>
                <p>
                    ä¾‹ãˆã°ã€ã™ã¹ã¦ã®ã€Œå±±ã€ã‚’çµã‚“ã ç·šã€ã™ã¹ã¦ã®ã€Œè°·ã€ã‚’çµã‚“ã ç·šãŒæ³¢é¢ã«ãªã‚Šã¾ã™ã€‚
                    æ³¢é¢ã¯ã€æ³¢ãŒã©ã“ã¾ã§åˆ°é”ã—ãŸã‹ã‚’ç¤ºã™ã€Œæ³¢ã®å…ˆç«¯ã€ã‚’è¡¨ã—ã¾ã™ã€‚
                </p>
            </div>
            
            <h3>æ³¢é¢ã¨æ³¢ã®é€²è¡Œæ–¹å‘ã®é–¢ä¿‚</h3>
            
            <div class="figure-container">
                <canvas id="wavefrontFig2" width="500" height="200"></canvas>
                <p class="figure-caption">å›³2ï¼šæ³¢é¢ã¨é€²è¡Œæ–¹å‘ã¯å¸¸ã«å‚ç›´</p>
            </div>
            
            <div class="point-box">
                <h4>âš¡ é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h4>
                <p>
                    <strong>æ³¢ã®é€²è¡Œæ–¹å‘ã¨æ³¢é¢ã¯å¸¸ã«å‚ç›´</strong>ã§ã‚ã‚‹ã€‚
                </p>
                <p>
                    ã“ã‚Œã¯å¹³é¢æ³¢ã§ã‚‚çƒé¢æ³¢ã§ã‚‚æˆã‚Šç«‹ã¤æ™®éçš„ãªæ€§è³ªã§ã™ã€‚
                    æ³¢é¢ã‚’è¿½ã„ã‹ã‘ã¦ã„ãã¨ã€æ³¢ãŒã©ã®æ–¹å‘ã«é€²ã‚“ã§ã„ã‚‹ã‹ãŒã‚ã‹ã‚Šã¾ã™ã€‚
                </p>
            </div>
            
            <h3>å¹³é¢æ³¢ã¨çƒé¢æ³¢</h3>
            
            <p>æ³¢é¢ã®å½¢çŠ¶ã«ã‚ˆã£ã¦ã€æ³¢ã¯æ¬¡ã®2ç¨®é¡ã«åˆ†é¡ã•ã‚Œã¾ã™ï¼š</p>
            
            <div class="figure-container">
                <canvas id="wavefrontFig3" width="600" height="250"></canvas>
                <p class="figure-caption">å›³3ï¼šå¹³é¢æ³¢ã¨çƒé¢æ³¢ã®æ¯”è¼ƒ</p>
            </div>
            
            <div class="concept-box">
                <h4>ğŸŒŠ å¹³é¢æ³¢ã¨çƒé¢æ³¢</h4>
                <p><strong>â‘  å¹³é¢æ³¢</strong>ï¼šæ³¢é¢ãŒç›´ç·šï¼ˆ2æ¬¡å…ƒï¼‰ã¾ãŸã¯å¹³é¢ï¼ˆ3æ¬¡å…ƒï¼‰ã§ã‚ã‚‹æ³¢</p>
                <ul style="margin-left: 20px; margin-top: 5px;">
                    <li>é ãã‹ã‚‰ã‚„ã£ã¦ãã‚‹å…‰ã‚„éŸ³ã¯ã€ã»ã¼å¹³é¢æ³¢ã¨ã¿ãªã›ã‚‹</li>
                    <li>æ³¢ã®é€²è¡Œæ–¹å‘ã¯ä¸€å®šï¼ˆå¹³è¡Œï¼‰</li>
                </ul>
                <p style="margin-top: 10px;"><strong>â‘¡ çƒé¢æ³¢</strong>ï¼šæ³¢é¢ãŒå††ï¼ˆ2æ¬¡å…ƒï¼‰ã¾ãŸã¯çƒé¢ï¼ˆ3æ¬¡å…ƒï¼‰ã§ã‚ã‚‹æ³¢</p>
                <ul style="margin-left: 20px; margin-top: 5px;">
                    <li>ç‚¹æ³¢æºã‹ã‚‰ç™ºç”Ÿã—ãŸæ³¢</li>
                    <li>æ³¢ã¯æ³¢æºã‹ã‚‰æ”¾å°„çŠ¶ã«åºƒãŒã‚‹</li>
                </ul>
            </div>
            
            <hr style="margin: 40px 0; border: none; border-top: 2px solid #eee;">
            
            <h2>2. ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†</h2>
            
            <p>
                17ä¸–ç´€ã€ã‚ªãƒ©ãƒ³ãƒ€ã®ç‰©ç†å­¦è€…<strong>ã‚¯ãƒªã‚¹ãƒ†ã‚£ã‚¢ãƒ¼ãƒ³ãƒ»ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹</strong>ã¯ã€
                æ³¢ãŒã©ã®ã‚ˆã†ã«ä¼ã‚ã‚‹ã‹ã‚’èª¬æ˜ã™ã‚‹ç”»æœŸçš„ãªåŸç†ã‚’æå”±ã—ã¾ã—ãŸã€‚
                æ°´é¢ã‚’é€²ã‚€å¹³é¢æ³¢ãŒé˜²æ³¢å ¤ã‚’é€šéã—ãŸå…ˆã§çƒé¢æ³¢ã«ãªã‚‹ç¾è±¡ã‚’è¦³å¯Ÿã—ã€ã“ã®åŸç†ã‚’å°ãã¾ã—ãŸã€‚
            </p>
            
            <div class="concept-box">
                <h4>ğŸ”¬ ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ï¼ˆHuygens' Principleï¼‰</h4>
                <p style="font-size: 1.05em;">
                    æ³¢é¢ä¸Šã®ã™ã¹ã¦ã®ç‚¹ã¯ã€ãã‚Œãã‚ŒãŒæ–°ãŸãª<strong>ç‚¹æ³¢æº</strong>ã¨ãªã‚Šã€
                    <strong>ç´ å…ƒæ³¢</strong>ï¼ˆçƒé¢æ³¢ï¼‰ã‚’ç™ºç”Ÿã•ã›ã‚‹ã€‚
                    æ¬¡ã®ç¬é–“ã®æ³¢é¢ã¯ã€ã“ã‚Œã‚‰ã®ç´ å…ƒæ³¢ã®<strong>åŒ…çµ¡ç·šï¼ˆå…±é€šæ¥ç·šï¼‰</strong>ã¨ã—ã¦å½¢æˆã•ã‚Œã‚‹ã€‚
                </p>
            </div>
            
            <p>
                ã“ã®åŸç†ã‚’ã€ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«å›³è§£ã§ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
            </p>
            
            <div class="huygens-tool">
                <h4 style="margin-bottom: 15px;">ğŸ“– ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç† ã‚¹ãƒ†ãƒƒãƒ—è§£èª¬</h4>
                <div class="huygens-steps">
                    <button class="step-btn active" onclick="showHuygensStep(1)">Step 1</button>
                    <button class="step-btn" onclick="showHuygensStep(2)">Step 2</button>
                    <button class="step-btn" onclick="showHuygensStep(3)">Step 3</button>
                    <button class="step-btn" onclick="showHuygensStep(4)">Step 4</button>
                </div>
                <div class="figure-container" style="margin: 0;">
                    <canvas id="huygensStepCanvas" width="550" height="300"></canvas>
                </div>
                <div class="step-description" id="stepDescription">
                    <strong>Step 1ï¼š</strong>ç¾åœ¨ã®æ³¢é¢ã‚’è€ƒãˆã¾ã™ã€‚ã“ã®æ³¢é¢ä¸Šã®ã™ã¹ã¦ã®ç‚¹ã«æ³¨ç›®ã—ã¾ã—ã‚‡ã†ã€‚
                </div>
            </div>
            
            <h3>ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã®æ•°å­¦çš„è¡¨ç¾</h3>
            
            <p>
                æ³¢ãŒé€Ÿã• $v$ ã§ä¼ã‚ã‚‹ã¨ãã€æ™‚é–“ $\Delta t$ ã®é–“ã«æ³¢é¢ã¯è·é›¢ $v \Delta t$ ã ã‘é€²ã¿ã¾ã™ã€‚
                ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã«å¾“ãˆã°ï¼š
            </p>
            
            <ul style="margin-left: 20px; margin-bottom: 15px;">
                <li>å„ç‚¹ã‹ã‚‰ç™ºç”Ÿã™ã‚‹ç´ å…ƒæ³¢ã®åŠå¾„ã¯ $r = v \Delta t$</li>
                <li>ã™ã¹ã¦ã®ç´ å…ƒæ³¢ã®å…±é€šæ¥ç·šï¼ˆåŒ…çµ¡ç·šï¼‰ãŒæ–°ã—ã„æ³¢é¢ã¨ãªã‚‹</li>
            </ul>
            
            <p>
                ã“ã®åŸç†ã®ç¾ã—ã„ç‚¹ã¯ã€<strong>å¹³é¢æ³¢ã®ç›´é€²</strong>ã ã‘ã§ãªãã€
                <strong>çƒé¢æ³¢ã®åºƒãŒã‚Š</strong>ã‚‚åŒã˜åŸç†ã§èª¬æ˜ã§ãã‚‹ã“ã¨ã§ã™ã€‚
            </p>
            
            <div class="application-hint">
                <h4>ğŸš€ ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã®å¿œç”¨</h4>
                <p>ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã¯ã€ä»¥ä¸‹ã®é‡è¦ãªæ³¢å‹•ç¾è±¡ã‚’çµ±ä¸€çš„ã«èª¬æ˜ã§ãã‚‹å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ï¼š</p>
                <ul>
                    <li><strong>åå°„ã®æ³•å‰‡</strong>ï¼šå…¥å°„è§’ = åå°„è§’ã¨ãªã‚‹ã“ã¨ã‚’å°å‡ºã§ãã‚‹</li>
                    <li><strong>å±ˆæŠ˜ã®æ³•å‰‡ï¼ˆã‚¹ãƒãƒ«ã®æ³•å‰‡ï¼‰</strong>ï¼šåª’è³ªã®å¢ƒç•Œã§æ³¢ãŒæ›²ãŒã‚‹ç†ç”±ã‚’èª¬æ˜ã§ãã‚‹</li>
                    <li><strong>å›æŠ˜</strong>ï¼šæ³¢ãŒéšœå®³ç‰©ã®èƒŒå¾Œã«å›ã‚Šè¾¼ã‚€ç¾è±¡ã‚’èª¬æ˜ã§ãã‚‹</li>
                    <li><strong>å¹²æ¸‰</strong>ï¼šè¤‡æ•°ã®æ³¢ãŒé‡ã­åˆã‚ã•ã‚‹ç¾è±¡ã®åŸºç¤ã¨ãªã‚‹</li>
                </ul>
                <p style="margin-top: 10px; color: #7b1fa2;">
                    â†’ ã“ã‚Œã‚‰ã®ç¾è±¡ã¯ã€ä»Šå¾Œã®æˆæ¥­ã§è©³ã—ãå­¦ã³ã¾ã™ã€‚ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ãŒãã®åŸºç¤ã«ãªã‚‹ã“ã¨ã‚’è¦šãˆã¦ãŠãã¾ã—ã‚‡ã†ï¼
                </p>
            </div>
            
            <hr style="margin: 40px 0; border: none; border-top: 2px solid #eee;">
            
            <h2>3. æˆæ¥­è³‡æ–™</h2>
            <iframe src="https://drive.google.com/file/d/1rd3AUHNkj-NLM0IEztEdsiVOdPwxD6EA/preview" width="100%" height="500"></iframe>
        </div>
        
        <!-- ========== å•é¡Œã‚¿ãƒ– ========== -->
        <div id="problem" class="tab-content">
            <h2>ç¢ºèªå•é¡Œ</h2>
            
            <div class="problem">
                <h4>å•é¡Œ1ï¼šæ³¢é¢ã®åŸºæœ¬</h4>
                <p>
                    æ¬¡ã®æ–‡ç« ã®ç©ºæ¬„ã‚’åŸ‹ã‚ãªã•ã„ã€‚
                </p>
                <p>
                    (1) æ³¢é¢ã¨ã¯ã€ï¼ˆã€€ã‚¢ã€€ï¼‰ã®ç‚¹ã‚’é€£ã­ã¦ã§ãã‚‹ç·šã¾ãŸã¯é¢ã®ã“ã¨ã§ã‚ã‚‹ã€‚
                </p>
                <p>
                    (2) æ³¢ã®é€²è¡Œæ–¹å‘ã¨æ³¢é¢ã¯å¸¸ã«ï¼ˆã€€ã‚¤ã€€ï¼‰ã§ã‚ã‚‹ã€‚
                </p>
                <p>
                    (3) æ³¢é¢ãŒç›´ç·šã¾ãŸã¯å¹³é¢ã§ã‚ã‚‹æ³¢ã‚’ï¼ˆã€€ã‚¦ã€€ï¼‰ã¨ã„ã„ã€æ³¢é¢ãŒå††ã¾ãŸã¯çƒé¢ã§ã‚ã‚‹æ³¢ã‚’ï¼ˆã€€ã‚¨ã€€ï¼‰ã¨ã„ã†ã€‚
                </p>
                
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="answer">
                        <p><strong>è§£ç­”</strong></p>
                        <p>ã‚¢ï¼šåŒä½ç›¸ã€€ã€€ã‚¤ï¼šå‚ç›´ã€€ã€€ã‚¦ï¼šå¹³é¢æ³¢ã€€ã€€ã‚¨ï¼šçƒé¢æ³¢</p>
                        <p style="margin-top: 15px;"><strong>è§£èª¬</strong></p>
                        <p>
                            æ³¢é¢ã¯ã€ŒåŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§åŒã˜æŒ¯å‹•çŠ¶æ…‹ã«ã‚ã‚‹ç‚¹ã€ã‚’çµã‚“ã ã‚‚ã®ã§ã™ã€‚
                            æ³¢ã¯æ³¢é¢ã«å¯¾ã—ã¦å‚ç›´ãªæ–¹å‘ã«é€²ã‚€ãŸã‚ã€æ³¢ã®é€²è¡Œæ–¹å‘ã¨æ³¢é¢ã¯å¸¸ã«å‚ç›´ã«ãªã‚Šã¾ã™ã€‚
                            é æ–¹ã‹ã‚‰æ¥ã‚‹å…‰ã‚„éŸ³ã¯å¹³é¢æ³¢ã¨ã¿ãªã›ã€ç‚¹å…‰æºã‹ã‚‰ç™ºã›ã‚‰ã‚ŒãŸå…‰ã¯çƒé¢æ³¢ã¨ãªã‚Šã¾ã™ã€‚
                        </p>
                    </div>
                </details>
            </div>
            
            <div class="problem">
                <h4>å•é¡Œ2ï¼šãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†</h4>
                <p>
                    ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã«ã¤ã„ã¦ã€æ¬¡ã®å•ã„ã«ç­”ãˆãªã•ã„ã€‚
                </p>
                <p>
                    (1) ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã«ãŠã„ã¦ã€æ³¢é¢ä¸Šã®å„ç‚¹ã‹ã‚‰ç™ºç”Ÿã™ã‚‹çƒé¢æ³¢ã‚’ä½•ã¨ã„ã†ã‹ã€‚
                </p>
                <p>
                    (2) æ¬¡ã®ç¬é–“ã®æ³¢é¢ã¯ã€(1)ã®ä½•ã¨ã—ã¦å½¢æˆã•ã‚Œã‚‹ã‹ã€‚
                </p>
                <p>
                    (3) æ³¢ã®é€Ÿã•ãŒ $v = 340$ m/s ã®ã¨ãã€$\Delta t = 0.01$ s å¾Œã®ç´ å…ƒæ³¢ã®åŠå¾„ã¯ä½• m ã‹ã€‚
                </p>
                
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="answer">
                        <p><strong>è§£ç­”</strong></p>
                        <p>(1) ç´ å…ƒæ³¢</p>
                        <p>(2) åŒ…çµ¡ç·šï¼ˆå…±é€šæ¥ç·šï¼‰</p>
                        <p>(3) $r = v \Delta t = 340 \times 0.01 = 3.4$ m</p>
                        <p style="margin-top: 15px;"><strong>è§£èª¬</strong></p>
                        <p>
                            ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã§ã¯ã€ç¾åœ¨ã®æ³¢é¢ä¸Šã®ã™ã¹ã¦ã®ç‚¹ãŒæ–°ãŸãªæ³¢æºã¨ãªã‚Šã€
                            ç´ å…ƒæ³¢ã¨å‘¼ã°ã‚Œã‚‹çƒé¢æ³¢ã‚’ç™ºç”Ÿã•ã›ã¾ã™ã€‚
                            ã“ã‚Œã‚‰ã®ç´ å…ƒæ³¢ã™ã¹ã¦ã«æ¥ã™ã‚‹ç·šï¼ˆåŒ…çµ¡ç·šï¼‰ãŒã€æ¬¡ã®ç¬é–“ã®æ³¢é¢ã‚’å½¢æˆã—ã¾ã™ã€‚
                            ç´ å…ƒæ³¢ã®åŠå¾„ã¯ã€æ³¢ã®é€Ÿã•ã¨çµŒéæ™‚é–“ã®ç©ã§æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚
                        </p>
                    </div>
                </details>
            </div>
            
            <div class="problem">
                <h4>å•é¡Œ3ï¼šå¿œç”¨å•é¡Œ</h4>
                <p>
                    å¹³é¢æ³¢ãŒéšœå®³ç‰©ã®éš™é–“ï¼ˆã‚¹ãƒªãƒƒãƒˆï¼‰ã‚’é€šéã™ã‚‹ã¨ãã€ã‚¹ãƒªãƒƒãƒˆã®å¹…ãŒæ³¢é•·ã¨åŒç¨‹åº¦ã¾ãŸã¯ãã‚Œã‚ˆã‚Šå°ã•ã„å ´åˆã€
                    é€šéå¾Œã®æ³¢ã¯ã©ã®ã‚ˆã†ãªå½¢çŠ¶ã«ãªã‚‹ã‹ã€‚ã¾ãŸã€ãã®ç†ç”±ã‚’ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã‚’ç”¨ã„ã¦èª¬æ˜ã—ãªã•ã„ã€‚
                </p>
                
                <details>
                    <summary>è§£ç­”ãƒ»è§£èª¬ã‚’è¦‹ã‚‹</summary>
                    <div class="answer">
                        <p><strong>è§£ç­”</strong></p>
                        <p>
                            <strong>æ³¢ã®å½¢çŠ¶ï¼š</strong>çƒé¢æ³¢ï¼ˆå††å½¢æ³¢ï¼‰ã«è¿‘ã„å½¢çŠ¶ã«ãªã‚‹ã€‚
                        </p>
                        <p style="margin-top: 10px;">
                            <strong>ç†ç”±ï¼š</strong>
                            ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã«ã‚ˆã‚Œã°ã€æ³¢é¢ä¸Šã®å„ç‚¹ãŒæ–°ãŸãªç‚¹æ³¢æºã¨ãªã‚Šç´ å…ƒæ³¢ã‚’ç™ºç”Ÿã•ã›ã‚‹ã€‚
                            å¹³é¢æ³¢ãŒã‚¹ãƒªãƒƒãƒˆã‚’é€šéã™ã‚‹ã¨ãã€ã‚¹ãƒªãƒƒãƒˆéƒ¨åˆ†ã®ã¿ã§ç´ å…ƒæ³¢ãŒç™ºç”Ÿã™ã‚‹ã€‚
                            ã‚¹ãƒªãƒƒãƒˆå¹…ãŒç‹­ã„å ´åˆã€ç´ å…ƒæ³¢ã‚’ç™ºç”Ÿã•ã›ã‚‹ç‚¹ãŒé™ã‚‰ã‚Œã‚‹ãŸã‚ã€
                            ã‚ãŸã‹ã‚‚1ã¤ã®ç‚¹æ³¢æºã‹ã‚‰ç™ºç”Ÿã—ãŸã‹ã®ã‚ˆã†ãªçƒé¢æ³¢ã«è¿‘ã„å½¢çŠ¶ã¨ãªã‚‹ã€‚
                            ã“ã‚ŒãŒã€Œå›æŠ˜ã€ã¨å‘¼ã°ã‚Œã‚‹ç¾è±¡ã§ã‚ã‚‹ã€‚
                        </p>
                        <p style="margin-top: 15px;"><strong>è£œè¶³</strong></p>
                        <p>
                            ã‚¹ãƒªãƒƒãƒˆå¹…ãŒæ³¢é•·ã‚ˆã‚Šååˆ†å¤§ãã„å ´åˆã¯ã€å¤šæ•°ã®ç´ å…ƒæ³¢ã®åŒ…çµ¡ç·šãŒç›´ç·šã«è¿‘ããªã‚Šã€
                            å¹³é¢æ³¢ã«è¿‘ã„å½¢ã§é€šéã—ã¾ã™ã€‚æ³¢é•·ã¨ã‚¹ãƒªãƒƒãƒˆå¹…ã®é–¢ä¿‚ãŒå›æŠ˜ã®ç¨‹åº¦ã‚’æ±ºã‚ã‚‹é‡è¦ãªè¦ç´ ã§ã™ã€‚
                        </p>
                    </div>
                </details>
            </div>
        </div>
        
        <!-- ========== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– ========== -->
        <div id="simulation" class="tab-content">
            <h2>å®Ÿé¨“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            
            <!-- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³A -->
            <div class="sim-section">
                <h3>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³Aï¼šãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†ã®å¯è¦–åŒ–</h3>
                <p>æ³¢é¢ä¸Šã®å„ç‚¹ã‹ã‚‰ç´ å…ƒæ³¢ãŒç™ºç”Ÿã—ã€æ–°ã—ã„æ³¢é¢ãŒå½¢æˆã•ã‚Œã‚‹æ§˜å­ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚</p>
                
                <div id="sim-container">
                    <canvas id="physicsCanvas"></canvas>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>æ³¢ã®é€²è¡Œé€Ÿåº¦: <span class="value-display" id="speedDisplay">50 px/s</span></label>
                        <input type="range" id="speedSlider" min="20" max="100" value="50" step="5">
                    </div>
                    
                    <div class="control-group">
                        <label>ç´ å…ƒæ³¢ã®æ•°: <span class="value-display" id="pointsDisplay">7 å€‹</span></label>
                        <input type="range" id="pointsSlider" min="3" max="15" value="7" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label>æ™‚é–“é–“éš” Î”t: <span class="value-display" id="dtDisplay">1.0 s</span></label>
                        <input type="range" id="dtSlider" min="0.5" max="2.0" value="1.0" step="0.1">
                    </div>
                    
                    <div class="button-group">
                        <button class="sim-button start" id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button reset" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
            </div>
            
            <!-- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³B -->
            <div class="sim-section">
                <h3>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³Bï¼šã‚¹ãƒªãƒƒãƒˆå›æŠ˜</h3>
                <p>å¹³é¢æ³¢ãŒã‚¹ãƒªãƒƒãƒˆï¼ˆéš™é–“ï¼‰ã‚’é€šéã—ãŸã¨ãã€å›æŠ˜ã«ã‚ˆã£ã¦æ³¢ãŒåºƒãŒã‚‹æ§˜å­ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚</p>
                
                <div id="sim-container">
                    <canvas id="slitCanvas"></canvas>
                </div>
                
                <div class="sim-controls">
                    <div class="control-group">
                        <label>ã‚¹ãƒªãƒƒãƒˆæ•°:</label>
                        <div class="toggle-group">
                            <button class="toggle-btn active" id="singleSlitBtn" onclick="setSlitMode(1)">å˜ã‚¹ãƒªãƒƒãƒˆ</button>
                            <button class="toggle-btn" id="doubleSlitBtn" onclick="setSlitMode(2)">ãƒ€ãƒ–ãƒ«ã‚¹ãƒªãƒƒãƒˆ</button>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label>æ³¢é•·: <span class="value-display" id="wavelengthDisplay">30 px</span></label>
                        <input type="range" id="wavelengthSlider" min="15" max="60" value="30" step="5">
                    </div>
                    
                    <div class="control-group" id="slitDistanceGroup" style="display: none;">
                        <label>ã‚¹ãƒªãƒƒãƒˆé–“éš”: <span class="value-display" id="slitDistanceDisplay">80 px</span></label>
                        <input type="range" id="slitDistanceSlider" min="40" max="150" value="80" step="10">
                    </div>
                    
                    <div class="button-group">
                        <button class="sim-button start" id="startBtn2">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                        <button class="sim-button reset" id="resetBtn2">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // ========================================
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    // ========================================
    function openTab(tabName) {
        var contents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < contents.length; i++) {
            contents[i].style.display = "none";
            contents[i].classList.remove("active");
        }
        var buttons = document.getElementsByClassName("tab-btn");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        if (event && event.currentTarget) {
            event.currentTarget.classList.add("active");
        }
        
        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–ã‚’é–‹ã„ãŸã¨ãã«Canvasã‚’åˆæœŸåŒ–
        if (tabName === 'simulation') {
            setTimeout(() => {
                initHuygensSimulation();
                initSlitSimulation();
            }, 100);
        }
    }
    
    // ========================================
    // è§£èª¬ç”¨å›³ã®æç”»
    // ========================================
    
    // å›³1: æ°´é¢æ³¢ã®åºƒãŒã‚Š
    function drawWavefrontFig1() {
        const canvas = document.getElementById('wavefrontFig1');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.fillStyle = '#e3f2fd';
        ctx.fillRect(0, 0, W, H);
        
        const cx = W * 0.5, cy = H * 0.5;
        
        // åŒå¿ƒå††ï¼ˆæ³¢é¢ï¼‰ã‚’æã - å±±ã¯å®Ÿç·šã€è°·ã¯ç ´ç·šã€æ¿ƒã•ã¯çµ±ä¸€
        ctx.strokeStyle = '#1976d2';
        ctx.lineWidth = 3;
        
        for (let i = 1; i <= 4; i++) {
            ctx.beginPath();
            if (i % 2 === 1) {
                // å±±ï¼šå®Ÿç·š
                ctx.setLineDash([]);
            } else {
                // è°·ï¼šç ´ç·š
                ctx.setLineDash([8, 6]);
            }
            ctx.arc(cx, cy, i * 40, 0, Math.PI * 2);
            ctx.stroke();
        }
        ctx.setLineDash([]);
        
        // ä¸­å¿ƒç‚¹ï¼ˆæ³¢æºï¼‰
        ctx.beginPath();
        ctx.arc(cx, cy, 8, 0, Math.PI * 2);
        ctx.fillStyle = '#d32f2f';
        ctx.fill();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#333';
        ctx.font = '14px sans-serif';
        ctx.fillText('æ³¢æº', cx + 15, cy - 10);
        ctx.fillText('å±±', cx + 45, cy - 35);
        ctx.fillText('è°·', cx + 85, cy - 70);
        ctx.fillText('å±±', cx + 125, cy - 105);
        ctx.fillText('è°·', cx + 165, cy - 140);
        
        // å‡¡ä¾‹
        ctx.fillStyle = '#1976d2';
        ctx.font = '13px sans-serif';
        // å®Ÿç·šã®å‡¡ä¾‹
        ctx.beginPath();
        ctx.moveTo(30, H - 35);
        ctx.lineTo(70, H - 35);
        ctx.stroke();
        ctx.fillStyle = '#333';
        ctx.fillText('å±±ï¼ˆå®Ÿç·šï¼‰', 75, H - 30);
        
        // ç ´ç·šã®å‡¡ä¾‹
        ctx.setLineDash([8, 6]);
        ctx.beginPath();
        ctx.moveTo(30, H - 15);
        ctx.lineTo(70, H - 15);
        ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillText('è°·ï¼ˆç ´ç·šï¼‰', 75, H - 10);
        
        // ã€Œæ³¢é¢ã€ã®ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#1976d2';
        ctx.fillText('â† æ³¢é¢ï¼ˆåŒä½ç›¸ã®ç‚¹ã‚’çµã‚“ã ç·šï¼‰', cx + 80, cy + 50);
    }
    
    // å›³2: æ³¢é¢ã¨é€²è¡Œæ–¹å‘
    function drawWavefrontFig2() {
        const canvas = document.getElementById('wavefrontFig2');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.fillStyle = '#fff';
        ctx.fillRect(0, 0, W, H);
        
        // === å·¦å´ï¼šå¹³é¢æ³¢ ===
        const planeWaveX = [70, 130, 190];
        const planeAreaRight = 230;
        
        // æ³¢é¢ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#1976d2';
        ctx.font = 'bold 14px sans-serif';
        ctx.fillText('æ³¢é¢', planeWaveX[1] - 15, 20);
        
        // æ³¢é¢ï¼ˆç¸¦ç·šï¼‰- é’è‰²
        ctx.strokeStyle = '#1976d2';
        ctx.lineWidth = 3;
        for (let i = 0; i < 3; i++) {
            const x = planeWaveX[i];
            ctx.beginPath();
            ctx.moveTo(x, 30);
            ctx.lineTo(x, H - 30);
            ctx.stroke();
        }
        
        // é€²è¡Œæ–¹å‘ã®çŸ¢å° - èµ¤è‰²
        ctx.strokeStyle = '#d32f2f';
        ctx.fillStyle = '#d32f2f';
        ctx.lineWidth = 2;
        
        const arrowYs = [55, 100, 145];
        for (let j = 0; j < 3; j++) {
            const y = arrowYs[j];
            const startX = planeWaveX[0];
            const endX = planeWaveX[2] + 20;
            
            ctx.beginPath();
            ctx.moveTo(startX, y);
            ctx.lineTo(endX, y);
            ctx.stroke();
            // çŸ¢ã˜ã‚Š
            ctx.beginPath();
            ctx.moveTo(endX, y);
            ctx.lineTo(endX - 10, y - 6);
            ctx.lineTo(endX - 10, y + 6);
            ctx.closePath();
            ctx.fill();
        }
        
        // å‚ç›´ãƒãƒ¼ã‚¯ï¼ˆçœŸã‚“ä¸­ã®æ³¢é¢ã¨ä¸­å¤®ã®çŸ¢å°ã®äº¤ç‚¹ï¼‰
        // æ™‚è¨ˆå›ã‚Šã«90Â°å›è»¢ï¼šçŸ¢å°ã«æ²¿ã£ã¦å³ã«ã€æ³¢é¢ã«æ²¿ã£ã¦ä¸Šã«
        const cornerX = planeWaveX[1];
        const cornerY = arrowYs[1];
        const markSize = 12;
        
        ctx.strokeStyle = '#4caf50';
        ctx.lineWidth = 2;
        ctx.beginPath();
        // çŸ¢å°ã«æ²¿ã£ã¦å³ã«
        ctx.moveTo(cornerX, cornerY);
        ctx.lineTo(cornerX + markSize, cornerY);
        // æ³¢é¢ã«æ²¿ã£ã¦ä¸Šã«
        ctx.lineTo(cornerX + markSize, cornerY - markSize);
        ctx.stroke();
        
        // é€²è¡Œæ–¹å‘ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#d32f2f';
        ctx.font = '13px sans-serif';
        ctx.fillText('é€²è¡Œæ–¹å‘', planeWaveX[2] + 25, 60);
        
        // å‚ç›´ã®æ³¨é‡ˆ
        ctx.fillStyle = '#4caf50';
        ctx.font = 'bold 13px sans-serif';
        ctx.fillText('å¸¸ã«å‚ç›´ï¼', planeWaveX[1] - 50, cornerY + 40);
        
        // ã€Œå¹³é¢æ³¢ã€ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#333';
        ctx.font = '13px sans-serif';
        ctx.fillText('å¹³é¢æ³¢', planeWaveX[1] - 20, H - 8);
        
        // === å³å´ï¼šçƒé¢æ³¢ ===
        const cx = 370, cy = H / 2;
        
        // æ³¢é¢ï¼ˆåŒå¿ƒå††ï¼‰- é’è‰²
        ctx.strokeStyle = '#1976d2';
        ctx.lineWidth = 3;
        for (let i = 1; i <= 3; i++) {
            ctx.beginPath();
            ctx.arc(cx, cy, i * 30, 0, Math.PI * 2);
            ctx.stroke();
        }
        
        // ä¸­å¿ƒç‚¹ - èµ¤è‰²
        ctx.beginPath();
        ctx.arc(cx, cy, 5, 0, Math.PI * 2);
        ctx.fillStyle = '#d32f2f';
        ctx.fill();
        
        // æ”¾å°„çŠ¶ã®çŸ¢å°ï¼ˆé€²è¡Œæ–¹å‘ï¼‰- èµ¤è‰²
        ctx.strokeStyle = '#d32f2f';
        ctx.fillStyle = '#d32f2f';
        ctx.lineWidth = 2;
        
        const angles = [0, Math.PI/2, Math.PI, -Math.PI/2, Math.PI/4, -Math.PI/4, 3*Math.PI/4, -3*Math.PI/4];
        for (let k = 0; k < angles.length; k++) {
            const angle = angles[k];
            const r1 = 35, r2 = 80;
            const x1 = cx + r1 * Math.cos(angle);
            const y1 = cy + r1 * Math.sin(angle);
            const x2 = cx + r2 * Math.cos(angle);
            const y2 = cy + r2 * Math.sin(angle);
            
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            
            // çŸ¢ã˜ã‚Š
            const arrowLen = 8;
            const ax = x2 - arrowLen * Math.cos(angle);
            const ay = y2 - arrowLen * Math.sin(angle);
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(ax - 4 * Math.sin(angle), ay + 4 * Math.cos(angle));
            ctx.lineTo(ax + 4 * Math.sin(angle), ay - 4 * Math.cos(angle));
            ctx.closePath();
            ctx.fill();
        }
        
        // ç›´è§’ãƒãƒ¼ã‚¯ï¼ˆè§’åº¦0ã®çŸ¢å°ã€2ç•ªç›®ã®å††ã¨ã®äº¤ç‚¹ï¼‰
        // æ™‚è¨ˆå›ã‚Šã«90Â°å›è»¢ï¼šçŸ¢å°ã«æ²¿ã£ã¦å³ã«ã€å††ã®æ¥ç·šæ–¹å‘ï¼ˆä¸Šï¼‰ã«
        const markR = 60; // 2ç•ªç›®ã®å††ã¨ã®äº¤ç‚¹
        const markX = cx + markR;
        const markY = cy;
        const markSize2 = 10;
        
        ctx.strokeStyle = '#4caf50';
        ctx.lineWidth = 2;
        ctx.beginPath();
        // çŸ¢å°ã«æ²¿ã£ã¦å³ã«
        ctx.moveTo(markX, markY);
        ctx.lineTo(markX + markSize2, markY);
        // å††ã®æ¥ç·šæ–¹å‘ï¼ˆä¸Šï¼‰ã«
        ctx.lineTo(markX + markSize2, markY - markSize2);
        ctx.stroke();
        
        // ã€Œçƒé¢æ³¢ã€ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#333';
        ctx.font = '13px sans-serif';
        ctx.fillText('çƒé¢æ³¢', cx - 20, H - 8);
        
        // é€²è¡Œæ–¹å‘ãƒ©ãƒ™ãƒ«ï¼ˆè¦‹åˆ‡ã‚Œãªã„ã‚ˆã†ã«ä½ç½®èª¿æ•´ï¼‰
        ctx.fillStyle = '#d32f2f';
        ctx.font = '13px sans-serif';
        ctx.fillText('é€²è¡Œæ–¹å‘', cx + 85, cy - 45);
    }
    
    // å›³3: å¹³é¢æ³¢ã¨çƒé¢æ³¢ã®æ¯”è¼ƒ
    function drawWavefrontFig3() {
        const canvas = document.getElementById('wavefrontFig3');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.fillStyle = '#fafafa';
        ctx.fillRect(0, 0, W, H);
        
        // å·¦å´ï¼šå¹³é¢æ³¢
        ctx.fillStyle = '#e3f2fd';
        ctx.fillRect(20, 20, W/2 - 40, H - 40);
        
        ctx.strokeStyle = '#1976d2';
        ctx.lineWidth = 3;
        for (let i = 0; i < 5; i++) {
            const x = 60 + i * 45;
            ctx.beginPath();
            ctx.moveTo(x, 50);
            ctx.lineTo(x, H - 50);
            ctx.stroke();
        }
        
        ctx.fillStyle = '#333';
        ctx.font = 'bold 16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('å¹³é¢æ³¢', W/4, H - 15);
        ctx.font = '12px sans-serif';
        ctx.fillText('æ³¢é¢ãŒç›´ç·šï¼ˆå¹³é¢ï¼‰', W/4, 40);
        
        // å³å´ï¼šçƒé¢æ³¢
        ctx.fillStyle = '#fce4ec';
        ctx.fillRect(W/2 + 20, 20, W/2 - 40, H - 40);
        
        const cx = W * 0.75, cy = H/2;
        ctx.strokeStyle = '#e91e63';
        ctx.lineWidth = 3;
        for (let i = 1; i <= 4; i++) {
            ctx.beginPath();
            ctx.arc(cx, cy, i * 35, 0, Math.PI * 2);
            ctx.stroke();
        }
        
        ctx.beginPath();
        ctx.arc(cx, cy, 6, 0, Math.PI * 2);
        ctx.fillStyle = '#c2185b';
        ctx.fill();
        
        ctx.fillStyle = '#333';
        ctx.font = 'bold 16px sans-serif';
        ctx.fillText('çƒé¢æ³¢', W * 0.75, H - 15);
        ctx.font = '12px sans-serif';
        ctx.fillText('æ³¢é¢ãŒå††ï¼ˆçƒé¢ï¼‰', W * 0.75, 40);
        ctx.fillText('ç‚¹æ³¢æº', cx + 15, cy - 15);
        
        ctx.textAlign = 'left';
    }
    
    // ========================================
    // ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹åŸç†ã‚¹ãƒ†ãƒƒãƒ—è§£èª¬
    // ========================================
    let currentStep = 1;
    
    function showHuygensStep(step) {
        currentStep = step;
        
        // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
        const btns = document.querySelectorAll('.step-btn');
        btns.forEach((btn, i) => {
            btn.classList.toggle('active', i === step - 1);
        });
        
        // èª¬æ˜æ–‡ã‚’æ›´æ–°
        const descriptions = [
            '<strong>Step 1ï¼š</strong>ç¾åœ¨ã®æ³¢é¢ã‚’è€ƒãˆã¾ã™ã€‚ã“ã®æ³¢é¢ä¸Šã®ã™ã¹ã¦ã®ç‚¹ã«æ³¨ç›®ã—ã¾ã—ã‚‡ã†ã€‚æ³¢é¢ã¯åŒä½ç›¸ã®ç‚¹ã‚’çµã‚“ã ç·šã§ã™ã€‚',
            '<strong>Step 2ï¼š</strong>æ³¢é¢ä¸Šã®å„ç‚¹ãŒã€Œç‚¹æ³¢æºã€ã¨ãªã‚Šã€ãã‚Œãã‚Œã‹ã‚‰<span style="color:#e91e63;">ç´ å…ƒæ³¢ï¼ˆçƒé¢æ³¢ï¼‰</span>ãŒç™ºç”Ÿã—ã¾ã™ã€‚ç´ å…ƒæ³¢ã®åŠå¾„ã¯ $r = v \\Delta t$ ã§ã™ã€‚',
            '<strong>Step 3ï¼š</strong>ã™ã¹ã¦ã®ç´ å…ƒæ³¢ã®<span style="color:#4caf50;">å…±é€šæ¥ç·šï¼ˆåŒ…çµ¡ç·šï¼‰</span>ã‚’å¼•ãã¾ã™ã€‚ã“ã‚ŒãŒæ¬¡ã®ç¬é–“ã®æ³¢é¢ã«ãªã‚Šã¾ã™ã€‚',
            '<strong>Step 4ï¼š</strong>ã“ã†ã—ã¦æ–°ã—ã„æ³¢é¢ãŒå½¢æˆã•ã‚Œã¾ã—ãŸã€‚ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒé€£ç¶šçš„ã«ç¹°ã‚Šè¿”ã•ã‚Œã‚‹ã“ã¨ã§ã€æ³¢ãŒä¼ã‚ã£ã¦ã„ãã¾ã™ã€‚'
        ];
        document.getElementById('stepDescription').innerHTML = descriptions[step - 1];
        
        // MathJaxã§æ•°å¼ã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        if (window.MathJax) {
            MathJax.typesetPromise([document.getElementById('stepDescription')]);
        }
        
        drawHuygensStep();
    }
    
    function drawHuygensStep() {
        const canvas = document.getElementById('huygensStepCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        ctx.fillStyle = '#fff';
        ctx.fillRect(0, 0, W, H);
        
        const wavefrontX = 120;
        const newWavefrontX = 380;
        const numPoints = 7;
        const spacing = (H - 80) / (numPoints - 1);
        const radius = newWavefrontX - wavefrontX;
        
        // Step 1ä»¥ä¸Š: ç¾åœ¨ã®æ³¢é¢
        if (currentStep >= 1) {
            ctx.strokeStyle = '#1976d2';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(wavefrontX, 40);
            ctx.lineTo(wavefrontX, H - 40);
            ctx.stroke();
            
            // ãƒ©ãƒ™ãƒ«
            ctx.fillStyle = '#1976d2';
            ctx.font = 'bold 14px sans-serif';
            ctx.fillText('ç¾åœ¨ã®æ³¢é¢', wavefrontX - 45, 25);
            
            // é€²è¡Œæ–¹å‘çŸ¢å°
            ctx.strokeStyle = '#999';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, H/2);
            ctx.lineTo(90, H/2);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(90, H/2);
            ctx.lineTo(80, H/2 - 6);
            ctx.lineTo(80, H/2 + 6);
            ctx.closePath();
            ctx.fillStyle = '#999';
            ctx.fill();
            ctx.fillText('v', 60, H/2 - 10);
        }
        
        // Step 2ä»¥ä¸Š: ç‚¹æ³¢æºã¨ç´ å…ƒæ³¢
        if (currentStep >= 2) {
            // æ³¢é¢ä¸Šã®ç‚¹
            for (let i = 0; i < numPoints; i++) {
                const y = 40 + i * spacing;
                
                // ç‚¹æ³¢æº
                ctx.beginPath();
                ctx.arc(wavefrontX, y, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#d32f2f';
                ctx.fill();
                
                // ç´ å…ƒæ³¢ï¼ˆåŠå††ï¼‰
                ctx.beginPath();
                ctx.arc(wavefrontX, y, radius, -Math.PI/2, Math.PI/2);
                ctx.strokeStyle = 'rgba(233, 30, 99, 0.5)';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            ctx.fillStyle = '#e91e63';
            ctx.font = '12px sans-serif';
            ctx.fillText('ç´ å…ƒæ³¢', wavefrontX + 80, 70);
            ctx.fillText('r = vÎ”t', wavefrontX + radius/2 - 20, H/2 - 10);
        }
        
        // Step 3ä»¥ä¸Š: åŒ…çµ¡ç·š
        if (currentStep >= 3) {
            ctx.strokeStyle = '#4caf50';
            ctx.lineWidth = 3;
            ctx.setLineDash([8, 4]);
            ctx.beginPath();
            ctx.moveTo(newWavefrontX, 40);
            ctx.lineTo(newWavefrontX, H - 40);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#4caf50';
            ctx.font = 'bold 14px sans-serif';
            ctx.fillText('åŒ…çµ¡ç·š', newWavefrontX + 10, H/2);
        }
        
        // Step 4: æ–°ã—ã„æ³¢é¢ã‚’å¼·èª¿
        if (currentStep >= 4) {
            ctx.strokeStyle = '#4caf50';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(newWavefrontX, 40);
            ctx.lineTo(newWavefrontX, H - 40);
            ctx.stroke();
            
            ctx.fillStyle = '#4caf50';
            ctx.font = 'bold 14px sans-serif';
            ctx.fillText('æ–°ã—ã„æ³¢é¢', newWavefrontX - 35, 25);
            
            // è·é›¢ã®è¡¨ç¤º
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(wavefrontX, H - 25);
            ctx.lineTo(newWavefrontX, H - 25);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(wavefrontX, H - 30);
            ctx.lineTo(wavefrontX, H - 20);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(newWavefrontX, H - 30);
            ctx.lineTo(newWavefrontX, H - 20);
            ctx.stroke();
            
            ctx.fillStyle = '#666';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('vÎ”t', (wavefrontX + newWavefrontX)/2, H - 10);
            ctx.textAlign = 'left';
        }
    }
    
    // ========================================
    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³A: ãƒ›ã‚¤ãƒ˜ãƒ³ã‚¹ã®åŸç†
    // ========================================
    let simA = {
        canvas: null,
        ctx: null,
        animationId: null,
        isRunning: false,
        time: 0,
        speed: 50,
        numPoints: 7,
        dt: 1.0,
        wavefronts: []
    };
    
    function initHuygensSimulation() {
        simA.canvas = document.getElementById('physicsCanvas');
        if (!simA.canvas) return;
        
        simA.canvas.width = simA.canvas.parentElement.clientWidth - 40;
        simA.canvas.height = 350;
        simA.ctx = simA.canvas.getContext('2d');
        
        resetSimA();
        drawSimA();
        
        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('speedSlider').addEventListener('input', function() {
            simA.speed = parseFloat(this.value);
            document.getElementById('speedDisplay').textContent = simA.speed + ' px/s';
        });
        
        document.getElementById('pointsSlider').addEventListener('input', function() {
            simA.numPoints = parseInt(this.value);
            document.getElementById('pointsDisplay').textContent = simA.numPoints + ' å€‹';
            if (!simA.isRunning) {
                resetSimA();
                drawSimA();
            }
        });
        
        document.getElementById('dtSlider').addEventListener('input', function() {
            simA.dt = parseFloat(this.value);
            document.getElementById('dtDisplay').textContent = simA.dt.toFixed(1) + ' s';
        });
        
        // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('startBtn').addEventListener('click', toggleSimA);
        document.getElementById('resetBtn').addEventListener('click', function() {
            stopSimA();
            resetSimA();
            drawSimA();
        });
    }
    
    function resetSimA() {
        simA.time = 0;
        simA.wavefronts = [{x: 50, t: 0}];
        simA.isRunning = false;
        document.getElementById('startBtn').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
    }
    
    function toggleSimA() {
        if (simA.isRunning) {
            stopSimA();
        } else {
            startSimA();
        }
    }
    
    function startSimA() {
        simA.isRunning = true;
        document.getElementById('startBtn').textContent = 'ä¸€æ™‚åœæ­¢';
        simA.lastTime = performance.now();
        animateSimA();
    }
    
    function stopSimA() {
        simA.isRunning = false;
        document.getElementById('startBtn').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
        if (simA.animationId) {
            cancelAnimationFrame(simA.animationId);
        }
    }
    
    function animateSimA() {
        if (!simA.isRunning) return;
        
        const now = performance.now();
        const elapsed = (now - simA.lastTime) / 1000;
        simA.lastTime = now;
        
        simA.time += elapsed;
        
        // æ–°ã—ã„æ³¢é¢ã‚’è¿½åŠ 
        const lastWavefront = simA.wavefronts[simA.wavefronts.length - 1];
        if (simA.time - lastWavefront.t >= simA.dt && lastWavefront.x < simA.canvas.width - 100) {
            simA.wavefronts.push({
                x: lastWavefront.x + simA.speed * simA.dt,
                t: simA.time,
                originX: lastWavefront.x + simA.speed * simA.dt // å…ƒã®ä½ç½®ã‚’è¨˜éŒ²
            });
        }
        
        // ç¾åœ¨ä½ç½®ãŒç”»é¢å¤–ã«å‡ºãŸæ³¢é¢ã¯å‰Šé™¤
        simA.wavefronts = simA.wavefronts.filter(wf => {
            const currentX = wf.x + simA.speed * (simA.time - wf.t);
            return currentX < simA.canvas.width + 50;
        });
        
        drawSimA();
        
        simA.animationId = requestAnimationFrame(animateSimA);
    }
    
    function drawSimA() {
        const ctx = simA.ctx;
        const W = simA.canvas.width, H = simA.canvas.height;
        
        // èƒŒæ™¯
        ctx.fillStyle = '#f5f5f5';
        ctx.fillRect(0, 0, W, H);
        
        const spacing = (H - 60) / (simA.numPoints - 1);
        
        // å„æ³¢é¢ã‚’æç”»
        simA.wavefronts.forEach((wf, index) => {
            const age = simA.time - wf.t;
            const currentX = wf.x + simA.speed * age;
            
            if (currentX < 0 || currentX > W + 50) return;
            
            // å…ƒã®ä½ç½®ã«è–„ã„æ³¢é¢ã‚’æç”»ï¼ˆéå»ã®ä½ç½®ï¼‰
            if (age > 0.1 && wf.x > 0 && wf.x < W) {
                ctx.strokeStyle = 'rgba(25, 118, 210, 0.2)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(wf.x, 30);
                ctx.lineTo(wf.x, H - 30);
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // ç´ å…ƒæ³¢ã‚’æç”»ï¼ˆæœ€æ–°ã®æ³¢é¢ã®ã¿ï¼‰
            if (index === simA.wavefronts.length - 1 && age > 0 && age < simA.dt) {
                const radius = simA.speed * age;
                
                for (let i = 0; i < simA.numPoints; i++) {
                    const y = 30 + i * spacing;
                    
                    // ç‚¹æ³¢æº
                    ctx.beginPath();
                    ctx.arc(wf.x, y, 4, 0, Math.PI * 2);
                    ctx.fillStyle = '#d32f2f';
                    ctx.fill();
                    
                    // ç´ å…ƒæ³¢
                    ctx.beginPath();
                    ctx.arc(wf.x, y, radius, -Math.PI/2, Math.PI/2);
                    ctx.strokeStyle = 'rgba(233, 30, 99, 0.4)';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            }
            
            // ç¾åœ¨ã®æ³¢é¢ã‚’æç”»ï¼ˆå®Ÿç·šã§æ¿ƒãï¼‰
            ctx.strokeStyle = 'rgba(25, 118, 210, 0.9)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(currentX, 30);
            ctx.lineTo(currentX, H - 30);
            ctx.stroke();
        });
        
        // æƒ…å ±è¡¨ç¤º
        ctx.fillStyle = '#333';
        ctx.font = '14px sans-serif';
        ctx.fillText('æ™‚é–“: ' + simA.time.toFixed(2) + ' s', 10, 20);
        ctx.fillText('æ³¢é¢æ•°: ' + simA.wavefronts.length, W - 100, 20);
        
        // å‡¡ä¾‹
        ctx.strokeStyle = '#1976d2';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(W - 95, H - 55);
        ctx.lineTo(W - 65, H - 55);
        ctx.stroke();
        ctx.fillStyle = '#333';
        ctx.fillText('ç¾åœ¨ã®æ³¢é¢', W - 60, H - 50);
        
        ctx.strokeStyle = 'rgba(25, 118, 210, 0.2)';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(W - 95, H - 35);
        ctx.lineTo(W - 65, H - 35);
        ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillText('å…ƒã®ä½ç½®', W - 60, H - 30);
        
        ctx.fillStyle = '#e91e63';
        ctx.fillText('â—‹ ç´ å…ƒæ³¢', W - 95, H - 10);
    }
    
    // ========================================
    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³B: ã‚¹ãƒªãƒƒãƒˆå›æŠ˜
    // ========================================
    let simB = {
        canvas: null,
        ctx: null,
        animationId: null,
        isRunning: false,
        time: 0,
        slitMode: 1,
        slitWidth: 20,
        wavelength: 30,
        slitDistance: 80,
        waves: []
    };
    
    function initSlitSimulation() {
        simB.canvas = document.getElementById('slitCanvas');
        if (!simB.canvas) return;
        
        simB.canvas.width = simB.canvas.parentElement.clientWidth - 40;
        simB.canvas.height = 400;
        simB.ctx = simB.canvas.getContext('2d');
        
        resetSimB();
        drawSimB();
        
        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('wavelengthSlider').addEventListener('input', function() {
            simB.wavelength = parseFloat(this.value);
            document.getElementById('wavelengthDisplay').textContent = simB.wavelength + ' px';
        });
        
        document.getElementById('slitDistanceSlider').addEventListener('input', function() {
            simB.slitDistance = parseFloat(this.value);
            document.getElementById('slitDistanceDisplay').textContent = simB.slitDistance + ' px';
        });
        
        // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('startBtn2').addEventListener('click', toggleSimB);
        document.getElementById('resetBtn2').addEventListener('click', function() {
            stopSimB();
            resetSimB();
            drawSimB();
        });
    }
    
    function setSlitMode(mode) {
        simB.slitMode = mode;
        document.getElementById('singleSlitBtn').classList.toggle('active', mode === 1);
        document.getElementById('doubleSlitBtn').classList.toggle('active', mode === 2);
        document.getElementById('slitDistanceGroup').style.display = mode === 2 ? 'block' : 'none';
        
        if (!simB.isRunning) {
            resetSimB();
            drawSimB();
        }
    }
    
    function resetSimB() {
        simB.time = 0;
        simB.waves = [];
        simB.isRunning = false;
        document.getElementById('startBtn2').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
    }
    
    function toggleSimB() {
        if (simB.isRunning) {
            stopSimB();
        } else {
            startSimB();
        }
    }
    
    function startSimB() {
        simB.isRunning = true;
        document.getElementById('startBtn2').textContent = 'ä¸€æ™‚åœæ­¢';
        simB.lastTime = performance.now();
        animateSimB();
    }
    
    function stopSimB() {
        simB.isRunning = false;
        document.getElementById('startBtn2').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
        if (simB.animationId) {
            cancelAnimationFrame(simB.animationId);
        }
    }
    
    function animateSimB() {
        if (!simB.isRunning) return;
        
        const now = performance.now();
        const elapsed = (now - simB.lastTime) / 1000;
        simB.lastTime = now;
        
        simB.time += elapsed * 60; // é€Ÿåº¦èª¿æ•´
        
        drawSimB();
        
        simB.animationId = requestAnimationFrame(animateSimB);
    }
    
    function drawSimB() {
        const ctx = simB.ctx;
        const W = simB.canvas.width, H = simB.canvas.height;
        const barrierX = W * 0.35;
        const cy = H / 2;
        
        // èƒŒæ™¯
        ctx.fillStyle = '#1a237e';
        ctx.fillRect(0, 0, W, H);
        
        // å…¥å°„å¹³é¢æ³¢ï¼ˆå·¦å´ï¼‰- å·¦ã‹ã‚‰å³ã¸é€²ã‚€
        const waveSpeed = 2;
        const numWaves = Math.ceil(barrierX / simB.wavelength) + 2;
        
        for (let i = 0; i < numWaves; i++) {
            // æ³¢ãŒå³ã«é€²ã‚€ã‚ˆã†ã«ä¿®æ­£ï¼ˆ+ simB.time * waveSpeedï¼‰
            let x = (i * simB.wavelength + simB.time * waveSpeed) % (simB.wavelength * numWaves);
            if (x < 0) x += simB.wavelength * numWaves;
            
            // å·¦ç«¯ã‹ã‚‰å§‹ã¾ã£ã¦å³ã¸é€²ã‚€
            const adjustedX = x % (barrierX + simB.wavelength);
            
            if (adjustedX < barrierX - 5 && adjustedX > 0) {
                const phase = (adjustedX / simB.wavelength) * Math.PI * 2;
                const intensity = 0.3 + 0.7 * Math.abs(Math.sin(phase));
                ctx.strokeStyle = `rgba(100, 181, 246, ${intensity})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(adjustedX, 0);
                ctx.lineTo(adjustedX, H);
                ctx.stroke();
            }
        }
        
        // ã‚¹ãƒªãƒƒãƒˆã®ä½ç½®ã‚’è¨ˆç®—
        let slitCenters = [];
        if (simB.slitMode === 1) {
            slitCenters = [cy];
        } else {
            slitCenters = [cy - simB.slitDistance / 2, cy + simB.slitDistance / 2];
        }
        
        // å›æŠ˜æ³¢ï¼ˆã‚¹ãƒªãƒƒãƒˆé€šéå¾Œï¼‰
        const maxRadius = W - barrierX + 50;
        
        slitCenters.forEach(slitY => {
            const numCircles = Math.ceil(maxRadius / simB.wavelength);
            
            for (let i = 0; i < numCircles; i++) {
                let radius = (i * simB.wavelength + simB.time * waveSpeed) % (simB.wavelength * numCircles);
                if (radius < 0) radius += simB.wavelength * numCircles;
                
                if (radius > 5 && radius < maxRadius) {
                    const intensity = Math.max(0, 0.6 - radius / maxRadius * 0.5);
                    ctx.strokeStyle = `rgba(100, 181, 246, ${intensity})`;
                    ctx.lineWidth = 2;
                    
                    ctx.beginPath();
                    ctx.arc(barrierX, slitY, radius, -Math.PI/2, Math.PI/2);
                    ctx.stroke();
                }
            }
        });
        
        // éšœå£ã‚’æç”»
        ctx.fillStyle = '#37474f';
        
        if (simB.slitMode === 1) {
            // å˜ã‚¹ãƒªãƒƒãƒˆ
            ctx.fillRect(barrierX - 8, 0, 16, cy - simB.slitWidth / 2);
            ctx.fillRect(barrierX - 8, cy + simB.slitWidth / 2, 16, H - cy - simB.slitWidth / 2);
        } else {
            // ãƒ€ãƒ–ãƒ«ã‚¹ãƒªãƒƒãƒˆ
            const slit1Y = cy - simB.slitDistance / 2;
            const slit2Y = cy + simB.slitDistance / 2;
            
            ctx.fillRect(barrierX - 8, 0, 16, slit1Y - simB.slitWidth / 2);
            ctx.fillRect(barrierX - 8, slit1Y + simB.slitWidth / 2, 16, slit2Y - simB.slitWidth / 2 - slit1Y - simB.slitWidth / 2);
            ctx.fillRect(barrierX - 8, slit2Y + simB.slitWidth / 2, 16, H - slit2Y - simB.slitWidth / 2);
        }
        
        // éšœå£ã®ç¸å–ã‚Š
        ctx.strokeStyle = '#546e7a';
        ctx.lineWidth = 2;
        ctx.strokeRect(barrierX - 8, 0, 16, H);
        
        // é€²è¡Œæ–¹å‘ã®çŸ¢å°ã‚’è¿½åŠ ï¼ˆå·¦ã‹ã‚‰å³ï¼‰
        ctx.strokeStyle = '#ffeb3b';
        ctx.fillStyle = '#ffeb3b';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(30, 30);
        ctx.lineTo(100, 30);
        ctx.stroke();
        // çŸ¢ã˜ã‚Š
        ctx.beginPath();
        ctx.moveTo(100, 30);
        ctx.lineTo(90, 24);
        ctx.lineTo(90, 36);
        ctx.closePath();
        ctx.fill();
        
        // ãƒ©ãƒ™ãƒ«
        ctx.fillStyle = '#fff';
        ctx.font = '14px sans-serif';
        ctx.fillText('å…¥å°„å¹³é¢æ³¢ â†’', 20, 55);
        ctx.fillText('å›æŠ˜æ³¢', W - 80, 25);
        ctx.fillText('éšœå£', barrierX - 15, H - 10);
        
        // ã‚¹ãƒªãƒƒãƒˆå¹…ã®è¡¨ç¤º
        ctx.strokeStyle = '#ffeb3b';
        ctx.lineWidth = 1;
        slitCenters.forEach(slitY => {
            ctx.beginPath();
            ctx.moveTo(barrierX + 25, slitY - simB.slitWidth / 2);
            ctx.lineTo(barrierX + 25, slitY + simB.slitWidth / 2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(barrierX + 20, slitY - simB.slitWidth / 2);
            ctx.lineTo(barrierX + 30, slitY - simB.slitWidth / 2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(barrierX + 20, slitY + simB.slitWidth / 2);
            ctx.lineTo(barrierX + 30, slitY + simB.slitWidth / 2);
            ctx.stroke();
        });
        
        ctx.fillStyle = '#ffeb3b';
        ctx.font = '12px sans-serif';
        ctx.fillText('ã‚¹ãƒªãƒƒãƒˆå¹…: ' + simB.slitWidth + 'px', barrierX + 35, slitCenters[0] + 5);
        ctx.fillText('æ³¢é•·: ' + simB.wavelength + 'px', 20, H - 10);
    }
    
    // ========================================
    // åˆæœŸåŒ–
    // ========================================
    window.addEventListener('load', function() {
        // è§£èª¬ç”¨å›³ã‚’æç”»
        drawWavefrontFig1();
        drawWavefrontFig2();
        drawWavefrontFig3();
        drawHuygensStep();
    });
    
    window.addEventListener('resize', function() {
        // è§£èª¬ç”¨å›³ã‚’å†æç”»
        drawWavefrontFig1();
        drawWavefrontFig2();
        drawWavefrontFig3();
        drawHuygensStep();
        
        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒªã‚µã‚¤ã‚º
        if (simA.canvas) {
            simA.canvas.width = simA.canvas.parentElement.clientWidth - 40;
            if (!simA.isRunning) drawSimA();
        }
        if (simB.canvas) {
            simB.canvas.width = simB.canvas.parentElement.clientWidth - 40;
            if (!simB.isRunning) drawSimB();
        }
    });
    </script>
</body>
</html>